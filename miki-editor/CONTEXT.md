# 미키(Miki) 프로젝트 핵심 컨텍스트

## 프로젝트 정의
미키는 개인이 완전히 무료로 만들고 웹에 배포할 수 있는 개인용 AI 위키웹 시스템입니다. 로컬에서 쉽게 글을 쓰고, 쉽게 링크하며, 자동으로 배포하는 것이 핵심 목표입니다.

### 미키의 핵심 정체성
1. **마크다운 기반 위키 시스템**: 
   - 마크다운을 기본 포맷으로 사용하되 사용자에게는 WYSIWYG 인터페이스 제공
   - 마크다운 문법에 익숙하지 않은 일반 사용자도 쉽게 사용 가능
   - 메모장이 아닌 지식 관리 도구로서의 정체성

2. **로컬 저장 중심의 설계**:
   - 로컬 파일 시스템에 마크다운 파일로 저장
   - 네트워크 연결 없이도 완전한 기능 사용 가능
   - Jekyll 호환으로 무료 웹 호스팅 지원
   - 개인의 지식을 온전히 소유하고 관리

3. **AI 지원 편집 시스템**:
   - 통합된 AI 보조 기능으로 글 작성 및 편집 지원
   - 자연어 명령을 통한 AI 편집 제안 (사용자 승인 후 적용)
   - Claude 3.5 Haiku 모델 활용
   - 지식 연결과 구조화에 AI 활용

4. **드래그 기반 위키 링크 시스템**:
   - 텍스트 드래그 후 링크 생성 버튼으로 간편한 문서 연결
   - 하이퍼링크 생성을 위한 직관적인 인터페이스
   - 위키식 양방향 연결 구조 지원

5. **위키 구조화 기능**:
   - 계층적 문서 구조 (부모-자식 관계) 지원
   - 자동 백링크 추적 및 문서 간 관계 시각화
   - 태그 시스템을 통한 문서 분류
   - 지식 그래프를 통한 연결 시각화

### 미키 에디터의 구성 요소
1. **에디터 인터페이스 (MikiEditor.jsx)**:
   - Toast UI Editor 기반 WYSIWYG/마크다운 에디터
   - 드래그 기반 링크 생성 및 AI 제안 UI 포함
   - 토큰 최적화를 위한 문서 요약 관리 기능

2. **AI 패널 (AiPanel.jsx)**:
   - Claude API와 연동된 AI 어시스턴트 인터페이스
   - 텍스트 생성 및 문서 편집 제안 기능
   - 사용자-AI 대화 기록 관리

3. **메인 애플리케이션 (App.jsx)**:
   - 전체 레이아웃 관리 및 컴포넌트 통합
   - 문서 저장 및 로드 기능
   - 화면 크기별 레이아웃 최적화

4. **백엔드 서버 (server.js)**:
   - 문서 저장 및 관리 API
   - Claude API 프록시 서비스
   - 로컬 파일 시스템 연동

## 핵심 가치
1. **쉬운 글쓰기** - 마크다운 기반이지만 일반 사용자를 위한 WYSIWYG 인터페이스 제공
2. **간편한 연결** - 드래그 기반 링크 생성으로 쉬운 문서 연결
3. **자동 배포** - Jekyll 기반 무료 호스팅 활용

## 작동 방식
- 로컬에서 글 작성 및 편집 (오프라인 지원)
- 인터넷 연결 시 자동 업로드 및 동기화
- 수정 일시, 메타데이터 자동 업데이트
- 파일 기반 저장으로 완전한 소유권 보장
- Git 기반 변경 추적 및 배포 자동화

## 필수 기능 요구사항
1. **쉽고 빠른 문서 추가**
   - 즉시 글쓰기 인터페이스
   - 최근 문서 목록 제공
   - 사용자 친화적 에디터
   - 새 글 작성 시 빠른 시작 경험

2. **통합 검색 시스템**
   - 로컬 문서 검색 기능
   - 웹 검색 연동 기능
   - 태그 및 메타데이터 기반 검색
   - 전체 텍스트 검색(Full-text search)

3. **히스토리 관리**
   - 문서별 수정 일시 기록
   - 편집 이력 추적 및 표시
   - 파일 변경일자 표시
   - 누가 어떤 부분을 언제 편집했는지 추적

4. **계층적 문서 구조**
   - 문서마다 parent 프로퍼티 지정
   - 최대 10레벨 깊이의 계층 구조
   - 전체 경로 표시 (예: 동물 - 포유류 - 강아지)
   - 문서 간 계층 관계의 시각적 표현

5. **태그 시스템**
   - 문서 태그 지정 기능
   - 태그별 관련 문서 탐색
   - 다중 태그 지원
   - 태그 클라우드 및 관련 문서 시각화

## 사용자 경험 설계
1. **시작과 정착**
   - 앱 실행 시 즉시 빈 에디터 표시
   - 왼쪽에 최근 작업 목록 표시
   - 편집 상태 전환 없이 즉시 글 작성 가능
   - 직관적인 인터페이스로 빠른 적응

2. **마크다운 경험**
   - 일반 사용자를 위한 WYSIWYG 모드
   - 마크다운 문법 직접 노출 방지
   - 아이콘/버튼으로 서식 변경
   - 마크다운 파워 유저를 위한 고급 옵션 제공

3. **AI 지원**
   - 자연어 명령을 통한 편집 지원
   - 사용자 확인 후 AI 제안 적용
   - JSON 형식의 구조화된 AI 명령 처리
   - 컨텍스트 인식 AI 도우미

4. **링크 및 위키 구조화**
   - 드래그 텍스트 기반 위키 링크 생성
   - 계층적 문서 구조 관리
   - 백링크 시스템으로 문서 간 참조 관계 추적
   - 지식 그래프 시각화

## 기술 스택
- **프론트엔드**: React, Toast UI Editor
- **백엔드**: Express.js
- **AI 통합**: Claude API
- **정적 사이트 생성**: Jekyll
- **저장소**: 로컬 파일 시스템 + GitHub Pages
- **데이터 포맷**: 마크다운 + YAML 프론트매터
- **변경 관리**: Git

## 개발 상태
현재 "글 작성 - 링크 연결 - 웹 배포"의 기본 사용자 흐름을 완성하는 단계입니다. 드래그 기반 링크 생성과 토큰 최적화 기능을 개발 중이며, 자동 저장 및 복원 기능의 개선을 진행하고 있습니다. 

### 링크 연결 기능 개선 현황 (2024년 최신)
1. **마크다운 편집 개선**:
   - 마크다운 서식 제거 기능 추가
   - 상단 바 UI 개선 (새로고침 버튼 제거, 기능 버튼 에디터 패널로 이동)
   - 자동 저장 기능 강화 (페이지 새로고침/종료 시 콘텐츠 보존)

2. **AI 통합 기능 개선**:
   - 문서별 AI 대화 내용 저장 및 복원 구현
   - 문서 삭제 시 에디터/AI 패널 자동 초기화

3. **링크 생성 시스템 고도화**:
   - 링크 버튼 UI 개선 (선택 텍스트 아래 중앙에 원형 아이콘 배치)
   - 링크 아이콘 크기 확대 (16px → 24px)
   - 텍스트 선택 시 링크 버튼 표시 문제 해결
   - localStorage 활용한 로컬 문서 검색 구현
   - 선택된 텍스트가 유지되지 않는 문제 해결
   - WYSIWYG 모드에서 실제 하이퍼링크 삽입 구현 (마크다운 형식 대신)

### 다음 단계 계획
1. **벡터 검색 통합**:
   - 문서 임베딩 생성 및 저장 시스템 구현
   - 유사도 기반 검색 기능 개발
   - 키워드 검색과 벡터 검색을 결합한 하이브리드 검색 시스템 구축
   - **기존 AI 패널 활용 전략**:
     * 별도 시스템 구축 대신 Claude와 연동된 기존 AI 패널 확장
     * AI 질문에 사용되는 컨텍스트 검색 메커니즘을 링크 검색에도 활용
     * 문서 검색 시 AI 패널의 검색 로직과 연동하여 효율성 증대
     * 동일한 인덱싱 및 임베딩 시스템을 AI 응답과 문서 검색에 공유 활용

// 제목이 비어있는 경우에만 첫 줄에서 제목 자동 추출
if (!title && content) {
  // 첫 번째 헤더 라인 찾기 (# 으로 시작하는 라인)
  const titleMatch = content.match(/^#\s+(.+)$/m);
  if (titleMatch && titleMatch[1]) {
    setTitle(titleMatch[1]);
  }
} 