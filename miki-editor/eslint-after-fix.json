[{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__mocks__\\@testing-library\\react.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__mocks__\\fileMock.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__tests__\\hooks\\useAutoSave.test.js","messages":[{"ruleId":"react/display-name","severity":2,"message":"Component definition is missing display name","line":26,"column":10,"nodeType":"ArrowFunctionExpression","messageId":"noDisplayName","endLine":30,"endColumn":4},{"ruleId":"no-unused-vars","severity":1,"message":"'mockOnSaveStart' is assigned a value but never used.","line":34,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'mockOnSaveSuccess' is assigned a value but never used.","line":35,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'mockOnSaveError' is assigned a value but never used.","line":36,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":36,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { renderHook, act } from '@testing-library/react';\r\nimport { QueryClient, QueryClientProvider } from '@tanstack/react-query';\r\nimport useAutoSave from '../../hooks/useAutoSave';\r\n\r\n// useSaveDocument í›… ëª¨í‚¹\r\nconst mockMutateAsync = jest.fn();\r\n\r\njest.mock('../../hooks/useDocuments', () => ({\r\n  useSaveDocument: () => ({\r\n    mutateAsync: mockMutateAsync\r\n  })\r\n}));\r\n\r\n// íƒ€ì´ë¨¸ ëª¨í‚¹\r\njest.useFakeTimers();\r\n\r\n// QueryClient ë˜í¼ ìƒì„±\r\nconst createWrapper = () => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: { retry: false },\r\n      mutations: { retry: false }\r\n    }\r\n  });\r\n  \r\n  return ({ children }) => (\r\n    <QueryClientProvider client={queryClient}>\r\n      {children}\r\n    </QueryClientProvider>\r\n  );\r\n};\r\n\r\ndescribe('useAutoSave', () => {\r\n  let mockOnSaveStart;\r\n  let mockOnSaveSuccess;\r\n  let mockOnSaveError;\r\n\r\n  beforeEach(() => {\r\n    // ëª¨í‚¹ëœ í•¨ìˆ˜ë“¤ ì´ˆê¸°í™”\r\n    mockMutateAsync.mockClear();\r\n    \r\n    mockOnSaveStart = jest.fn();\r\n    mockOnSaveSuccess = jest.fn();\r\n    mockOnSaveError = jest.fn();\r\n    \r\n    jest.clearAllTimers();\r\n  });\r\n\r\n  afterEach(() => {\r\n    jest.clearAllMocks();\r\n  });\r\n\r\n  describe('ì´ˆê¸° ìƒíƒœ', () => {\r\n    test('ì´ˆê¸° ìƒíƒœê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ì•¼ í•¨', () => {\r\n      const { result } = renderHook(\r\n        () => useAutoSave({\r\n          document: null,\r\n          content: '',\r\n          title: '',\r\n          enabled: true\r\n        }),\r\n        { wrapper: createWrapper() }\r\n      );\r\n\r\n      expect(result.current.saveStatus).toBe('saved');\r\n      expect(result.current.hasUnsavedChanges).toBe(false);\r\n      expect(result.current.lastSaved).toBeNull();\r\n      expect(result.current.isAutoSaving).toBe(false);\r\n      expect(result.current.isManualSaving).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('ë³€ê²½ì‚¬í•­ ê°ì§€', () => {\r\n    test('ë‚´ìš© ë³€ê²½ ì‹œ unsaved ìƒíƒœê°€ ë˜ì–´ì•¼ í•¨', () => {\r\n      const testDocument = {\r\n        id: 'test-1',\r\n        title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n        content: 'ì´ˆê¸° ë‚´ìš©'\r\n      };\r\n\r\n      const { result, rerender } = renderHook(\r\n        ({ content }) => useAutoSave({\r\n          document: testDocument,\r\n          content,\r\n          title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n          enabled: true\r\n        }),\r\n        { \r\n          wrapper: createWrapper(),\r\n          initialProps: { content: 'ì´ˆê¸° ë‚´ìš©' }\r\n        }\r\n      );\r\n\r\n      expect(result.current.hasUnsavedChanges).toBe(false);\r\n\r\n      // ë‚´ìš© ë³€ê²½\r\n      rerender({ content: 'ë³€ê²½ëœ ë‚´ìš©' });\r\n\r\n      expect(result.current.hasUnsavedChanges).toBe(true);\r\n      expect(result.current.saveStatus).toBe('pending');\r\n    });\r\n\r\n    test('ì œëª© ë³€ê²½ ì‹œ unsaved ìƒíƒœê°€ ë˜ì–´ì•¼ í•¨', () => {\r\n      const testDocument = {\r\n        id: 'test-1',\r\n        title: 'ì´ˆê¸° ì œëª©',\r\n        content: 'ë‚´ìš©'\r\n      };\r\n\r\n      const { result, rerender } = renderHook(\r\n        ({ title }) => useAutoSave({\r\n          document: testDocument,\r\n          content: 'ë‚´ìš©',\r\n          title,\r\n          enabled: true\r\n        }),\r\n        { \r\n          wrapper: createWrapper(),\r\n          initialProps: { title: 'ì´ˆê¸° ì œëª©' }\r\n        }\r\n      );\r\n\r\n      expect(result.current.hasUnsavedChanges).toBe(false);\r\n\r\n      // ì œëª© ë³€ê²½\r\n      rerender({ title: 'ë³€ê²½ëœ ì œëª©' });\r\n\r\n      expect(result.current.hasUnsavedChanges).toBe(true);\r\n      expect(result.current.saveStatus).toBe('pending');\r\n    });\r\n  });\r\n\r\n  describe('ìë™ ì €ì¥', () => {\r\n    test('ë³€ê²½ì‚¬í•­ ê°ì§€ê°€ ì •ìƒ ì‘ë™í•´ì•¼ í•¨', () => {\r\n      const testDocument = {\r\n        id: 'test-1',\r\n        title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n        content: 'ì´ˆê¸° ë‚´ìš©'\r\n      };\r\n\r\n      const { result, rerender } = renderHook(\r\n        ({ content }) => useAutoSave({\r\n          document: testDocument,\r\n          content,\r\n          title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n          enabled: true,\r\n          interval: 3000\r\n        }),\r\n        { \r\n          wrapper: createWrapper(),\r\n          initialProps: { content: 'ì´ˆê¸° ë‚´ìš©' }\r\n        }\r\n      );\r\n\r\n      // ë‚´ìš© ë³€ê²½\r\n      rerender({ content: 'ë³€ê²½ëœ ë‚´ìš©' });\r\n      expect(result.current.hasUnsavedChanges).toBe(true);\r\n      expect(result.current.saveStatus).toBe('pending');\r\n    });\r\n\r\n    test('ìë™ ì €ì¥ì´ ë¹„í™œì„±í™”ë˜ë©´ ì €ì¥ë˜ì§€ ì•Šì•„ì•¼ í•¨', () => {\r\n      const testDocument = {\r\n        id: 'test-1',\r\n        title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n        content: 'ì´ˆê¸° ë‚´ìš©'\r\n      };\r\n\r\n      const { result, rerender } = renderHook(\r\n        ({ content }) => useAutoSave({\r\n          document: testDocument,\r\n          content,\r\n          title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n          enabled: false, // ë¹„í™œì„±í™”\r\n          interval: 3000\r\n        }),\r\n        { \r\n          wrapper: createWrapper(),\r\n          initialProps: { content: 'ì´ˆê¸° ë‚´ìš©' }\r\n        }\r\n      );\r\n\r\n      // ë‚´ìš© ë³€ê²½\r\n      rerender({ content: 'ë³€ê²½ëœ ë‚´ìš©' });\r\n      // enabledê°€ falseì´ë¯€ë¡œ hasUnsavedChangesëŠ” ì—¬ì „íˆ trueê°€ ë˜ì§€ë§Œ ìë™ì €ì¥ì€ ì•ˆë¨\r\n      expect(result.current.hasUnsavedChanges).toBe(true);\r\n\r\n      // 3ì´ˆ ê²½ê³¼\r\n      act(() => {\r\n        jest.advanceTimersByTime(3000);\r\n      });\r\n\r\n      expect(mockMutateAsync).not.toHaveBeenCalled();\r\n    });\r\n  });\r\n\r\n  describe('ìˆ˜ë™ ì €ì¥', () => {\r\n    test('ìˆ˜ë™ ì €ì¥ í•¨ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ í•¨', () => {\r\n      const testDocument = {\r\n        id: 'test-1',\r\n        title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n        content: 'ë‚´ìš©'\r\n      };\r\n\r\n      const { result } = renderHook(\r\n        () => useAutoSave({\r\n          document: testDocument,\r\n          content: 'ë³€ê²½ëœ ë‚´ìš©',\r\n          title: 'í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',\r\n          enabled: true\r\n        }),\r\n        { wrapper: createWrapper() }\r\n      );\r\n\r\n      expect(typeof result.current.manualSave).toBe('function');\r\n    });\r\n  });\r\n\r\n  describe('ì €ì¥ ìƒíƒœ ë©”ì‹œì§€', () => {\r\n    test('ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ í•¨ìˆ˜ê°€ ì¡´ì¬í•´ì•¼ í•¨', () => {\r\n      const { result } = renderHook(\r\n        () => useAutoSave({\r\n          document: { id: 'test' },\r\n          content: 'ë‚´ìš©',\r\n          title: 'ì œëª©',\r\n          enabled: true\r\n        }),\r\n        { wrapper: createWrapper() }\r\n      );\r\n\r\n      expect(typeof result.current.getSaveStatusMessage).toBe('function');\r\n      expect(result.current.getSaveStatusMessage()).toBe('ì €ì¥ë¨');\r\n    });\r\n  });\r\n\r\n  describe('í˜ì´ì§€ ì´íƒˆ ê²½ê³ ', () => {\r\n    test('beforeunload ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë ¨ ê¸°ëŠ¥ì´ ì‘ë™í•´ì•¼ í•¨', () => {\r\n      const { unmount } = renderHook(\r\n        () => useAutoSave({\r\n          document: { id: 'test' },\r\n          content: 'ë‚´ìš©',\r\n          title: 'ì œëª©',\r\n          enabled: true\r\n        }),\r\n        { wrapper: createWrapper() }\r\n      );\r\n\r\n      // ì»´í¬ë„ŒíŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ ë§ˆìš´íŠ¸ë˜ê³  ì–¸ë§ˆìš´íŠ¸ë˜ëŠ”ì§€ í™•ì¸\r\n      expect(() => unmount()).not.toThrow();\r\n    });\r\n  });\r\n}); ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__tests__\\hooks\\useKeyboardShortcuts.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__tests__\\stores\\documentStore.test.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\__tests__\\utils\\errorHandler.test.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":11,"column":30,"nodeType":"MemberExpression","messageId":"unexpected","endLine":11,"endColumn":43},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":13,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":13,"endColumn":16},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":17,"column":3,"nodeType":"MemberExpression","messageId":"unexpected","endLine":17,"endColumn":16},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":127,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":127,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":150,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":150,"endColumn":27},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":211,"column":14,"nodeType":"MemberExpression","messageId":"unexpected","endLine":211,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\r\n  ErrorTypes,\r\n  classifyError,\r\n  getErrorMessage,\r\n  logError,\r\n  isRetryableError,\r\n  isOfflineError\r\n} from '../../utils/errorHandler';\r\n\r\n// ì½˜ì†” ì—ëŸ¬ ëª¨í‚¹\r\nconst originalConsoleError = console.error;\r\nbeforeEach(() => {\r\n  console.error = jest.fn();\r\n});\r\n\r\nafterEach(() => {\r\n  console.error = originalConsoleError;\r\n});\r\n\r\ndescribe('ErrorHandler', () => {\r\n  describe('ErrorTypes', () => {\r\n    test('ëª¨ë“  ì—ëŸ¬ íƒ€ì…ì´ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {\r\n      expect(ErrorTypes.NETWORK_ERROR).toBe('NETWORK_ERROR');\r\n      expect(ErrorTypes.SERVER_ERROR).toBe('SERVER_ERROR');\r\n      expect(ErrorTypes.NOT_FOUND).toBe('NOT_FOUND');\r\n      expect(ErrorTypes.VALIDATION_ERROR).toBe('VALIDATION_ERROR');\r\n      expect(ErrorTypes.UNKNOWN_ERROR).toBe('UNKNOWN_ERROR');\r\n    });\r\n  });\r\n\r\n  describe('classifyError', () => {\r\n    test('null/undefined ì—ëŸ¬ëŠ” UNKNOWN_ERRORë¡œ ë¶„ë¥˜ë˜ì–´ì•¼ í•¨', () => {\r\n      expect(classifyError(null)).toBe(ErrorTypes.UNKNOWN_ERROR);\r\n      expect(classifyError(undefined)).toBe(ErrorTypes.UNKNOWN_ERROR);\r\n    });\r\n\r\n    test('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¥˜í•´ì•¼ í•¨', () => {\r\n      const networkError = new TypeError('Failed to fetch');\r\n      expect(classifyError(networkError)).toBe(ErrorTypes.NETWORK_ERROR);\r\n    });\r\n\r\n    test('HTTP 404 ì—ëŸ¬ë¥¼ NOT_FOUNDë¡œ ë¶„ë¥˜í•´ì•¼ í•¨', () => {\r\n      const notFoundError = new Error('HTTP 404: Not Found');\r\n      expect(classifyError(notFoundError)).toBe(ErrorTypes.NOT_FOUND);\r\n    });\r\n\r\n    test('HTTP 4xx ì—ëŸ¬ë¥¼ VALIDATION_ERRORë¡œ ë¶„ë¥˜í•´ì•¼ í•¨', () => {\r\n      const validationError = new Error('HTTP 400: Bad Request');\r\n      expect(classifyError(validationError)).toBe(ErrorTypes.VALIDATION_ERROR);\r\n      \r\n      const unauthorizedError = new Error('HTTP 401: Unauthorized');\r\n      expect(classifyError(unauthorizedError)).toBe(ErrorTypes.VALIDATION_ERROR);\r\n    });\r\n\r\n    test('HTTP 5xx ì—ëŸ¬ë¥¼ SERVER_ERRORë¡œ ë¶„ë¥˜í•´ì•¼ í•¨', () => {\r\n      const serverError = new Error('HTTP 500: Internal Server Error');\r\n      expect(classifyError(serverError)).toBe(ErrorTypes.SERVER_ERROR);\r\n      \r\n      const badGatewayError = new Error('HTTP 502: Bad Gateway');\r\n      expect(classifyError(badGatewayError)).toBe(ErrorTypes.SERVER_ERROR);\r\n    });\r\n\r\n    test('íŠ¹ì • ë©”ì‹œì§€ íŒ¨í„´ì„ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¥˜í•´ì•¼ í•¨', () => {\r\n      const notFoundError = new Error('ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');\r\n      expect(classifyError(notFoundError)).toBe(ErrorTypes.NOT_FOUND);\r\n    });\r\n\r\n    test('ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬ëŠ” UNKNOWN_ERRORë¡œ ë¶„ë¥˜ë˜ì–´ì•¼ í•¨', () => {\r\n      const unknownError = new Error('Something went wrong');\r\n      expect(classifyError(unknownError)).toBe(ErrorTypes.UNKNOWN_ERROR);\r\n    });\r\n  });\r\n\r\n  describe('getErrorMessage', () => {\r\n    test('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•´ì•¼ í•¨', () => {\r\n      const networkError = new TypeError('Failed to fetch');\r\n      const errorMessage = getErrorMessage(networkError);\r\n\r\n      expect(errorMessage.title).toBe('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜');\r\n      expect(errorMessage.message).toBe('ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');\r\n      expect(errorMessage.action).toBe('ë‹¤ì‹œ ì‹œë„');\r\n      expect(errorMessage.canRetry).toBe(true);\r\n      expect(errorMessage.originalError).toBe(networkError);\r\n      expect(errorMessage.timestamp).toBeDefined();\r\n    });\r\n\r\n    test('ì„œë²„ ì—ëŸ¬ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•´ì•¼ í•¨', () => {\r\n      const serverError = new Error('HTTP 500: Internal Server Error');\r\n      const errorMessage = getErrorMessage(serverError);\r\n\r\n      expect(errorMessage.title).toBe('ì„œë²„ ì˜¤ë¥˜');\r\n      expect(errorMessage.message).toBe('ì„œë²„ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');\r\n      expect(errorMessage.canRetry).toBe(true);\r\n    });\r\n\r\n    test('NOT_FOUND ì—ëŸ¬ì— ëŒ€í•œ ë©”ì‹œì§€ë¥¼ ë°˜í™˜í•´ì•¼ í•¨', () => {\r\n      const notFoundError = new Error('HTTP 404: Not Found');\r\n      const errorMessage = getErrorMessage(notFoundError);\r\n\r\n      expect(errorMessage.title).toBe('ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');\r\n      expect(errorMessage.message).toBe('ìš”ì²­í•œ ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');\r\n      expect(errorMessage.canRetry).toBe(false);\r\n    });\r\n\r\n    test('ì»¨í…ìŠ¤íŠ¸ë³„ ë©”ì‹œì§€ ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ì‘ë™í•´ì•¼ í•¨', () => {\r\n      const error = new Error('HTTP 500: Internal Server Error');\r\n      \r\n      const saveErrorMessage = getErrorMessage(error, 'save');\r\n      expect(saveErrorMessage.message).toContain('ë¬¸ì„œ ì €ì¥ ì¤‘');\r\n      \r\n      const loadErrorMessage = getErrorMessage(error, 'load');\r\n      expect(loadErrorMessage.message).toContain('ë¬¸ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì¤‘');\r\n      \r\n      const deleteErrorMessage = getErrorMessage(error, 'delete');\r\n      expect(deleteErrorMessage.message).toContain('ë¬¸ì„œ ì‚­ì œ ì¤‘');\r\n    });\r\n  });\r\n\r\n  describe('logError', () => {\r\n    test('ê°œë°œ í™˜ê²½ì—ì„œ ì½˜ì†”ì— ì—ëŸ¬ë¥¼ ë¡œê¹…í•´ì•¼ í•¨', () => {\r\n      const originalEnv = process.env.NODE_ENV;\r\n      process.env.NODE_ENV = 'development';\r\n\r\n      const testError = new Error('í…ŒìŠ¤íŠ¸ ì—ëŸ¬');\r\n      const logData = logError(testError, 'test', { extra: 'info' });\r\n\r\n      expect(console.error).toHaveBeenCalledWith('ğŸš¨ Error logged:', expect.objectContaining({\r\n        title: expect.any(String),\r\n        message: expect.any(String),\r\n        context: 'test',\r\n        additionalInfo: { extra: 'info' },\r\n        userAgent: expect.any(String),\r\n        url: expect.any(String),\r\n        timestamp: expect.any(String)\r\n      }));\r\n\r\n      expect(logData.context).toBe('test');\r\n      expect(logData.additionalInfo).toEqual({ extra: 'info' });\r\n\r\n      process.env.NODE_ENV = originalEnv;\r\n    });\r\n\r\n    test('í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì½˜ì†” ë¡œê¹…ì„ í•˜ì§€ ì•Šì•„ì•¼ í•¨', () => {\r\n      const originalEnv = process.env.NODE_ENV;\r\n      process.env.NODE_ENV = 'production';\r\n\r\n      const testError = new Error('í…ŒìŠ¤íŠ¸ ì—ëŸ¬');\r\n      logError(testError);\r\n\r\n      expect(console.error).not.toHaveBeenCalled();\r\n\r\n      process.env.NODE_ENV = originalEnv;\r\n    });\r\n  });\r\n\r\n  describe('isRetryableError', () => {\r\n    test('ì¬ì‹œë„ ê°€ëŠ¥í•œ ì—ëŸ¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒë‹¨í•´ì•¼ í•¨', () => {\r\n      const networkError = new TypeError('Failed to fetch');\r\n      expect(isRetryableError(networkError)).toBe(true);\r\n\r\n      const serverError = new Error('HTTP 500: Internal Server Error');\r\n      expect(isRetryableError(serverError)).toBe(true);\r\n\r\n      const unknownError = new Error('Something went wrong');\r\n      expect(isRetryableError(unknownError)).toBe(true);\r\n    });\r\n\r\n    test('ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì—ëŸ¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒë‹¨í•´ì•¼ í•¨', () => {\r\n      const notFoundError = new Error('HTTP 404: Not Found');\r\n      expect(isRetryableError(notFoundError)).toBe(false);\r\n\r\n      const validationError = new Error('HTTP 400: Bad Request');\r\n      expect(isRetryableError(validationError)).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('isOfflineError', () => {\r\n    test('ì˜¤í”„ë¼ì¸ ì—ëŸ¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ íŒë‹¨í•´ì•¼ í•¨', () => {\r\n      const networkError = new TypeError('Failed to fetch');\r\n      expect(isOfflineError(networkError)).toBe(true);\r\n\r\n      const serverError = new Error('HTTP 500: Internal Server Error');\r\n      expect(isOfflineError(serverError)).toBe(false);\r\n    });\r\n  });\r\n\r\n  describe('í†µí•© ì‹œë‚˜ë¦¬ì˜¤', () => {\r\n    test('ì „ì²´ ì—ëŸ¬ ì²˜ë¦¬ í”Œë¡œìš°ê°€ ì •ìƒ ì‘ë™í•´ì•¼ í•¨', () => {\r\n      const originalEnv = process.env.NODE_ENV;\r\n      process.env.NODE_ENV = 'development';\r\n\r\n      // 1. ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë°œìƒ\r\n      const networkError = new TypeError('Failed to fetch');\r\n      \r\n      // 2. ì—ëŸ¬ ë¶„ë¥˜\r\n      const errorType = classifyError(networkError);\r\n      expect(errorType).toBe(ErrorTypes.NETWORK_ERROR);\r\n      \r\n      // 3. ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ ìƒì„±\r\n      const errorMessage = getErrorMessage(networkError, 'save');\r\n      expect(errorMessage.title).toBe('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜');\r\n      expect(errorMessage.message).toContain('ë¬¸ì„œ ì €ì¥ ì¤‘');\r\n      expect(errorMessage.canRetry).toBe(true);\r\n      \r\n      // 4. ì¬ì‹œë„ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸\r\n      expect(isRetryableError(networkError)).toBe(true);\r\n      expect(isOfflineError(networkError)).toBe(true);\r\n      \r\n      // 5. ì—ëŸ¬ ë¡œê¹…\r\n      const logData = logError(networkError, 'save', { documentId: 'test-123' });\r\n      expect(console.error).toHaveBeenCalled();\r\n      expect(logData.context).toBe('save');\r\n      expect(logData.additionalInfo.documentId).toBe('test-123');\r\n\r\n      process.env.NODE_ENV = originalEnv;\r\n    });\r\n  });\r\n}); ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\aiUtils.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\api\\aiService.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\config\\featureFlags.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\config\\queryClient.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\hooks\\useAutoSave.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'performAutoSave'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [content, title, enabled, interval, performAutoSave]","fix":{"range":[1527,1562],"text":"[content, title, enabled, interval, performAutoSave]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('useAutoSave');\nimport { useEffect, useRef, useCallback, useState } from 'react';\r\nimport { useSaveDocument } from './useDocuments';\r\n\r\nconst useAutoSave = ({\r\n  document,\r\n  content,\r\n  title,\r\n  enabled = true,\r\n  interval = 3000, // 3ì´ˆ\r\n  onSaveStart,\r\n  onSaveSuccess,\r\n  onSaveError\r\n}) => {\r\n  const [lastSaved, setLastSaved] = useState(null);\r\n  const [saveStatus, setSaveStatus] = useState('saved'); // 'saved', 'saving', 'pending', 'error'\r\n  const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);\r\n  \r\n  const saveTimeoutRef = useRef(null);\r\n  const lastContentRef = useRef(content);\r\n  const lastTitleRef = useRef(title);\r\n  const isManualSaveRef = useRef(false);\r\n  \r\n  const saveMutation = useSaveDocument();\r\n\r\n  // ë³€ê²½ì‚¬í•­ ê°ì§€\r\n  useEffect(() => {\r\n    const contentChanged = content !== lastContentRef.current;\r\n    const titleChanged = title !== lastTitleRef.current;\r\n    \r\n    if (contentChanged || titleChanged) {\r\n      setHasUnsavedChanges(true);\r\n      setSaveStatus('pending');\r\n      \r\n      // ì´ì „ íƒ€ì´ë¨¸ ì·¨ì†Œ\r\n      if (saveTimeoutRef.current) {\r\n        clearTimeout(saveTimeoutRef.current);\r\n      }\r\n      \r\n      // ìë™ ì €ì¥ì´ í™œì„±í™”ë˜ì–´ ìˆê³  ìˆ˜ë™ ì €ì¥ ì¤‘ì´ ì•„ë‹ ë•Œë§Œ íƒ€ì´ë¨¸ ì„¤ì •\r\n      if (enabled && !isManualSaveRef.current) {\r\n        saveTimeoutRef.current = setTimeout(() => {\r\n          performAutoSave();\r\n        }, interval);\r\n      }\r\n      \r\n      lastContentRef.current = content;\r\n      lastTitleRef.current = title;\r\n    }\r\n  }, [content, title, enabled, interval]);\r\n\r\n  // ìë™ ì €ì¥ ì‹¤í–‰\r\n  const performAutoSave = useCallback(async () => {\r\n    if (!document || !hasUnsavedChanges) return;\r\n    \r\n    try {\r\n      setSaveStatus('saving');\r\n      onSaveStart?.();\r\n      \r\n      const documentToSave = {\r\n        ...document,\r\n        content,\r\n        title,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n      \r\n      await saveMutation.mutateAsync(documentToSave);\r\n      \r\n      setHasUnsavedChanges(false);\r\n      setSaveStatus('saved');\r\n      setLastSaved(new Date());\r\n      onSaveSuccess?.();\r\n      \r\n    } catch (error) {\r\n      logger.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', error);\r\n      setSaveStatus('error');\r\n      onSaveError?.(error);\r\n    }\r\n  }, [document, content, title, hasUnsavedChanges, saveMutation, onSaveStart, onSaveSuccess, onSaveError]);\r\n\r\n  // ìˆ˜ë™ ì €ì¥\r\n  const manualSave = useCallback(async () => {\r\n    if (!document) return;\r\n    \r\n    // ìˆ˜ë™ ì €ì¥ í”Œë˜ê·¸ ì„¤ì •\r\n    isManualSaveRef.current = true;\r\n    \r\n    // ìë™ ì €ì¥ íƒ€ì´ë¨¸ ì·¨ì†Œ\r\n    if (saveTimeoutRef.current) {\r\n      clearTimeout(saveTimeoutRef.current);\r\n      saveTimeoutRef.current = null;\r\n    }\r\n    \r\n    try {\r\n      setSaveStatus('saving');\r\n      onSaveStart?.();\r\n      \r\n      const documentToSave = {\r\n        ...document,\r\n        content,\r\n        title,\r\n        updatedAt: new Date().toISOString()\r\n      };\r\n      \r\n      await saveMutation.mutateAsync(documentToSave);\r\n      \r\n      setHasUnsavedChanges(false);\r\n      setSaveStatus('saved');\r\n      setLastSaved(new Date());\r\n      onSaveSuccess?.();\r\n      \r\n    } catch (error) {\r\n      logger.error('ìˆ˜ë™ ì €ì¥ ì‹¤íŒ¨:', error);\r\n      setSaveStatus('error');\r\n      onSaveError?.(error);\r\n    } finally {\r\n      // ìˆ˜ë™ ì €ì¥ í”Œë˜ê·¸ í•´ì œ\r\n      isManualSaveRef.current = false;\r\n    }\r\n  }, [document, content, title, saveMutation, onSaveStart, onSaveSuccess, onSaveError]);\r\n\r\n  // ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ ìƒì„±\r\n  const getSaveStatusMessage = useCallback(() => {\r\n    switch (saveStatus) {\r\n      case 'saving':\r\n        return 'ì €ì¥ ì¤‘...';\r\n      case 'pending':\r\n        return 'ë³€ê²½ë¨';\r\n      case 'error':\r\n        return 'ì €ì¥ ì‹¤íŒ¨';\r\n      case 'saved':\r\n        if (lastSaved) {\r\n          const now = new Date();\r\n          const diffMs = now - lastSaved;\r\n          const diffMinutes = Math.floor(diffMs / 60000);\r\n          \r\n          if (diffMinutes < 1) {\r\n            return 'ë°©ê¸ˆ ì €ì¥ë¨';\r\n          } else if (diffMinutes < 60) {\r\n            return `${diffMinutes}ë¶„ ì „ ì €ì¥ë¨`;\r\n          } else {\r\n            return lastSaved.toLocaleTimeString('ko-KR', {\r\n              hour: '2-digit',\r\n              minute: '2-digit'\r\n            }) + ' ì €ì¥ë¨';\r\n          }\r\n        }\r\n        return 'ì €ì¥ë¨';\r\n      default:\r\n        return 'ì €ì¥ë¨';\r\n    }\r\n  }, [saveStatus, lastSaved]);\r\n\r\n  // ì»´í¬ë„ŒíŠ¸ ì–¸ë§ˆìš´íŠ¸ ì‹œ ì •ë¦¬\r\n  useEffect(() => {\r\n    return () => {\r\n      if (saveTimeoutRef.current) {\r\n        clearTimeout(saveTimeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // í˜ì´ì§€ ì´íƒˆ ì‹œ ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ ê²½ê³ \r\n  useEffect(() => {\r\n    const handleBeforeUnload = (event) => {\r\n      if (hasUnsavedChanges) {\r\n        event.preventDefault();\r\n        event.returnValue = 'ì €ì¥ë˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‚˜ê°€ì‹œê² ìŠµë‹ˆê¹Œ?';\r\n        return event.returnValue;\r\n      }\r\n    };\r\n\r\n    window.addEventListener('beforeunload', handleBeforeUnload);\r\n    \r\n    return () => {\r\n      window.removeEventListener('beforeunload', handleBeforeUnload);\r\n    };\r\n  }, [hasUnsavedChanges]);\r\n\r\n  return {\r\n    saveStatus,\r\n    hasUnsavedChanges,\r\n    lastSaved,\r\n    manualSave,\r\n    getSaveStatusMessage,\r\n    isAutoSaving: saveStatus === 'saving' && !isManualSaveRef.current,\r\n    isManualSaving: saveStatus === 'saving' && isManualSaveRef.current,\r\n  };\r\n};\r\n\r\nexport default useAutoSave; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\hooks\\useDocuments.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'queryClient' is assigned a value but never used.","line":127,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":127,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'variables' is defined but never used. Allowed unused args must match /^_/u.","line":284,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":284,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'context' is defined but never used. Allowed unused args must match /^_/u.","line":284,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":284,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('useDocuments');\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { queryKeys, handleQueryError, isOnline } from '../config/queryClient';\r\nimport { useDocumentStore } from '../stores';\r\nimport { MikiDatabase } from '../utils/database';\r\n\r\n// API í•¨ìˆ˜ë“¤\r\nconst documentAPI = {\r\n  // ì„œë²„ì—ì„œ ë¬¸ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\r\n  async fetchDocuments() {\r\n    try {\r\n      const response = await fetch('/api/posts');\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      return await response.json();\r\n    } catch (error) {\r\n      logger.error('ì„œë²„ì—ì„œ ë¬¸ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // ì„œë²„ì—ì„œ íŠ¹ì • ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°\r\n  async fetchDocument(id) {\r\n    try {\r\n      const response = await fetch(`/api/posts/${id}`);\r\n      if (!response.ok) {\r\n        if (response.status === 404) {\r\n          throw new Error('ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\r\n        }\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n      return await response.json();\r\n    } catch (error) {\r\n      logger.error(`ì„œë²„ì—ì„œ ë¬¸ì„œ ${id} ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:`, error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // ì„œë²„ì— ë¬¸ì„œ ì €ì¥\r\n  async saveDocument(document) {\r\n    try {\r\n      const method = document.id ? 'PUT' : 'POST';\r\n      const url = document.id ? `/api/posts/${document.id}` : '/api/posts';\r\n      \r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify(document),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      return await response.json();\r\n    } catch (error) {\r\n      logger.error('ì„œë²„ì— ë¬¸ì„œ ì €ì¥ ì‹¤íŒ¨:', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // ì„œë²„ì—ì„œ ë¬¸ì„œ ì‚­ì œ\r\n  async deleteDocument(id) {\r\n    try {\r\n      const response = await fetch(`/api/posts/${id}`, {\r\n        method: 'DELETE',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\r\n      }\r\n\r\n      return { success: true, id };\r\n    } catch (error) {\r\n      logger.error(`ì„œë²„ì—ì„œ ë¬¸ì„œ ${id} ì‚­ì œ ì‹¤íŒ¨:`, error);\r\n      throw error;\r\n    }\r\n  },\r\n};\r\n\r\n// IndexedDB í•¨ìˆ˜ë“¤\r\nconst localAPI = {\r\n  async getDocuments() {\r\n    const db = await MikiDatabase.getInstance();\r\n    return await db.documents.orderBy('updatedAt').reverse().toArray();\r\n  },\r\n\r\n  async getDocument(id) {\r\n    const db = await MikiDatabase.getInstance();\r\n    return await db.documents.get(id);\r\n  },\r\n\r\n  async saveDocument(document) {\r\n    const db = await MikiDatabase.getInstance();\r\n    const now = new Date().toISOString();\r\n    \r\n    const docToSave = {\r\n      ...document,\r\n      updatedAt: now,\r\n      syncStatus: 'pending', // ì„œë²„ ë™ê¸°í™” ëŒ€ê¸° ìƒíƒœ\r\n    };\r\n\r\n    if (document.id) {\r\n      await db.documents.put(docToSave);\r\n    } else {\r\n      const id = `doc-${Date.now()}`;\r\n      docToSave.id = id;\r\n      await db.documents.add(docToSave);\r\n    }\r\n\r\n    return docToSave;\r\n  },\r\n\r\n  async deleteDocument(id) {\r\n    const db = await MikiDatabase.getInstance();\r\n    await db.documents.delete(id);\r\n    return { success: true, id };\r\n  },\r\n};\r\n\r\n// 1. ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ í›…\r\nexport const useDocuments = () => {\r\n  const queryClient = useQueryClient();\r\n\r\n  return useQuery({\r\n    queryKey: queryKeys.documents.lists(),\r\n    queryFn: async () => {\r\n      // ì˜¨ë¼ì¸ ìƒíƒœì—ì„œëŠ” ì„œë²„ ë°ì´í„° ìš°ì„ \r\n      if (isOnline()) {\r\n        try {\r\n          const serverDocs = await documentAPI.fetchDocuments();\r\n          \r\n          // ì„œë²„ ë°ì´í„°ë¥¼ IndexedDBì— ìºì‹œ\r\n          const db = await MikiDatabase.getInstance();\r\n          for (const doc of serverDocs) {\r\n            await db.documents.put({\r\n              ...doc,\r\n              syncStatus: 'synced',\r\n            });\r\n          }\r\n          \r\n          return serverDocs;\r\n        } catch (error) {\r\n          logger.warn('ì„œë²„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©:', error);\r\n        }\r\n      }\r\n      \r\n      // ì˜¤í”„ë¼ì¸ì´ê±°ë‚˜ ì„œë²„ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©\r\n      return await localAPI.getDocuments();\r\n    },\r\n    staleTime: 2 * 60 * 1000, // 2ë¶„\r\n    cacheTime: 10 * 60 * 1000, // 10ë¶„\r\n  });\r\n};\r\n\r\n// 2. íŠ¹ì • ë¬¸ì„œ ì¡°íšŒ í›…\r\nexport const useDocument = (id) => {\r\n  return useQuery({\r\n    queryKey: queryKeys.documents.detail(id),\r\n    queryFn: async () => {\r\n      if (!id) return null;\r\n\r\n      // ì˜¨ë¼ì¸ ìƒíƒœì—ì„œëŠ” ì„œë²„ ë°ì´í„° ìš°ì„ \r\n      if (isOnline()) {\r\n        try {\r\n          const serverDoc = await documentAPI.fetchDocument(id);\r\n          \r\n          // ì„œë²„ ë°ì´í„°ë¥¼ IndexedDBì— ìºì‹œ\r\n          const db = await MikiDatabase.getInstance();\r\n          await db.documents.put({\r\n            ...serverDoc,\r\n            syncStatus: 'synced',\r\n          });\r\n          \r\n          return serverDoc;\r\n        } catch (error) {\r\n          logger.warn(`ì„œë²„ì—ì„œ ë¬¸ì„œ ${id} ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨, ë¡œì»¬ ë°ì´í„° ì‚¬ìš©:`, error);\r\n        }\r\n      }\r\n      \r\n      // ì˜¤í”„ë¼ì¸ì´ê±°ë‚˜ ì„œë²„ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©\r\n      return await localAPI.getDocument(id);\r\n    },\r\n    enabled: !!id,\r\n    staleTime: 5 * 60 * 1000, // 5ë¶„\r\n  });\r\n};\r\n\r\n// 3. ë¬¸ì„œ ì €ì¥ ë®¤í…Œì´ì…˜ (Optimistic UI)\r\nexport const useSaveDocument = () => {\r\n  const queryClient = useQueryClient();\r\n  const { updateDocument, addDocument } = useDocumentStore();\r\n\r\n  return useMutation({\r\n    mutationFn: async (document) => {\r\n      // 1. ë¡œì»¬ì— ì¦‰ì‹œ ì €ì¥ (Optimistic)\r\n      const localDoc = await localAPI.saveDocument(document);\r\n      \r\n      // 2. ì˜¨ë¼ì¸ ìƒíƒœì—ì„œë§Œ ì„œë²„ ë™ê¸°í™” ì‹œë„\r\n      if (isOnline()) {\r\n        try {\r\n          const serverDoc = await documentAPI.saveDocument(localDoc);\r\n          \r\n          // ì„œë²„ ì €ì¥ ì„±ê³µ ì‹œ ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸\r\n          const db = await MikiDatabase.getInstance();\r\n          await db.documents.put({\r\n            ...serverDoc,\r\n            syncStatus: 'synced',\r\n          });\r\n          \r\n          return serverDoc;\r\n        } catch (error) {\r\n          logger.warn('ì„œë²„ ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì—ë§Œ ì €ì¥ë¨:', error);\r\n          \r\n          // ë™ê¸°í™” íì— ì¶”ê°€\r\n          const db = await MikiDatabase.getInstance();\r\n          await db.syncQueue.add({\r\n            id: `sync-${Date.now()}`,\r\n            type: 'save',\r\n            documentId: localDoc.id,\r\n            data: localDoc,\r\n            status: 'pending',\r\n            createdAt: new Date().toISOString(),\r\n            retryCount: 0,\r\n          });\r\n          \r\n          throw error;\r\n        }\r\n      }\r\n      \r\n      return localDoc;\r\n    },\r\n\r\n    // Optimistic Update\r\n    onMutate: async (newDocument) => {\r\n      // ì§„í–‰ ì¤‘ì¸ ì¿¼ë¦¬ ì·¨ì†Œ\r\n      await queryClient.cancelQueries({ queryKey: queryKeys.documents.all });\r\n\r\n      // ì´ì „ ë°ì´í„° ë°±ì—…\r\n      const previousDocuments = queryClient.getQueryData(queryKeys.documents.lists());\r\n      const previousDocument = newDocument.id \r\n        ? queryClient.getQueryData(queryKeys.documents.detail(newDocument.id))\r\n        : null;\r\n\r\n      // Optimistic ì—…ë°ì´íŠ¸\r\n      if (newDocument.id) {\r\n        // ê¸°ì¡´ ë¬¸ì„œ ì—…ë°ì´íŠ¸\r\n        queryClient.setQueryData(\r\n          queryKeys.documents.detail(newDocument.id),\r\n          (old) => ({ ...old, ...newDocument })\r\n        );\r\n        \r\n        queryClient.setQueryData(\r\n          queryKeys.documents.lists(),\r\n          (old) => old?.map(doc => \r\n            doc.id === newDocument.id ? { ...doc, ...newDocument } : doc\r\n          ) || []\r\n        );\r\n        \r\n        // Zustand ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸\r\n        updateDocument(newDocument.id, newDocument);\r\n      } else {\r\n        // ìƒˆ ë¬¸ì„œ ì¶”ê°€\r\n        const tempId = `temp-${Date.now()}`;\r\n        const tempDoc = { ...newDocument, id: tempId };\r\n        \r\n        queryClient.setQueryData(\r\n          queryKeys.documents.lists(),\r\n          (old) => [tempDoc, ...(old || [])]\r\n        );\r\n        \r\n        // Zustand ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸\r\n        addDocument(tempDoc);\r\n      }\r\n\r\n      return { previousDocuments, previousDocument };\r\n    },\r\n\r\n    // ì„±ê³µ ì‹œ\r\n    onSuccess: (data, variables, context) => {\r\n      // ì¿¼ë¦¬ ë¬´íš¨í™”í•˜ì—¬ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\r\n      queryClient.invalidateQueries({ queryKey: queryKeys.documents.all });\r\n      \r\n      logger.info('âœ… ë¬¸ì„œ ì €ì¥ ì„±ê³µ:', data.id);\r\n    },\r\n\r\n    // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±\r\n    onError: (error, variables, context) => {\r\n      const errorInfo = handleQueryError(error, 'ë¬¸ì„œ ì €ì¥');\r\n      \r\n      // ì´ì „ ìƒíƒœë¡œ ë¡¤ë°±\r\n      if (context?.previousDocuments) {\r\n        queryClient.setQueryData(queryKeys.documents.lists(), context.previousDocuments);\r\n      }\r\n      \r\n      if (context?.previousDocument && variables.id) {\r\n        queryClient.setQueryData(\r\n          queryKeys.documents.detail(variables.id),\r\n          context.previousDocument\r\n        );\r\n      }\r\n\r\n      logger.error('âŒ ë¬¸ì„œ ì €ì¥ ì‹¤íŒ¨:', errorInfo.message);\r\n      \r\n      // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ (í† ìŠ¤íŠ¸ ë“±)\r\n      // ì´ ë¶€ë¶„ì€ ì‹¤ì œ ì•Œë¦¼ ì‹œìŠ¤í…œê³¼ ì—°ê²°\r\n    },\r\n\r\n    // ì™„ë£Œ ì‹œ (ì„±ê³µ/ì‹¤íŒ¨ ë¬´ê´€)\r\n    onSettled: () => {\r\n      // ê´€ë ¨ ì¿¼ë¦¬ ë¦¬íŒ¨ì¹˜\r\n      queryClient.invalidateQueries({ queryKey: queryKeys.documents.all });\r\n    },\r\n  });\r\n};\r\n\r\n// 4. ë¬¸ì„œ ì‚­ì œ ë®¤í…Œì´ì…˜ (Optimistic UI)\r\nexport const useDeleteDocument = () => {\r\n  const queryClient = useQueryClient();\r\n  const { deleteDocument } = useDocumentStore();\r\n\r\n  return useMutation({\r\n    mutationFn: async (id) => {\r\n      // 1. ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ì‚­ì œ (Optimistic)\r\n      const localResult = await localAPI.deleteDocument(id);\r\n      \r\n      // 2. ì˜¨ë¼ì¸ ìƒíƒœì—ì„œë§Œ ì„œë²„ ë™ê¸°í™” ì‹œë„\r\n      if (isOnline()) {\r\n        try {\r\n          return await documentAPI.deleteDocument(id);\r\n        } catch (error) {\r\n          logger.warn('ì„œë²„ ì‚­ì œ ì‹¤íŒ¨, ë¡œì»¬ì—ë§Œ ì‚­ì œë¨:', error);\r\n          \r\n          // ë™ê¸°í™” íì— ì¶”ê°€\r\n          const db = await MikiDatabase.getInstance();\r\n          await db.syncQueue.add({\r\n            id: `sync-${Date.now()}`,\r\n            type: 'delete',\r\n            documentId: id,\r\n            status: 'pending',\r\n            createdAt: new Date().toISOString(),\r\n            retryCount: 0,\r\n          });\r\n          \r\n          throw error;\r\n        }\r\n      }\r\n      \r\n      return localResult;\r\n    },\r\n\r\n    // Optimistic Update\r\n    onMutate: async (id) => {\r\n      await queryClient.cancelQueries({ queryKey: queryKeys.documents.all });\r\n\r\n      // ì´ì „ ë°ì´í„° ë°±ì—…\r\n      const previousDocuments = queryClient.getQueryData(queryKeys.documents.lists());\r\n      const previousDocument = queryClient.getQueryData(queryKeys.documents.detail(id));\r\n\r\n      // Optimistic ì‚­ì œ\r\n      queryClient.setQueryData(\r\n        queryKeys.documents.lists(),\r\n        (old) => old?.filter(doc => doc.id !== id) || []\r\n      );\r\n      \r\n      queryClient.removeQueries({ queryKey: queryKeys.documents.detail(id) });\r\n      \r\n      // Zustand ìŠ¤í† ì–´ ì—…ë°ì´íŠ¸\r\n      deleteDocument(id);\r\n\r\n      return { previousDocuments, previousDocument };\r\n    },\r\n\r\n    onSuccess: (data, id) => {\r\n      queryClient.invalidateQueries({ queryKey: queryKeys.documents.all });\r\n      logger.info('âœ… ë¬¸ì„œ ì‚­ì œ ì„±ê³µ:', id);\r\n    },\r\n\r\n    onError: (error, id, context) => {\r\n      const errorInfo = handleQueryError(error, 'ë¬¸ì„œ ì‚­ì œ');\r\n      \r\n      // ë¡¤ë°±\r\n      if (context?.previousDocuments) {\r\n        queryClient.setQueryData(queryKeys.documents.lists(), context.previousDocuments);\r\n      }\r\n      \r\n      if (context?.previousDocument) {\r\n        queryClient.setQueryData(queryKeys.documents.detail(id), context.previousDocument);\r\n      }\r\n\r\n      logger.error('âŒ ë¬¸ì„œ ì‚­ì œ ì‹¤íŒ¨:', errorInfo.message);\r\n    },\r\n\r\n    onSettled: () => {\r\n      queryClient.invalidateQueries({ queryKey: queryKeys.documents.all });\r\n    },\r\n  });\r\n};\r\n\r\n// 5. ë¬¸ì„œ ê²€ìƒ‰ í›…\r\nexport const useSearchDocuments = (query) => {\r\n  return useQuery({\r\n    queryKey: queryKeys.documents.search(query),\r\n    queryFn: async () => {\r\n      if (!query || query.trim().length < 2) {\r\n        return [];\r\n      }\r\n\r\n      // ë¡œì»¬ ê²€ìƒ‰ (IndexedDB)\r\n      const db = await MikiDatabase.getInstance();\r\n      const allDocs = await db.documents.toArray();\r\n      \r\n      const searchTerm = query.toLowerCase();\r\n      return allDocs.filter(doc => \r\n        doc.title?.toLowerCase().includes(searchTerm) ||\r\n        doc.content?.toLowerCase().includes(searchTerm)\r\n      );\r\n    },\r\n    enabled: !!query && query.trim().length >= 2,\r\n    staleTime: 30 * 1000, // 30ì´ˆ\r\n  });\r\n};\r\n\r\n// 6. ë™ê¸°í™” ìƒíƒœ í›…\r\nexport const useSyncStatus = () => {\r\n  return useQuery({\r\n    queryKey: queryKeys.sync.status(),\r\n    queryFn: async () => {\r\n      const db = await MikiDatabase.getInstance();\r\n      const pendingItems = await db.syncQueue\r\n        .where('status')\r\n        .equals('pending')\r\n        .toArray();\r\n      \r\n      return {\r\n        hasPendingSync: pendingItems.length > 0,\r\n        pendingCount: pendingItems.length,\r\n        isOnline: isOnline(),\r\n      };\r\n    },\r\n    refetchInterval: 5000, // 5ì´ˆë§ˆë‹¤ ì²´í¬\r\n  });\r\n}; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\hooks\\useKeyboardShortcuts.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\hooks\\useResponsiveLayout.js","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkScreenSize'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [checkScreenSize, isMobile]","fix":{"range":[981,991],"text":"[checkScreenSize, isMobile]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\n\r\nconst useResponsiveLayout = () => {\r\n  const [isMobile, setIsMobile] = useState(false);\r\n  const [isTablet, setIsTablet] = useState(false);\r\n  const [activeMobilePanel, setActiveMobilePanel] = useState('list');\r\n  const [isFullscreen, setIsFullscreen] = useState(false);\r\n\r\n  // í™”ë©´ í¬ê¸° ê°ì§€ í•¨ìˆ˜\r\n  const checkScreenSize = () => {\r\n    const width = window.innerWidth;\r\n    const newIsMobile = width <= 768;\r\n    const newIsTablet = width > 768 && width <= 1024;\r\n    \r\n    setIsMobile(newIsMobile);\r\n    setIsTablet(newIsTablet);\r\n    \r\n    // ëª¨ë°”ì¼ì—ì„œ ë°ìŠ¤í¬í†±ìœ¼ë¡œ ì „í™˜ ì‹œ í™œì„± íŒ¨ë„ì„ ì—ë””í„°ë¡œ ì„¤ì •\r\n    if (!newIsMobile && isMobile) {\r\n      setActiveMobilePanel('editor');\r\n    }\r\n  };\r\n\r\n  // í™”ë©´ í¬ê¸° ë³€ê²½ ê°ì§€\r\n  useEffect(() => {\r\n    checkScreenSize();\r\n    \r\n    const handleResize = () => {\r\n      checkScreenSize();\r\n    };\r\n\r\n    window.addEventListener('resize', handleResize);\r\n    return () => window.removeEventListener('resize', handleResize);\r\n  }, [isMobile]);\r\n\r\n  // ì „ì²´í™”ë©´ í† ê¸€\r\n  const toggleFullscreen = () => {\r\n    setIsFullscreen(prev => !prev);\r\n  };\r\n\r\n  // ëª¨ë°”ì¼ íŒ¨ë„ ì „í™˜\r\n  const switchMobilePanel = (panel) => {\r\n    if (isMobile) {\r\n      setActiveMobilePanel(panel);\r\n    }\r\n  };\r\n\r\n  // ì—ë””í„° íŒ¨ë„ í´ë˜ìŠ¤ ê³„ì‚°\r\n  const getEditorPanelClass = () => {\r\n    if (isFullscreen) {\r\n      return \"bg-white rounded shadow flex flex-col h-full\";\r\n    }\r\n    return `bg-white rounded shadow flex flex-col ${\r\n      isMobile ? (activeMobilePanel === 'editor' ? 'block' : 'hidden') + ' flex-grow' : 'flex-1 mx-2'\r\n    }`;\r\n  };\r\n\r\n  // ë ˆì´ì•„ì›ƒ ì •ë³´ ë°˜í™˜\r\n  return {\r\n    isMobile,\r\n    isTablet,\r\n    isFullscreen,\r\n    activeMobilePanel,\r\n    setActiveMobilePanel: switchMobilePanel,\r\n    toggleFullscreen,\r\n    editorPanelClass: getEditorPanelClass()\r\n  };\r\n};\r\n\r\nexport default useResponsiveLayout; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\setupTests.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\stores\\index.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'get' is defined but never used. Allowed unused args must match /^_/u.","line":121,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":121,"endColumn":32},{"ruleId":"no-unused-vars","severity":1,"message":"'get' is defined but never used. Allowed unused args must match /^_/u.","line":167,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":167,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('index');\nimport { create } from 'zustand';\r\nimport { immer } from 'zustand/middleware/immer';\r\nimport { subscribeWithSelector } from 'zustand/middleware';\r\nimport { db } from '../utils/database';\r\n\r\n// Document slice\r\nconst createDocumentSlice = (set, get) => ({\r\n  // State\r\n  documents: {},\r\n  currentDocumentId: null,\r\n  isLoading: false,\r\n  saveStatus: 'ì €ì¥ë¨',\r\n  serverSaveStatus: 'ì €ì¥ë¨',\r\n  isSaving: false,\r\n  \r\n  // Document CRUD actions\r\n  setCurrentDocument: (id) => set((state) => {\r\n    state.currentDocumentId = id;\r\n  }),\r\n  \r\n  addDocument: (doc) => set((state) => {\r\n    state.documents[doc.id] = doc;\r\n  }),\r\n  \r\n  updateDocument: (id, updates) => set((state) => {\r\n    if (state.documents[id]) {\r\n      Object.assign(state.documents[id], updates, {\r\n        updatedAt: new Date().toISOString()\r\n      });\r\n    }\r\n  }),\r\n  \r\n  deleteDocument: (id) => set((state) => {\r\n    delete state.documents[id];\r\n    if (state.currentDocumentId === id) {\r\n      state.currentDocumentId = null;\r\n    }\r\n  }),\r\n  \r\n  // Title management with flags\r\n  setTitle: (id, title, isUserEdit = false) => set((state) => {\r\n    if (state.documents[id]) {\r\n      state.documents[id].title = title;\r\n      state.documents[id].isUserEditedTitle = isUserEdit;\r\n      state.documents[id].isAutoSyncedTitle = !isUserEdit;\r\n      state.documents[id].updatedAt = new Date().toISOString();\r\n    }\r\n  }),\r\n  \r\n  setContent: (id, content) => set((state) => {\r\n    if (state.documents[id]) {\r\n      state.documents[id].content = content;\r\n      state.documents[id].updatedAt = new Date().toISOString();\r\n      \r\n      // Auto-extract title if not user-edited\r\n      if (!state.documents[id].isUserEditedTitle) {\r\n        const extractedTitle = extractTitleFromContent(content);\r\n        if (extractedTitle && extractedTitle !== state.documents[id].title) {\r\n          state.documents[id].title = extractedTitle;\r\n          state.documents[id].isAutoSyncedTitle = true;\r\n        }\r\n      }\r\n    }\r\n  }),\r\n  \r\n  // Save status management\r\n  setSaveStatus: (status) => set((state) => {\r\n    state.saveStatus = status;\r\n  }),\r\n  \r\n  setServerSaveStatus: (status) => set((state) => {\r\n    state.serverSaveStatus = status;\r\n  }),\r\n  \r\n  setIsSaving: (saving) => set((state) => {\r\n    state.isSaving = saving;\r\n  }),\r\n  \r\n  // Async actions\r\n  loadDocuments: async () => {\r\n    set((state) => { state.isLoading = true; });\r\n    try {\r\n      const docs = await db.documents.toArray();\r\n      set((state) => {\r\n        state.documents = {};\r\n        docs.forEach(doc => {\r\n          state.documents[doc.id] = doc;\r\n        });\r\n        state.isLoading = false;\r\n      });\r\n    } catch (error) {\r\n      logger.error('ë¬¸ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);\r\n      set((state) => { state.isLoading = false; });\r\n    }\r\n  },\r\n  \r\n  saveDocument: async (id) => {\r\n    const doc = get().documents[id];\r\n    if (!doc) return;\r\n    \r\n    set((state) => { state.isSaving = true; });\r\n    try {\r\n      await db.documents.put(doc);\r\n      set((state) => { \r\n        state.saveStatus = 'ì €ì¥ë¨';\r\n        state.isSaving = false;\r\n      });\r\n    } catch (error) {\r\n      logger.error('ë¬¸ì„œ ì €ì¥ ì‹¤íŒ¨:', error);\r\n      set((state) => { \r\n        state.saveStatus = 'ì €ì¥ ì‹¤íŒ¨';\r\n        state.isSaving = false;\r\n      });\r\n    }\r\n  }\r\n});\r\n\r\n// UI slice\r\nconst createUISlice = (set, get) => ({\r\n  // State\r\n  isFullscreen: false,\r\n  searchQuery: '',\r\n  windowWidth: typeof window !== 'undefined' ? window.innerWidth : 0,\r\n  isMobile: false,\r\n  isTablet: false,\r\n  activeMobilePanel: 'editor',\r\n  message: { type: '', text: '' },\r\n  messageVisible: false,\r\n  \r\n  // Actions\r\n  setFullscreen: (fullscreen) => set((state) => {\r\n    state.isFullscreen = fullscreen;\r\n  }),\r\n  \r\n  setSearchQuery: (query) => set((state) => {\r\n    state.searchQuery = query;\r\n  }),\r\n  \r\n  setWindowDimensions: (width) => set((state) => {\r\n    state.windowWidth = width;\r\n    state.isMobile = width < 768;\r\n    state.isTablet = width >= 768 && width < 1024;\r\n  }),\r\n  \r\n  setActiveMobilePanel: (panel) => set((state) => {\r\n    state.activeMobilePanel = panel;\r\n    try {\r\n      localStorage.setItem('miki_active_mobile_panel', panel);\r\n    } catch (e) {\r\n      logger.warn('íŒ¨ë„ ìƒíƒœ ì €ì¥ ì‹¤íŒ¨:', e);\r\n    }\r\n  }),\r\n  \r\n  showMessage: (type, text) => set((state) => {\r\n    state.message = { type, text };\r\n    state.messageVisible = true;\r\n  }),\r\n  \r\n  hideMessage: () => set((state) => {\r\n    state.messageVisible = false;\r\n  })\r\n});\r\n\r\n// Editor context slice\r\nconst createEditorSlice = (set, get) => ({\r\n  // State\r\n  editorContext: {\r\n    fullContent: '',\r\n    selection: null\r\n  },\r\n  \r\n  // Actions\r\n  setEditorContext: (context) => set((state) => {\r\n    state.editorContext = context;\r\n  })\r\n});\r\n\r\n// Helper function for title extraction\r\nconst extractTitleFromContent = (content) => {\r\n  if (!content || typeof content !== 'string') return '';\r\n  \r\n  const lines = content.split('\\n');\r\n  for (const line of lines) {\r\n    const trimmed = line.trim();\r\n    if (trimmed && !trimmed.startsWith('#')) {\r\n      // Remove markdown formatting\r\n      return trimmed\r\n        .replace(/\\*\\*(.*?)\\*\\*/g, '$1')\r\n        .replace(/\\*(.*?)\\*/g, '$1')\r\n        .replace(/`(.*?)`/g, '$1')\r\n        .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1')\r\n        .replace(/!\\[([^\\]]*)\\]\\([^)]+\\)/g, '$1')\r\n        .substring(0, 50);\r\n    }\r\n  }\r\n  return '';\r\n};\r\n\r\n// Create the main store\r\nexport const useStore = create(\r\n  subscribeWithSelector(\r\n    immer((...a) => ({\r\n      ...createDocumentSlice(...a),\r\n      ...createUISlice(...a),\r\n      ...createEditorSlice(...a),\r\n      \r\n      // Reset method for testing\r\n      reset: () => a[0]((state) => {\r\n        // Reset document slice\r\n        state.documents = {};\r\n        state.currentDocumentId = null;\r\n        state.isLoading = false;\r\n        state.saveStatus = 'ì €ì¥ë¨';\r\n        state.serverSaveStatus = 'ì €ì¥ë¨';\r\n        state.isSaving = false;\r\n        \r\n        // Reset UI slice\r\n        state.isFullscreen = false;\r\n        state.searchQuery = '';\r\n        state.windowWidth = typeof window !== 'undefined' ? window.innerWidth : 0;\r\n        state.isMobile = false;\r\n        state.isTablet = false;\r\n        state.activeMobilePanel = 'editor';\r\n        state.message = { type: '', text: '' };\r\n        state.messageVisible = false;\r\n        \r\n        // Reset editor slice\r\n        state.editorContext = {\r\n          fullContent: '',\r\n          selection: null\r\n        };\r\n      })\r\n    }))\r\n  )\r\n);\r\n\r\n// Selectors for better performance\r\nexport const useCurrentDocument = () => useStore((state) => {\r\n  const currentId = state.currentDocumentId;\r\n  return currentId ? state.documents[currentId] : null;\r\n});\r\n\r\nexport const useDocumentList = () => useStore((state) => \r\n  Object.values(state.documents).sort((a, b) => \r\n    new Date(b.updatedAt) - new Date(a.updatedAt)\r\n  )\r\n);\r\n\r\nexport const useUIState = () => useStore((state) => ({\r\n  isFullscreen: state.isFullscreen,\r\n  searchQuery: state.searchQuery,\r\n  windowWidth: state.windowWidth,\r\n  isMobile: state.isMobile,\r\n  isTablet: state.isTablet,\r\n  activeMobilePanel: state.activeMobilePanel,\r\n  message: state.message,\r\n  messageVisible: state.messageVisible\r\n}));\r\n\r\n// Individual store hooks for App.jsx compatibility\r\nexport const useDocumentStore = () => useStore((state) => ({\r\n  documents: Object.values(state.documents),\r\n  currentDocument: state.currentDocumentId ? state.documents[state.currentDocumentId] : null,\r\n  setCurrentDocument: (doc) => state.setCurrentDocument(doc?.id || doc),\r\n  updateDocument: state.updateDocument,\r\n  addDocument: state.addDocument,\r\n  deleteDocument: state.deleteDocument,\r\n  loadDocuments: state.loadDocuments,\r\n}));\r\n\r\nexport const useUIStore = () => useStore((state) => ({\r\n  sidebarOpen: false, // ê¸°ë³¸ê°’\r\n  theme: 'light', // ê¸°ë³¸ê°’\r\n  isFullscreen: state.isFullscreen,\r\n  toggleSidebar: () => {}, // ê¸°ë³¸ êµ¬í˜„\r\n  setTheme: () => {}, // ê¸°ë³¸ êµ¬í˜„\r\n  toggleFullscreen: () => state.setFullscreen(!state.isFullscreen),\r\n}));\r\n\r\nexport const useEditorStore = () => useStore((state) => ({\r\n  content: state.currentDocumentId ? state.documents[state.currentDocumentId]?.content || '' : '',\r\n  title: state.currentDocumentId ? state.documents[state.currentDocumentId]?.title || '' : '',\r\n  isEditing: false, // ê¸°ë³¸ê°’\r\n  saveStatus: state.saveStatus,\r\n  setContent: (content) => {\r\n    if (state.currentDocumentId) {\r\n      state.setContent(state.currentDocumentId, content);\r\n    }\r\n  },\r\n  setTitle: (title) => {\r\n    if (state.currentDocumentId) {\r\n      state.setTitle(state.currentDocumentId, title, true);\r\n    }\r\n  },\r\n  setEditing: () => {}, // ê¸°ë³¸ êµ¬í˜„\r\n  setSaveStatus: state.setSaveStatus,\r\n})); ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\sync\\conflict.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'operation' is defined but never used. Allowed unused args must match /^_/u.","line":60,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":60,"endColumn":42},{"ruleId":"no-unused-vars","severity":1,"message":"'operation' is defined but never used. Allowed unused args must match /^_/u.","line":336,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":336,"endColumn":49},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":339,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":339,"endColumn":58},{"ruleId":"no-case-declarations","severity":2,"message":"Unexpected lexical declaration in case block.","line":340,"column":9,"nodeType":"VariableDeclaration","messageId":"unexpected","endLine":340,"endColumn":60}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('conflict');\n/**\r\n * ConflictResolver - ë¬¸ì„œ ì¶©ëŒ í•´ê²° ëª¨ë“ˆ\r\n */\r\nexport class ConflictResolver {\r\n  constructor(options = {}) {\r\n    this.strategy = options.strategy || 'last-write-wins';\r\n    this.autoResolve = options.autoResolve !== false;\r\n    this.userPromptTimeout = options.userPromptTimeout || 30000; // 30ì´ˆ\r\n  }\r\n  \r\n  /**\r\n   * ì¶©ëŒ í•´ê²° ë©”ì¸ ë©”ì„œë“œ\r\n   */\r\n  async resolve(conflict) {\r\n    const { documentId, local, server, operation } = conflict;\r\n    \r\n    logger.info(`ğŸ”„ ì¶©ëŒ í•´ê²° ì‹œì‘: ${documentId} (${operation})`);\r\n    \r\n    try {\r\n      // 1. ìë™ í•´ê²° ê°€ëŠ¥í•œì§€ í™•ì¸\r\n      const autoResolution = this.tryAutoResolve(local, server, operation);\r\n      \r\n      if (autoResolution && this.autoResolve) {\r\n        logger.info(`âœ… ìë™ ì¶©ëŒ í•´ê²°: ${autoResolution.action}`);\r\n        return autoResolution;\r\n      }\r\n      \r\n      // 2. ì‚¬ìš©ì ê°œì… í•„ìš”\r\n      const userResolution = await this.promptUserResolution(conflict);\r\n      \r\n      if (userResolution) {\r\n        logger.info(`âœ… ì‚¬ìš©ì ì¶©ëŒ í•´ê²°: ${userResolution.action}`);\r\n        return userResolution;\r\n      }\r\n      \r\n      // 3. ê¸°ë³¸ ì „ëµ ì ìš©\r\n      const fallbackResolution = this.applyFallbackStrategy(local, server, operation);\r\n      logger.info(`âš ï¸ ê¸°ë³¸ ì „ëµ ì ìš©: ${fallbackResolution.action}`);\r\n      \r\n      return fallbackResolution;\r\n      \r\n    } catch (error) {\r\n      logger.error('âŒ ì¶©ëŒ í•´ê²° ì‹¤íŒ¨:', error);\r\n      \r\n      // ìµœí›„ì˜ ìˆ˜ë‹¨: ë¡œì»¬ ë°ì´í„° ìœ ì§€\r\n      return {\r\n        action: 'use_local',\r\n        data: local,\r\n        reason: 'ì¶©ëŒ í•´ê²° ì‹¤íŒ¨ë¡œ ì¸í•œ ë¡œì»¬ ë°ì´í„° ë³´ì¡´',\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ìë™ í•´ê²° ì‹œë„\r\n   */\r\n  tryAutoResolve(local, server, operation) {\r\n    // 1. ë‚´ìš©ì´ ë™ì¼í•œ ê²½ìš°\r\n    if (this.isContentEqual(local, server)) {\r\n      return {\r\n        action: 'no_conflict',\r\n        data: local,\r\n        reason: 'ë‚´ìš©ì´ ë™ì¼í•¨'\r\n      };\r\n    }\r\n    \r\n    // 2. í•œìª½ì´ ë¹„ì–´ìˆëŠ” ê²½ìš°\r\n    if (this.isEmpty(local) && !this.isEmpty(server)) {\r\n      return {\r\n        action: 'use_server',\r\n        data: server,\r\n        reason: 'ë¡œì»¬ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ'\r\n      };\r\n    }\r\n    \r\n    if (!this.isEmpty(local) && this.isEmpty(server)) {\r\n      return {\r\n        action: 'use_local',\r\n        data: local,\r\n        reason: 'ì„œë²„ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ'\r\n      };\r\n    }\r\n    \r\n    // 3. ë‹¨ìˆœ ì¶”ê°€ë§Œ ìˆëŠ” ê²½ìš° (í…ìŠ¤íŠ¸ ëì— ë‚´ìš© ì¶”ê°€)\r\n    const mergeResult = this.trySimpleMerge(local, server);\r\n    if (mergeResult) {\r\n      return {\r\n        action: 'merge',\r\n        data: mergeResult,\r\n        reason: 'ë‹¨ìˆœ ë³‘í•© ê°€ëŠ¥'\r\n      };\r\n    }\r\n    \r\n    // 4. íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ íŒë‹¨\r\n    if (local.updatedAt && server.updatedAt) {\r\n      const localTime = new Date(local.updatedAt);\r\n      const serverTime = new Date(server.updatedAt);\r\n      const timeDiff = Math.abs(localTime - serverTime);\r\n      \r\n      // ì‹œê°„ ì°¨ì´ê°€ 1ì´ˆ ë¯¸ë§Œì´ë©´ ë‚´ìš© ê¸¸ì´ë¡œ íŒë‹¨\r\n      if (timeDiff < 1000) {\r\n        const localLength = (local.content || '').length;\r\n        const serverLength = (server.content || '').length;\r\n        \r\n        if (localLength > serverLength) {\r\n          return {\r\n            action: 'use_local',\r\n            data: local,\r\n            reason: 'ë™ì‹œ í¸ì§‘ ì‹œ ë” ê¸´ ë‚´ìš© ì„ íƒ'\r\n          };\r\n        } else {\r\n          return {\r\n            action: 'use_server',\r\n            data: server,\r\n            reason: 'ë™ì‹œ í¸ì§‘ ì‹œ ë” ê¸´ ë‚´ìš© ì„ íƒ'\r\n          };\r\n        }\r\n      }\r\n    }\r\n    \r\n    return null; // ìë™ í•´ê²° ë¶ˆê°€\r\n  }\r\n  \r\n  /**\r\n   * ë‹¨ìˆœ ë³‘í•© ì‹œë„\r\n   */\r\n  trySimpleMerge(local, server) {\r\n    const localContent = local.content || '';\r\n    const serverContent = server.content || '';\r\n    \r\n    // í•œìª½ì´ ë‹¤ë¥¸ ìª½ì˜ ë¶€ë¶„ì§‘í•©ì¸ì§€ í™•ì¸\r\n    if (localContent.includes(serverContent)) {\r\n      return {\r\n        ...local,\r\n        content: localContent,\r\n        title: local.title || server.title\r\n      };\r\n    }\r\n    \r\n    if (serverContent.includes(localContent)) {\r\n      return {\r\n        ...server,\r\n        content: serverContent,\r\n        title: server.title || local.title\r\n      };\r\n    }\r\n    \r\n    // ê³µí†µ ì ‘ë‘ì‚¬/ì ‘ë¯¸ì‚¬ ì°¾ê¸°\r\n    const commonPrefix = this.findCommonPrefix(localContent, serverContent);\r\n    const commonSuffix = this.findCommonSuffix(localContent, serverContent);\r\n    \r\n    if (commonPrefix.length > 10 || commonSuffix.length > 10) {\r\n      // ê°„ë‹¨í•œ 3-way merge ì‹œë„\r\n      const localMiddle = localContent.slice(\r\n        commonPrefix.length, \r\n        localContent.length - commonSuffix.length\r\n      );\r\n      const serverMiddle = serverContent.slice(\r\n        commonPrefix.length, \r\n        serverContent.length - commonSuffix.length\r\n      );\r\n      \r\n      // ì¤‘ê°„ ë¶€ë¶„ì„ í•©ì¹˜ê¸°\r\n      const mergedContent = commonPrefix + localMiddle + '\\n' + serverMiddle + commonSuffix;\r\n      \r\n      return {\r\n        ...local,\r\n        content: mergedContent,\r\n        title: local.title || server.title,\r\n        mergedAt: new Date().toISOString()\r\n      };\r\n    }\r\n    \r\n    return null;\r\n  }\r\n  \r\n  /**\r\n   * ì‚¬ìš©ì í•´ê²° í”„ë¡¬í”„íŠ¸\r\n   */\r\n  async promptUserResolution(conflict) {\r\n    return new Promise((resolve) => {\r\n      const { documentId, local, server } = conflict;\r\n      \r\n      // ì¶©ëŒ í•´ê²° UI í‘œì‹œ\r\n      const modal = this.createConflictModal(documentId, local, server);\r\n      document.body.appendChild(modal);\r\n      \r\n      // íƒ€ì„ì•„ì›ƒ ì„¤ì •\r\n      const timeout = setTimeout(() => {\r\n        document.body.removeChild(modal);\r\n        resolve(null); // íƒ€ì„ì•„ì›ƒ ì‹œ null ë°˜í™˜\r\n      }, this.userPromptTimeout);\r\n      \r\n      // ì‚¬ìš©ì ì„ íƒ ì²˜ë¦¬\r\n      const handleChoice = (choice, data) => {\r\n        clearTimeout(timeout);\r\n        document.body.removeChild(modal);\r\n        resolve({\r\n          action: choice,\r\n          data: data,\r\n          reason: 'ì‚¬ìš©ì ì„ íƒ'\r\n        });\r\n      };\r\n      \r\n      // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ\r\n      modal.querySelector('.use-local').onclick = () => \r\n        handleChoice('use_local', local);\r\n      \r\n      modal.querySelector('.use-server').onclick = () => \r\n        handleChoice('use_server', server);\r\n      \r\n      modal.querySelector('.merge-manual').onclick = () => {\r\n        const mergedData = this.showMergeEditor(local, server);\r\n        handleChoice('merge', mergedData);\r\n      };\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ì¶©ëŒ í•´ê²° ëª¨ë‹¬ ìƒì„±\r\n   */\r\n  createConflictModal(documentId, local, server) {\r\n    const modal = document.createElement('div');\r\n    modal.className = 'conflict-resolution-modal';\r\n    modal.innerHTML = `\r\n      <div class=\"modal-overlay\">\r\n        <div class=\"modal-content\">\r\n          <h3>ğŸ“„ ë¬¸ì„œ ì¶©ëŒ ê°ì§€</h3>\r\n          <p>ë¬¸ì„œ \"${local.title || documentId}\"ì—ì„œ ì¶©ëŒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>\r\n          \r\n          <div class=\"conflict-comparison\">\r\n            <div class=\"local-version\">\r\n              <h4>ğŸ–¥ï¸ ë¡œì»¬ ë²„ì „</h4>\r\n              <div class=\"content-preview\">${this.truncateContent(local.content)}</div>\r\n              <small>ìˆ˜ì •: ${new Date(local.updatedAt).toLocaleString()}</small>\r\n            </div>\r\n            \r\n            <div class=\"server-version\">\r\n              <h4>â˜ï¸ ì„œë²„ ë²„ì „</h4>\r\n              <div class=\"content-preview\">${this.truncateContent(server.content)}</div>\r\n              <small>ìˆ˜ì •: ${new Date(server.updatedAt).toLocaleString()}</small>\r\n            </div>\r\n          </div>\r\n          \r\n          <div class=\"resolution-buttons\">\r\n            <button class=\"use-local\">ë¡œì»¬ ë²„ì „ ì‚¬ìš©</button>\r\n            <button class=\"use-server\">ì„œë²„ ë²„ì „ ì‚¬ìš©</button>\r\n            <button class=\"merge-manual\">ìˆ˜ë™ ë³‘í•©</button>\r\n          </div>\r\n          \r\n          <p class=\"timeout-warning\">30ì´ˆ í›„ ìë™ìœ¼ë¡œ ë¡œì»¬ ë²„ì „ì´ ì„ íƒë©ë‹ˆë‹¤.</p>\r\n        </div>\r\n      </div>\r\n    `;\r\n    \r\n    // ìŠ¤íƒ€ì¼ ì¶”ê°€\r\n    const style = document.createElement('style');\r\n    style.textContent = `\r\n      .conflict-resolution-modal {\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        z-index: 10000;\r\n      }\r\n      .modal-overlay {\r\n        background: rgba(0,0,0,0.7);\r\n        width: 100%;\r\n        height: 100%;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n      }\r\n      .modal-content {\r\n        background: white;\r\n        padding: 20px;\r\n        border-radius: 8px;\r\n        max-width: 600px;\r\n        max-height: 80vh;\r\n        overflow-y: auto;\r\n      }\r\n      .conflict-comparison {\r\n        display: flex;\r\n        gap: 20px;\r\n        margin: 20px 0;\r\n      }\r\n      .local-version, .server-version {\r\n        flex: 1;\r\n        border: 1px solid #ddd;\r\n        padding: 10px;\r\n        border-radius: 4px;\r\n      }\r\n      .content-preview {\r\n        background: #f5f5f5;\r\n        padding: 10px;\r\n        border-radius: 4px;\r\n        font-family: monospace;\r\n        font-size: 12px;\r\n        max-height: 150px;\r\n        overflow-y: auto;\r\n        white-space: pre-wrap;\r\n      }\r\n      .resolution-buttons {\r\n        display: flex;\r\n        gap: 10px;\r\n        justify-content: center;\r\n        margin: 20px 0;\r\n      }\r\n      .resolution-buttons button {\r\n        padding: 10px 20px;\r\n        border: none;\r\n        border-radius: 4px;\r\n        cursor: pointer;\r\n      }\r\n      .use-local { background: #4CAF50; color: white; }\r\n      .use-server { background: #2196F3; color: white; }\r\n      .merge-manual { background: #FF9800; color: white; }\r\n      .timeout-warning {\r\n        text-align: center;\r\n        color: #666;\r\n        font-size: 12px;\r\n      }\r\n    `;\r\n    modal.appendChild(style);\r\n    \r\n    return modal;\r\n  }\r\n  \r\n  /**\r\n   * ê¸°ë³¸ ì „ëµ ì ìš©\r\n   */\r\n  applyFallbackStrategy(local, server, operation) {\r\n    switch (this.strategy) {\r\n      case 'last-write-wins':\r\n        const localTime = new Date(local.updatedAt || 0);\r\n        const serverTime = new Date(server.updatedAt || 0);\r\n        \r\n        return localTime >= serverTime ? {\r\n          action: 'use_local',\r\n          data: local,\r\n          reason: 'Last-Write-Wins: ë¡œì»¬ì´ ë” ìµœì‹ '\r\n        } : {\r\n          action: 'use_server',\r\n          data: server,\r\n          reason: 'Last-Write-Wins: ì„œë²„ê°€ ë” ìµœì‹ '\r\n        };\r\n        \r\n      case 'prefer-local':\r\n        return {\r\n          action: 'use_local',\r\n          data: local,\r\n          reason: 'Prefer-Local ì „ëµ'\r\n        };\r\n        \r\n      case 'prefer-server':\r\n        return {\r\n          action: 'use_server',\r\n          data: server,\r\n          reason: 'Prefer-Server ì „ëµ'\r\n        };\r\n        \r\n      default:\r\n        return {\r\n          action: 'use_local',\r\n          data: local,\r\n          reason: 'ì•Œ ìˆ˜ ì—†ëŠ” ì „ëµìœ¼ë¡œ ì¸í•œ ë¡œì»¬ ì„ íƒ'\r\n        };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ìœ í‹¸ë¦¬í‹° ë©”ì„œë“œë“¤\r\n   */\r\n  isContentEqual(local, server) {\r\n    return (local.content || '').trim() === (server.content || '').trim() &&\r\n           (local.title || '').trim() === (server.title || '').trim();\r\n  }\r\n  \r\n  isEmpty(data) {\r\n    return !data || \r\n           (!data.content || data.content.trim() === '') &&\r\n           (!data.title || data.title.trim() === '');\r\n  }\r\n  \r\n  findCommonPrefix(str1, str2) {\r\n    let i = 0;\r\n    while (i < str1.length && i < str2.length && str1[i] === str2[i]) {\r\n      i++;\r\n    }\r\n    return str1.slice(0, i);\r\n  }\r\n  \r\n  findCommonSuffix(str1, str2) {\r\n    let i = 0;\r\n    while (i < str1.length && i < str2.length && \r\n           str1[str1.length - 1 - i] === str2[str2.length - 1 - i]) {\r\n      i++;\r\n    }\r\n    return str1.slice(str1.length - i);\r\n  }\r\n  \r\n  truncateContent(content, maxLength = 200) {\r\n    if (!content) return '(ë‚´ìš© ì—†ìŒ)';\r\n    return content.length > maxLength ? \r\n           content.slice(0, maxLength) + '...' : \r\n           content;\r\n  }\r\n}\r\n\r\n/**\r\n * ì¶©ëŒ í•´ê²°ê¸° íŒ©í† ë¦¬\r\n */\r\nexport const createConflictResolver = (options = {}) => {\r\n  return new ConflictResolver(options);\r\n};\r\n\r\n/**\r\n * ê¸°ë³¸ ì¶©ëŒ í•´ê²°ê¸° ì¸ìŠ¤í„´ìŠ¤\r\n */\r\nexport const defaultConflictResolver = new ConflictResolver(); ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\sync\\httpAdapter.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'options' is assigned a value but never used.","line":106,"column":34,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":41}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('httpAdapter');\n/**\r\n * HttpAdapter - REST API í†µì‹  ì–´ëŒ‘í„°\r\n */\r\nexport class HttpAdapter {\r\n  constructor(options = {}) {\r\n    this.baseURL = options.baseURL || 'http://localhost:3003/api';\r\n    this.timeout = options.timeout || 10000;\r\n    this.headers = {\r\n      'Content-Type': 'application/json',\r\n      ...options.headers\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * HTTP ìš”ì²­ ê³µí†µ ì²˜ë¦¬\r\n   */\r\n  async request(method, endpoint, data = null, options = {}) {\r\n    const url = `${this.baseURL}${endpoint}`;\r\n    const config = {\r\n      method,\r\n      headers: { ...this.headers, ...options.headers },\r\n      signal: AbortSignal.timeout(this.timeout),\r\n      ...options\r\n    };\r\n    \r\n    if (data && (method === 'POST' || method === 'PUT' || method === 'PATCH')) {\r\n      config.body = JSON.stringify(data);\r\n    }\r\n    \r\n    try {\r\n      logger.info(`ğŸŒ ${method} ${url}`, data ? { data } : '');\r\n      \r\n      const response = await fetch(url, config);\r\n      \r\n      // ETag í—¤ë” ì²˜ë¦¬ (ìºì‹œ ë¬´ê²°ì„±)\r\n      const etag = response.headers.get('ETag');\r\n      const lastModified = response.headers.get('Last-Modified');\r\n      \r\n      if (!response.ok) {\r\n        const errorData = await response.json().catch(() => ({}));\r\n        const error = new Error(errorData.message || `HTTP ${response.status}`);\r\n        error.status = response.status;\r\n        error.data = errorData;\r\n        throw error;\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      // ë©”íƒ€ë°ì´í„° ì¶”ê°€\r\n      if (etag || lastModified) {\r\n        result._meta = {\r\n          etag,\r\n          lastModified,\r\n          status: response.status\r\n        };\r\n      }\r\n      \r\n      logger.info(`âœ… ${method} ${url} ì„±ê³µ`, { status: response.status });\r\n      return result;\r\n      \r\n    } catch (error) {\r\n      logger.error(`âŒ ${method} ${url} ì‹¤íŒ¨:`, error.message);\r\n      \r\n      // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í‘œì¤€í™”\r\n      if (error.name === 'AbortError') {\r\n        const timeoutError = new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼');\r\n        timeoutError.name = 'TimeoutError';\r\n        timeoutError.code = 'TIMEOUT';\r\n        throw timeoutError;\r\n      }\r\n      \r\n      if (error.name === 'TypeError' && error.message.includes('fetch')) {\r\n        const networkError = new Error('ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨');\r\n        networkError.name = 'NetworkError';\r\n        networkError.code = 'NETWORK_ERROR';\r\n        throw networkError;\r\n      }\r\n      \r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ë¬¸ì„œ ìƒì„±\r\n   */\r\n  async createDocument(data) {\r\n    return await this.request('POST', '/posts', {\r\n      title: data.title || 'ì œëª© ì—†ìŒ',\r\n      content: data.content || '',\r\n      ...data\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ë¬¸ì„œ ì¡°íšŒ\r\n   */\r\n  async getDocument(id) {\r\n    return await this.request('GET', `/posts/${id}`);\r\n  }\r\n  \r\n  /**\r\n   * ë¬¸ì„œ ì—…ë°ì´íŠ¸ (ETag ê¸°ë°˜ ì¶©ëŒ ê°ì§€)\r\n   */\r\n  async updateDocument(id, data, options = {}) {\r\n    const headers = {};\r\n    \r\n    // ETag ê¸°ë°˜ ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸\r\n    if (data._meta?.etag) {\r\n      headers['If-Match'] = data._meta.etag;\r\n    }\r\n    \r\n    // Last-Modified ê¸°ë°˜ ì¡°ê±´ë¶€ ì—…ë°ì´íŠ¸\r\n    if (data._meta?.lastModified) {\r\n      headers['If-Unmodified-Since'] = data._meta.lastModified;\r\n    }\r\n    \r\n    return await this.request('PUT', `/posts/${id}`, {\r\n      title: data.title,\r\n      content: data.content,\r\n      updatedAt: data.updatedAt || new Date().toISOString(),\r\n      ...data\r\n    }, { headers });\r\n  }\r\n  \r\n  /**\r\n   * ë¬¸ì„œ ì‚­ì œ\r\n   */\r\n  async deleteDocument(id) {\r\n    return await this.request('DELETE', `/posts/${id}`);\r\n  }\r\n  \r\n  /**\r\n   * ë¬¸ì„œ ëª©ë¡ ì¡°íšŒ\r\n   */\r\n  async getDocuments(options = {}) {\r\n    const params = new URLSearchParams();\r\n    \r\n    if (options.limit) params.append('limit', options.limit);\r\n    if (options.offset) params.append('offset', options.offset);\r\n    if (options.search) params.append('search', options.search);\r\n    if (options.since) params.append('since', options.since);\r\n    \r\n    const query = params.toString();\r\n    const endpoint = query ? `/posts?${query}` : '/posts';\r\n    \r\n    return await this.request('GET', endpoint);\r\n  }\r\n  \r\n  /**\r\n   * ì„œë²„ ìƒíƒœ í™•ì¸\r\n   */\r\n  async healthCheck() {\r\n    try {\r\n      const result = await this.request('GET', '/health', null, { \r\n        timeout: 5000 \r\n      });\r\n      return { status: 'ok', ...result };\r\n    } catch (error) {\r\n      return { \r\n        status: 'error', \r\n        error: error.message,\r\n        code: error.code \r\n      };\r\n    }\r\n  }\r\n  \r\n  /**\r\n   * ë™ê¸°í™” ìƒíƒœ ì¡°íšŒ\r\n   */\r\n  async getSyncStatus(documentIds = []) {\r\n    if (documentIds.length === 0) {\r\n      return await this.request('GET', '/sync/status');\r\n    }\r\n    \r\n    return await this.request('POST', '/sync/status', {\r\n      documentIds\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ë°°ì¹˜ ì—…ë°ì´íŠ¸ (ì—¬ëŸ¬ ë¬¸ì„œ í•œë²ˆì—)\r\n   */\r\n  async batchUpdate(documents) {\r\n    return await this.request('POST', '/posts/batch', {\r\n      documents: documents.map(doc => ({\r\n        id: doc.id,\r\n        title: doc.title,\r\n        content: doc.content,\r\n        updatedAt: doc.updatedAt\r\n      }))\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * ì¶©ëŒ í•´ê²°ì„ ìœ„í•œ ì„œë²„ ë°ì´í„° ì¡°íšŒ\r\n   */\r\n  async getDocumentRevision(id, revision) {\r\n    return await this.request('GET', `/posts/${id}/revisions/${revision}`);\r\n  }\r\n  \r\n  /**\r\n   * ê²€ìƒ‰\r\n   */\r\n  async searchDocuments(query, options = {}) {\r\n    const params = new URLSearchParams({\r\n      q: query,\r\n      limit: options.limit || 20,\r\n      offset: options.offset || 0\r\n    });\r\n    \r\n    if (options.fields) {\r\n      params.append('fields', options.fields.join(','));\r\n    }\r\n    \r\n    return await this.request('GET', `/search?${params.toString()}`);\r\n  }\r\n}\r\n\r\n/**\r\n * HTTP ì–´ëŒ‘í„° íŒ©í† ë¦¬\r\n */\r\nexport const createHttpAdapter = (options = {}) => {\r\n  return new HttpAdapter(options);\r\n};\r\n\r\n/**\r\n * ê¸°ë³¸ HTTP ì–´ëŒ‘í„° ì¸ìŠ¤í„´ìŠ¤\r\n */\r\nexport const defaultHttpAdapter = new HttpAdapter(); ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\sync\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\sync\\wsAdapter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\DataSyncManager.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'titleKey' is assigned a value but never used.","line":229,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":229,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'title' is assigned a value but never used.","line":403,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":403,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'titleKey' is assigned a value but never used.","line":495,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":495,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('DataSyncManager');\n/**\r\n * ì„œë²„ì™€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê°„ì˜ ë°ì´í„° ë™ê¸°í™”ë¥¼ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤\r\n * ìˆ˜ì •: ì„œë²„ API êµ¬ì¡°ì— ë§ê²Œ ë™ê¸°í™” ë¡œì§ ê°œì„ \r\n */\r\nclass DataSyncManager {\r\n  constructor() {\r\n    this.serverUrl = 'http://localhost:3003/api/posts';\r\n    this.syncInProgress = false;\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì™€ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì™„ì „ ë™ê¸°í™”\r\n   * @param {Array} keepTitles - ë³´ì¡´í•  ë¬¸ì„œ ì œëª© ë°°ì—´\r\n   * @returns {Object} - ë™ê¸°í™” ê²°ê³¼\r\n   */\r\n  async fullSync(keepTitles = ['ì œë‹ˆ', 'ë¡œì œ', 'ë¨ì‹œë¦¬', 'ë¸”ë™í•‘í¬']) {\r\n    if (this.syncInProgress) {\r\n      logger.info('ë™ê¸°í™”ê°€ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');\r\n      return { success: false, message: 'ë™ê¸°í™” ì§„í–‰ ì¤‘' };\r\n    }\r\n\r\n    this.syncInProgress = true;\r\n    logger.info('=== ì „ì²´ ë°ì´í„° ë™ê¸°í™” ì‹œì‘ ===');\r\n\r\n    try {\r\n      // 1ë‹¨ê³„: ì„œë²„ ë¬¸ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\r\n      const serverDocs = await this.getServerDocuments();\r\n      logger.info(`ì„œë²„ ë¬¸ì„œ: ${serverDocs.length}ê°œ`);\r\n\r\n      // 2ë‹¨ê³„: ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¬¸ì„œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°\r\n      const localDocs = this.getLocalDocuments();\r\n      logger.info(`ë¡œì»¬ ë¬¸ì„œ: ${localDocs.length}ê°œ`);\r\n\r\n      // 3ë‹¨ê³„: ë³´ì¡´í•  ë¬¸ì„œë§Œ í•„í„°ë§\r\n      const filteredServerDocs = serverDocs.filter(doc => \r\n        keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n      const filteredLocalDocs = localDocs.filter(doc => \r\n        keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n\r\n      logger.info(`í•„í„°ë§ í›„ - ì„œë²„: ${filteredServerDocs.length}ê°œ, ë¡œì»¬: ${filteredLocalDocs.length}ê°œ`);\r\n\r\n      // 4ë‹¨ê³„: ë¶ˆí•„ìš”í•œ ì„œë²„ ë¬¸ì„œ ì‚­ì œ\r\n      const serverDeleteResults = await this.cleanupServerDocuments(serverDocs, keepTitles);\r\n      \r\n      // 5ë‹¨ê³„: ë¶ˆí•„ìš”í•œ ë¡œì»¬ ë¬¸ì„œ ì‚­ì œ\r\n      const localDeleteResults = this.cleanupLocalDocuments(localDocs, keepTitles);\r\n\r\n      // 6ë‹¨ê³„: ìµœì‹  ë²„ì „ìœ¼ë¡œ í†µí•©\r\n      const mergeResults = await this.mergeDocuments(filteredServerDocs, filteredLocalDocs);\r\n\r\n      const result = {\r\n        success: true,\r\n        serverDeleted: serverDeleteResults.deleted,\r\n        localDeleted: localDeleteResults.deleted,\r\n        merged: mergeResults.merged,\r\n        finalCount: mergeResults.finalDocuments.length,\r\n        message: `ë™ê¸°í™” ì™„ë£Œ: ${mergeResults.finalDocuments.length}ê°œ ë¬¸ì„œ ìœ ì§€`\r\n      };\r\n\r\n      logger.info('=== ì „ì²´ ë°ì´í„° ë™ê¸°í™” ì™„ë£Œ ===');\r\n      logger.info(result);\r\n      \r\n      return result;\r\n\r\n    } catch (error) {\r\n      logger.error('ë™ê¸°í™” ì˜¤ë¥˜:', error);\r\n      return { \r\n        success: false, \r\n        error: error.message,\r\n        message: 'ë™ê¸°í™” ì‹¤íŒ¨' \r\n      };\r\n    } finally {\r\n      this.syncInProgress = false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì—ì„œ ëª¨ë“  ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì •: title ì¶”ì¶œ ë¡œì§ ê°œì„ )\r\n   */\r\n  async getServerDocuments() {\r\n    try {\r\n      const response = await fetch(this.serverUrl);\r\n      if (!response.ok) {\r\n        throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ${response.status}`);\r\n      }\r\n      \r\n      const serverPosts = await response.json();\r\n      \r\n      // ê° ë¬¸ì„œì˜ ì „ì²´ ë‚´ìš©ì„ ê°œë³„ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°\r\n      const fullDocuments = [];\r\n      for (const post of serverPosts) {\r\n        try {\r\n          const fullContent = await this.getServerDocument(post.id);\r\n          fullDocuments.push({\r\n            id: post.id,\r\n            title: post.title || post.id,\r\n            content: fullContent.content || '',\r\n            updatedAt: fullContent.updatedAt || post.updatedAt || new Date().toISOString(),\r\n            source: 'server'\r\n          });\r\n        } catch (error) {\r\n          logger.warn(`ë¬¸ì„œ ${post.id} ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:`, error);\r\n          // ì‹¤íŒ¨í•œ ê²½ìš° ê¸°ë³¸ ì •ë³´ë§Œ ì‚¬ìš©\r\n          fullDocuments.push({\r\n            id: post.id,\r\n            title: post.title || post.id,\r\n            content: post.preview || '',\r\n            updatedAt: post.updatedAt || new Date().toISOString(),\r\n            source: 'server'\r\n          });\r\n        }\r\n      }\r\n      \r\n      return fullDocuments;\r\n    } catch (error) {\r\n      logger.error('ì„œë²„ ë¬¸ì„œ ì¡°íšŒ ì˜¤ë¥˜:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì—ì„œ íŠ¹ì • ë¬¸ì„œì˜ ì „ì²´ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°\r\n   */\r\n  async getServerDocument(id) {\r\n    const response = await fetch(`${this.serverUrl}/${id}`);\r\n    if (!response.ok) {\r\n      throw new Error(`ë¬¸ì„œ ì¡°íšŒ ì‹¤íŒ¨: ${response.status}`);\r\n    }\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ëª¨ë“  ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°\r\n   */\r\n  getLocalDocuments() {\r\n    const documents = [];\r\n    const documentKeys = Object.keys(localStorage).filter(key => key.startsWith('miki_document_'));\r\n    \r\n    for (const key of documentKeys) {\r\n      try {\r\n        const docData = JSON.parse(localStorage.getItem(key));\r\n        if (docData && docData.title) {\r\n          documents.push({\r\n            id: docData.id || key.replace('miki_document_', ''),\r\n            title: docData.title,\r\n            content: docData.content || '',\r\n            updatedAt: docData.updatedAt || new Date().toISOString(),\r\n            source: 'local'\r\n          });\r\n        }\r\n      } catch (e) {\r\n        logger.warn(`ë¡œì»¬ ë¬¸ì„œ íŒŒì‹± ì˜¤ë¥˜ (${key}):`, e);\r\n      }\r\n    }\r\n    \r\n    return documents;\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì—ì„œ ë¶ˆí•„ìš”í•œ ë¬¸ì„œ ì‚­ì œ\r\n   */\r\n  async cleanupServerDocuments(serverDocs, keepTitles) {\r\n    const toDelete = serverDocs.filter(doc => \r\n      !keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n    );\r\n\r\n    let deleted = 0;\r\n    for (const doc of toDelete) {\r\n      try {\r\n        const response = await fetch(`${this.serverUrl}/${doc.id}`, {\r\n          method: 'DELETE'\r\n        });\r\n        if (response.ok) {\r\n          deleted++;\r\n          logger.info(`ì„œë²„ì—ì„œ ì‚­ì œ: ${doc.title}`);\r\n        }\r\n      } catch (error) {\r\n        logger.error(`ì„œë²„ ì‚­ì œ ì‹¤íŒ¨ (${doc.title}):`, error);\r\n      }\r\n    }\r\n\r\n    return { deleted, total: toDelete.length };\r\n  }\r\n\r\n  /**\r\n   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¶ˆí•„ìš”í•œ ë¬¸ì„œ ì‚­ì œ\r\n   */\r\n  cleanupLocalDocuments(localDocs, keepTitles) {\r\n    const toDelete = localDocs.filter(doc => \r\n      !keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n    );\r\n\r\n    let deleted = 0;\r\n    for (const doc of toDelete) {\r\n      try {\r\n        localStorage.removeItem(`miki_document_${doc.id}`);\r\n        localStorage.removeItem(`miki_title_${doc.id}`);\r\n        deleted++;\r\n        logger.info(`ë¡œì»¬ì—ì„œ ì‚­ì œ: ${doc.title}`);\r\n      } catch (error) {\r\n        logger.error(`ë¡œì»¬ ì‚­ì œ ì‹¤íŒ¨ (${doc.title}):`, error);\r\n      }\r\n    }\r\n\r\n    return { deleted, total: toDelete.length };\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì™€ ë¡œì»¬ ë¬¸ì„œë¥¼ ìµœì‹  ë²„ì „ìœ¼ë¡œ í†µí•©\r\n   */\r\n  async mergeDocuments(serverDocs, localDocs) {\r\n    const finalDocuments = [];\r\n    const titleGroups = {};\r\n\r\n    // ì œëª©ë³„ë¡œ ê·¸ë£¹í™”\r\n    [...serverDocs, ...localDocs].forEach(doc => {\r\n      const titleKey = doc.title.toLowerCase();\r\n      if (!titleGroups[titleKey]) {\r\n        titleGroups[titleKey] = [];\r\n      }\r\n      titleGroups[titleKey].push(doc);\r\n    });\r\n\r\n    // ê° ì œëª©ë³„ë¡œ ìµœì‹  ë²„ì „ ì„ íƒ ë° ë™ê¸°í™”\r\n    for (const [titleKey, docs] of Object.entries(titleGroups)) {\r\n      // ìµœì‹  ë¬¸ì„œ ì„ íƒ (updatedAt ê¸°ì¤€)\r\n      const latestDoc = docs.sort((a, b) => \r\n        new Date(b.updatedAt) - new Date(a.updatedAt)\r\n      )[0];\r\n\r\n      // ì„œë²„ì™€ ë¡œì»¬ ëª¨ë‘ì— ìµœì‹  ë²„ì „ ì €ì¥\r\n      await this.saveToServer(latestDoc);\r\n      this.saveToLocal(latestDoc);\r\n\r\n      finalDocuments.push(latestDoc);\r\n      logger.info(`í†µí•© ì™„ë£Œ: ${latestDoc.title} (ìµœì‹ : ${latestDoc.updatedAt})`);\r\n    }\r\n\r\n    return { merged: finalDocuments.length, finalDocuments };\r\n  }\r\n\r\n  /**\r\n   * ì„œë²„ì— ë¬¸ì„œ ì €ì¥ (ìˆ˜ì •: ì„œë²„ API êµ¬ì¡°ì— ë§ê²Œ ê°œì„ )\r\n   */\r\n  async saveToServer(doc) {\r\n    try {\r\n      // ë¨¼ì € í•´ë‹¹ IDì˜ ë¬¸ì„œê°€ ì„œë²„ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸\r\n      const existingResponse = await fetch(`${this.serverUrl}/${doc.id}`);\r\n      \r\n      if (existingResponse.ok) {\r\n        // ë¬¸ì„œê°€ ì¡´ì¬í•˜ë©´ PUTìœ¼ë¡œ ì—…ë°ì´íŠ¸\r\n        const updateResponse = await fetch(`${this.serverUrl}/${doc.id}`, {\r\n          method: 'PUT',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            content: doc.content,\r\n            title: doc.title\r\n          })\r\n        });\r\n        \r\n        if (!updateResponse.ok) {\r\n          throw new Error(`ì„œë²„ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ${updateResponse.status}`);\r\n        }\r\n        \r\n        logger.info(`âœ… ì„œë²„ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${doc.title}`);\r\n      } else {\r\n        // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ POSTë¡œ ìƒˆë¡œ ìƒì„±\r\n        const createResponse = await fetch(this.serverUrl, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            title: doc.title,\r\n            content: doc.content\r\n          })\r\n        });\r\n        \r\n        if (!createResponse.ok) {\r\n          throw new Error(`ì„œë²„ ìƒì„± ì‹¤íŒ¨: ${createResponse.status}`);\r\n        }\r\n        \r\n        const result = await createResponse.json();\r\n        logger.info(`âœ… ì„œë²„ ìƒì„± ì™„ë£Œ: ${doc.title} (ID: ${result.id})`);\r\n        \r\n        // ìƒˆë¡œ ìƒì„±ëœ IDê°€ ë‹¤ë¥´ë©´ ë¡œì»¬ì—ì„œë„ ì—…ë°ì´íŠ¸\r\n        if (result.id !== doc.id) {\r\n          logger.info(`ğŸ”„ ID ë³€ê²½: ${doc.id} â†’ ${result.id}`);\r\n          \r\n          // ê¸°ì¡´ ë¡œì»¬ ë°ì´í„° ì‚­ì œ\r\n          localStorage.removeItem(`miki_document_${doc.id}`);\r\n          localStorage.removeItem(`miki_title_${doc.id}`);\r\n          \r\n          // ìƒˆ IDë¡œ ì €ì¥\r\n          doc.id = result.id;\r\n          this.saveToLocal(doc);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      logger.error(`ì„œë²„ ì €ì¥ ì˜¤ë¥˜ (${doc.title}):`, error);\r\n      throw error; // ì—ëŸ¬ë¥¼ ìƒìœ„ë¡œ ì „íŒŒ\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë¬¸ì„œ ì €ì¥\r\n   */\r\n  saveToLocal(doc) {\r\n    try {\r\n      const docKey = `miki_document_${doc.id}`;\r\n      const titleKey = `miki_title_${doc.id}`;\r\n      \r\n      localStorage.setItem(docKey, JSON.stringify({\r\n        id: doc.id,\r\n        title: doc.title,\r\n        content: doc.content,\r\n        updatedAt: doc.updatedAt || new Date().toISOString()\r\n      }));\r\n      \r\n      localStorage.setItem(titleKey, doc.title);\r\n    } catch (error) {\r\n      logger.error(`ë¡œì»¬ ì €ì¥ ì˜¤ë¥˜ (${doc.title}):`, error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì¬êµ¬ì„±\r\n   */\r\n  updateRecentDocuments(documents) {\r\n    try {\r\n      const recentDocs = documents\r\n        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt))\r\n        .slice(0, 20)\r\n        .map(doc => ({\r\n          id: doc.id,\r\n          title: doc.title,\r\n          updatedAt: doc.updatedAt\r\n        }));\r\n\r\n      localStorage.setItem('miki_recent_docs', JSON.stringify(recentDocs));\r\n      logger.info(`ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì—…ë°ì´íŠ¸: ${recentDocs.length}ê°œ`);\r\n    } catch (error) {\r\n      logger.error('ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ì¦‰ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ (UIì—ì„œ í˜¸ì¶œìš©)\r\n   * @param {Array} keepTitles - ë³´ì¡´í•  ë¬¸ì„œ ì œëª© ë°°ì—´\r\n   * @returns {Object} - ì •ë¦¬ ê²°ê³¼\r\n   */\r\n  immediateLocalCleanup(keepTitles = ['ì œë‹ˆ', 'ë¡œì œ', 'ë¨ì‹œë¦¬', 'ë¸”ë™í•‘í¬']) {\r\n    logger.info('=== ì¦‰ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì‹œì‘ ===');\r\n    logger.info(`ë³´ì¡´í•  ë¬¸ì„œ: ${keepTitles.join(', ')}`);\r\n    \r\n    const stats = {\r\n      totalDocuments: 0,\r\n      preservedDocuments: 0,\r\n      deletedDocuments: 0,\r\n      spaceSaved: 0\r\n    };\r\n    \r\n    try {\r\n      // ëª¨ë“  ë¬¸ì„œ í‚¤ ìˆ˜ì§‘\r\n      const documentKeys = Object.keys(localStorage).filter(key => key.startsWith('miki_document_'));\r\n      stats.totalDocuments = documentKeys.length;\r\n      \r\n      logger.info(`ğŸ“Š ì´ ${documentKeys.length}ê°œ ë¬¸ì„œ ë°œê²¬`);\r\n      \r\n      const toDelete = [];\r\n      const toKeep = [];\r\n      \r\n      // ì œëª©ë³„ ê·¸ë£¹í™” ë° ë¶„ë¥˜\r\n      const titleGroups = {};\r\n      \r\n      for (const key of documentKeys) {\r\n        try {\r\n          const docData = JSON.parse(localStorage.getItem(key));\r\n          if (!docData || !docData.title) continue;\r\n          \r\n          const title = docData.title.toLowerCase();\r\n          const shouldKeep = keepTitles.some(keepTitle => \r\n            title === keepTitle.toLowerCase()\r\n          );\r\n          \r\n          if (shouldKeep) {\r\n            if (!titleGroups[title]) {\r\n              titleGroups[title] = [];\r\n            }\r\n            titleGroups[title].push({ key, data: docData });\r\n          } else {\r\n            toDelete.push({ key, title: docData.title });\r\n          }\r\n        } catch (e) {\r\n          // íŒŒì‹± ì˜¤ë¥˜ê°€ ìˆëŠ” ë¬¸ì„œëŠ” ì‚­ì œ\r\n          toDelete.push({ key, title: 'íŒŒì‹± ì˜¤ë¥˜' });\r\n        }\r\n      }\r\n      \r\n      // ê° ì œëª©ë³„ë¡œ ìµœì‹  ë²„ì „ë§Œ ë³´ì¡´\r\n      for (const [title, docs] of Object.entries(titleGroups)) {\r\n        if (docs.length > 1) {\r\n          // ìµœì‹  ë¬¸ì„œ ì„ íƒ\r\n          const latest = docs.sort((a, b) => \r\n            new Date(b.data.updatedAt || 0) - new Date(a.data.updatedAt || 0)\r\n          )[0];\r\n          \r\n          // ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œ ëª©ë¡ì— ì¶”ê°€\r\n          docs.forEach(doc => {\r\n            if (doc.key !== latest.key) {\r\n              toDelete.push({ key: doc.key, title: doc.data.title });\r\n            } else {\r\n              toKeep.push({ key: doc.key, title: doc.data.title });\r\n            }\r\n          });\r\n        } else {\r\n          toKeep.push({ key: docs[0].key, title: docs[0].data.title });\r\n        }\r\n      }\r\n      \r\n      // ì‚­ì œ ì‹¤í–‰\r\n      for (const item of toDelete) {\r\n        try {\r\n          const docId = item.key.replace('miki_document_', '');\r\n          localStorage.removeItem(item.key);\r\n          localStorage.removeItem(`miki_title_${docId}`);\r\n          stats.deletedDocuments++;\r\n          logger.info(`âŒ ì‚­ì œ: ${item.key} - \"${item.title}\"`);\r\n        } catch (e) {\r\n          logger.error(`ì‚­ì œ ì‹¤íŒ¨: ${item.key}`, e);\r\n        }\r\n      }\r\n      \r\n      stats.preservedDocuments = toKeep.length;\r\n      \r\n      // ë³´ì¡´ëœ ë¬¸ì„œ ë¡œê·¸\r\n      toKeep.forEach(item => {\r\n        logger.info(`âœ… ë³´ì¡´: ${item.key} - \"${item.title}\"`);\r\n      });\r\n      \r\n      logger.info('=== ì¦‰ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ ì™„ë£Œ ===');\r\n      logger.info(`ë³´ì¡´: ${stats.preservedDocuments}ê°œ, ì‚­ì œ: ${stats.deletedDocuments}ê°œ`);\r\n      \r\n      return stats;\r\n    } catch (error) {\r\n      logger.error('ì¦‰ì‹œ ì •ë¦¬ ì˜¤ë¥˜:', error);\r\n      return { ...stats, error: error.message };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * ì•ˆì „í•œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ (ì‹¤ì œ ë³€ê²½ ì—†ì´ ì‹œë®¬ë ˆì´ì…˜ë§Œ)\r\n   * @param {Array} keepTitles - ë³´ì¡´í•  ë¬¸ì„œ ì œëª© ë°°ì—´\r\n   * @returns {Object} - í…ŒìŠ¤íŠ¸ ê²°ê³¼\r\n   */\r\n  async safeTestSync(keepTitles = ['ì œë‹ˆ', 'ë¡œì œ', 'ë¨ì‹œë¦¬', 'ë¸”ë™í•‘í¬']) {\r\n    logger.info('=== ì•ˆì „í•œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì‹œì‘ (ì‹¤ì œ ë³€ê²½ ì—†ìŒ) ===');\r\n    \r\n    try {\r\n      // 1ë‹¨ê³„: í˜„ì¬ ìƒíƒœ ë¶„ì„\r\n      const serverDocs = await this.getServerDocuments();\r\n      const localDocs = this.getLocalDocuments();\r\n      \r\n      logger.info(`ğŸ“Š í˜„ì¬ ìƒíƒœ: ì„œë²„ ${serverDocs.length}ê°œ, ë¡œì»¬ ${localDocs.length}ê°œ`);\r\n      \r\n      // 2ë‹¨ê³„: í•„í„°ë§ ì‹œë®¬ë ˆì´ì…˜\r\n      const serverFiltered = serverDocs.filter(doc => \r\n        keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n      const localFiltered = localDocs.filter(doc => \r\n        keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n      \r\n      // 3ë‹¨ê³„: ì‚­ì œ ëŒ€ìƒ ë¶„ì„\r\n      const serverToDelete = serverDocs.filter(doc => \r\n        !keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n      const localToDelete = localDocs.filter(doc => \r\n        !keepTitles.some(title => title.toLowerCase() === doc.title.toLowerCase())\r\n      );\r\n      \r\n      // 4ë‹¨ê³„: í†µí•© ì‹œë®¬ë ˆì´ì…˜\r\n      const titleGroups = {};\r\n      [...serverFiltered, ...localFiltered].forEach(doc => {\r\n        const titleKey = doc.title.toLowerCase();\r\n        if (!titleGroups[titleKey]) {\r\n          titleGroups[titleKey] = [];\r\n        }\r\n        titleGroups[titleKey].push(doc);\r\n      });\r\n      \r\n      const mergeResults = [];\r\n      for (const [titleKey, docs] of Object.entries(titleGroups)) {\r\n        const latest = docs.sort((a, b) => \r\n          new Date(b.updatedAt) - new Date(a.updatedAt)\r\n        )[0];\r\n        mergeResults.push({\r\n          title: latest.title,\r\n          selectedSource: latest.source,\r\n          versions: docs.length,\r\n          latestUpdate: latest.updatedAt\r\n        });\r\n      }\r\n      \r\n      const testResult = {\r\n        success: true,\r\n        currentState: {\r\n          server: serverDocs.length,\r\n          local: localDocs.length\r\n        },\r\n        afterFiltering: {\r\n          server: serverFiltered.length,\r\n          local: localFiltered.length\r\n        },\r\n        toDelete: {\r\n          server: serverToDelete.length,\r\n          local: localToDelete.length\r\n        },\r\n        finalMerged: mergeResults.length,\r\n        mergeDetails: mergeResults,\r\n        message: `í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${mergeResults.length}ê°œ ë¬¸ì„œê°€ ìµœì¢… ë³´ì¡´ë©ë‹ˆë‹¤`\r\n      };\r\n      \r\n      logger.info('=== ì•ˆì „í•œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');\r\n      logger.info('ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼:', testResult);\r\n      \r\n      return testResult;\r\n      \r\n    } catch (error) {\r\n      logger.error('ë™ê¸°í™” í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n        message: 'í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * í˜„ì¬ ë™ê¸°í™” ìƒíƒœ ì§„ë‹¨\r\n   */\r\n  async diagnoseCurrentState() {\r\n    logger.info('=== ë™ê¸°í™” ìƒíƒœ ì§„ë‹¨ ì‹œì‘ ===');\r\n    \r\n    try {\r\n      const serverDocs = await this.getServerDocuments();\r\n      const localDocs = this.getLocalDocuments();\r\n      \r\n      // ì œëª©ë³„ ê·¸ë£¹í™”\r\n      const serverTitles = new Set(serverDocs.map(doc => doc.title.toLowerCase()));\r\n      const localTitles = new Set(localDocs.map(doc => doc.title.toLowerCase()));\r\n      \r\n      const onlyServer = serverDocs.filter(doc => \r\n        !localTitles.has(doc.title.toLowerCase())\r\n      );\r\n      const onlyLocal = localDocs.filter(doc => \r\n        !serverTitles.has(doc.title.toLowerCase())\r\n      );\r\n      const both = serverDocs.filter(doc => \r\n        localTitles.has(doc.title.toLowerCase())\r\n      );\r\n      \r\n      const diagnosis = {\r\n        server: {\r\n          total: serverDocs.length,\r\n          titles: Array.from(serverTitles)\r\n        },\r\n        local: {\r\n          total: localDocs.length,\r\n          titles: Array.from(localTitles)\r\n        },\r\n        discrepancies: {\r\n          onlyServer: onlyServer.length,\r\n          onlyLocal: onlyLocal.length,\r\n          both: both.length\r\n        },\r\n        details: {\r\n          onlyServerDocs: onlyServer.map(doc => ({ id: doc.id, title: doc.title })),\r\n          onlyLocalDocs: onlyLocal.map(doc => ({ id: doc.id, title: doc.title })),\r\n          sharedDocs: both.map(doc => ({ id: doc.id, title: doc.title }))\r\n        }\r\n      };\r\n      \r\n      logger.info('ğŸ“Š ì§„ë‹¨ ì™„ë£Œ:', diagnosis);\r\n      return diagnosis;\r\n      \r\n    } catch (error) {\r\n      logger.error('ì§„ë‹¨ ì˜¤ë¥˜:', error);\r\n      return { error: error.message };\r\n    }\r\n  }\r\n}\r\n\r\nexport default DataSyncManager; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\DocumentSearchManager.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'API_TYPE' is assigned a value but never used.","line":9,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15},{"ruleId":"no-unused-vars","severity":1,"message":"'API_KEY' is assigned a value but never used.","line":10,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":14},{"ruleId":"no-unused-vars","severity":1,"message":"'SERVER_URL' is assigned a value but never used.","line":11,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":17},{"ruleId":"no-unused-vars","severity":1,"message":"'CLAUDE_API_URL' is assigned a value but never used.","line":13,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":21}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// DocumentSearchManager.js\n// AI íŒ¨ë„ê³¼ ë§í¬ ìƒì„± ì‚¬ì´ì— ê³µìœ ë˜ëŠ” ë¬¸ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤\n\nimport { createLogger } from '../utils/logger';\nconst logger = createLogger('DocumentSearchManager');\nimport DocumentSummaryManager from './DocumentSummaryManager.js';\n\n// í™˜ê²½ ë³€ìˆ˜ ì²˜ë¦¬ - Jest í˜¸í™˜ì„±ì„ ìœ„í•´ ê¸°ë³¸ê°’ ì‚¬ìš©\nconst API_TYPE = 'claude';\nconst API_KEY = '';\nconst SERVER_URL = 'http://localhost:3001';\n\nconst CLAUDE_API_URL = 'https://api.anthropic.com/v1/messages';\nconst CLAUDE_MODEL = 'claude-3-5-haiku-20241022';\n\n/**\n * ë¬¸ì„œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤\n * í‚¤ì›Œë“œ ê²€ìƒ‰ê³¼ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ì„ ê²°í•©í•˜ì—¬ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì œê³µ\n */\nclass DocumentSearchManager {\n  constructor() {\n    this.summaryManager = new DocumentSummaryManager();\n    this.documentCache = new Map(); // ë¬¸ì„œ IDë¥¼ í‚¤ë¡œ, ë¬¸ì„œ ë‚´ìš© ë° ë©”íƒ€ë°ì´í„°ë¥¼ ê°’ìœ¼ë¡œ ì €ì¥\n    this.documentEmbeddings = new Map(); // ë¬¸ì„œ IDë¥¼ í‚¤ë¡œ, ë¬¸ì„œ ì„ë² ë”©ì„ ê°’ìœ¼ë¡œ ì €ì¥\n    this.maxResults = 10; // ê²€ìƒ‰ ê²°ê³¼ ìµœëŒ€ ê°œìˆ˜\n    this.useAiSearch = true; // AI ê²€ìƒ‰ ì‚¬ìš© ì—¬ë¶€\n    \n    // ì´ˆê¸°í™” ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì§„ë‹¨ ì‹¤í–‰\n    this.analyzeLocalStorage();\n  }\n\n  /**\n   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì „ì²´ ë¶„ì„ - ë””ë²„ê¹…ìš©\n   */\n  analyzeLocalStorage() {\n    try {\n      logger.info(\"===== ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¶„ì„ ì‹œì‘ =====\");\n      const allKeys = Object.keys(localStorage);\n      \n      logger.info(`ì´ ${allKeys.length}ê°œ í•­ëª©ì´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);\n      \n      // í‚¤ íŒ¨í„´ë³„ ë¶„ë¥˜\n      const patterns = {\n        document: allKeys.filter(key => key.includes('document')),\n        title: allKeys.filter(key => key.includes('title')),\n        content: allKeys.filter(key => key.includes('content')),\n        ai: allKeys.filter(key => key.includes('ai')),\n        temp: allKeys.filter(key => key.includes('temp')),\n        other: allKeys.filter(key => \n          !key.includes('document') && \n          !key.includes('title') && \n          !key.includes('content') && \n          !key.includes('ai') &&\n          !key.includes('temp')\n        )\n      };\n      \n      // íŒ¨í„´ë³„ ì¶œë ¥\n      Object.entries(patterns).forEach(([pattern, keys]) => {\n        logger.info(`\\n[${pattern}] íŒ¨í„´: ${keys.length}ê°œ`);\n        keys.slice(0, 5).forEach(key => {\n          const value = localStorage.getItem(key);\n          const valuePreview = value ? \n            (value.length > 50 ? value.substring(0, 50) + '...' : value) : \n            '(ì—†ìŒ)';\n          logger.info(`- ${key}: ${valuePreview}`);\n        });\n        if (keys.length > 5) {\n          logger.info(`... ì™¸ ${keys.length - 5}ê°œ`);\n        }\n      });\n      \n      // miki_document íŒ¨í„´ ìƒì„¸ ë¶„ì„\n      const documentKeys = allKeys.filter(key => key.startsWith('miki_document_'));\n      logger.info(`\\në¬¸ì„œ ë‚´ìš© í‚¤(miki_document_*): ${documentKeys.length}ê°œ`);\n      documentKeys.forEach(key => {\n        const docId = key.replace('miki_document_', '');\n        const content = localStorage.getItem(key);\n        const contentLength = content ? content.length : 0;\n        logger.info(`- ${docId}: ${contentLength}ì`);\n        \n        // ê´€ë ¨ íƒ€ì´í‹€ í™•ì¸\n        const titleKey = `miki_title_${docId}`;\n        const title = localStorage.getItem(titleKey);\n        logger.info(`  ì œëª©: ${title || '(ì—†ìŒ)'}`);\n      });\n      \n      logger.info(\"===== ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¶„ì„ ì™„ë£Œ =====\");\n    } catch (error) {\n      logger.error(\"ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¶„ì„ ì˜¤ë¥˜:\", error);\n    }\n  }\n\n  /**\n   * ëª¨ë“  ê°€ëŠ¥í•œ ë¬¸ì„œ í‚¤ íŒ¨í„´ ìŠ¤ìº” ë° ìˆ˜ì§‘\n   * @returns {Object} - í‚¤ íŒ¨í„´ë³„ ë¬¸ì„œ ì •ë³´\n   */\n  scanDocumentPatterns() {\n    try {\n      logger.info(\"ë¬¸ì„œ ì €ì¥ íŒ¨í„´ ìŠ¤ìº” ì¤‘...\");\n      const allStorageKeys = Object.keys(localStorage);\n      \n      // í‚¤ íŒ¨í„´ ì •ì˜\n      const patterns = {\n        // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì„ì‹œ ë¬¸ì„œ\n        temp: {\n          title: 'miki_editor_title_temp',\n          content: 'miki_editor_content_temp',\n          savedAt: 'miki_editor_saved_at'\n        },\n        // ì €ì¥ëœ ë¬¸ì„œ íŒ¨í„´ë“¤\n        document: {\n          prefix: 'miki_document_',\n          titlePrefix: 'miki_title_'\n        },\n        // ê¸°íƒ€ íŒ¨í„´\n        recentDocs: 'miki_recent_docs',\n        conversations: 'miki_ai_conversations_'\n      };\n      \n      // íŒ¨í„´ë³„ ë¬¸ì„œ ìˆ˜ì§‘\n      const collectedDocs = {};\n      \n      // 1. í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì„ì‹œ ë¬¸ì„œ\n      const tempTitle = localStorage.getItem(patterns.temp.title);\n      const tempContent = localStorage.getItem(patterns.temp.content);\n      const tempSavedAt = localStorage.getItem(patterns.temp.savedAt);\n      \n      if (tempTitle && tempContent) {\n        const tempDoc = {\n          id: this.slugify(tempTitle),\n          title: tempTitle,\n          content: tempContent,\n          savedAt: tempSavedAt,\n          path: `/doc/${this.slugify(tempTitle)}`,\n          isTemp: true\n        };\n        collectedDocs[tempDoc.id] = tempDoc;\n        logger.info(`ì„ì‹œ ë¬¸ì„œ ë°œê²¬: \"${tempTitle}\" (${tempContent.length}ì)`);\n      }\n      \n      // 2. ì €ì¥ëœ ë¬¸ì„œ (miki_document_* íŒ¨í„´)\n      const documentKeys = allStorageKeys.filter(key => key.startsWith(patterns.document.prefix));\n      for (const key of documentKeys) {\n        try {\n          const docId = key.replace(patterns.document.prefix, '');\n          const titleKey = `${patterns.document.titlePrefix}${docId}`;\n          const rawDocContent = localStorage.getItem(key);\n          \n          // JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥ëœ ë¬¸ì„œ íŒŒì‹± ì‹œë„\n          let docContent, docTitle;\n          \n          try {\n            // JSON íŒŒì‹± ì‹œë„\n            const docJson = JSON.parse(rawDocContent);\n            docTitle = docJson.title || localStorage.getItem(titleKey) || docId;\n            docContent = docJson.content || '';\n            \n            logger.info(`JSON íŒŒì‹± ì„±ê³µ: ë¬¸ì„œ \"${docTitle}\" ë‚´ìš© ê¸¸ì´: ${docContent.length}ì`);\n          } catch (e) {\n            // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ì›ë³¸ í…ìŠ¤íŠ¸ ì‚¬ìš©\n            logger.info(`JSON íŒŒì‹± ì‹¤íŒ¨, ì›ë³¸ í…ìŠ¤íŠ¸ ì‚¬ìš©: ${e.message}`);\n            docTitle = localStorage.getItem(titleKey) || docId.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n            docContent = rawDocContent;\n          }\n          \n          if (docId && docContent) {\n            const docObject = {\n              id: docId,\n              title: docTitle,\n              content: docContent,\n              path: `/doc/${docId}`,\n              isDocument: true\n            };\n            collectedDocs[docId] = docObject;\n            logger.info(`ì €ì¥ëœ ë¬¸ì„œ ë°œê²¬: \"${docTitle}\" (${docContent.length}ì)`);\n          }\n        } catch (docError) {\n          logger.error(`ë¬¸ì„œ í‚¤ ${key} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:`, docError);\n        }\n      }\n      \n      // 3. ìµœê·¼ ë¬¸ì„œ ëª©ë¡\n      try {\n        const recentDocsJson = localStorage.getItem(patterns.recentDocs);\n        if (recentDocsJson) {\n          const recentDocs = JSON.parse(recentDocsJson);\n          if (Array.isArray(recentDocs)) {\n            logger.info(`ìµœê·¼ ë¬¸ì„œ ëª©ë¡: ${recentDocs.length}ê°œ`);\n            \n            for (const doc of recentDocs) {\n              if (!doc.id && !doc.title) continue;\n              \n              const docId = doc.id || this.slugify(doc.title);\n              \n              // ì´ë¯¸ ìˆ˜ì§‘ëœ ë¬¸ì„œì¸ì§€ í™•ì¸\n              if (collectedDocs[docId]) {\n                // ì´ë¯¸ ìˆëŠ” ë¬¸ì„œë¼ë©´ ìµœê·¼ ë¬¸ì„œ í”Œë˜ê·¸ ì¶”ê°€\n                collectedDocs[docId].isRecent = true;\n                continue;\n              }\n              \n              // ë¬¸ì„œ ë‚´ìš© ê²€ìƒ‰ì„ ìœ„í•œ ì—¬ëŸ¬ í‚¤ íŒ¨í„´ ì‹œë„\n              const contentPatterns = [\n                `${patterns.document.prefix}${docId}`,\n                `miki_content_${docId}`,\n                `miki_doc_content_${docId}`\n              ];\n              \n              let docContent = null;\n              for (const pattern of contentPatterns) {\n                docContent = localStorage.getItem(pattern);\n                if (docContent) {\n                  logger.info(`\"${doc.title}\" ë¬¸ì„œì˜ ë‚´ìš©ì„ ${pattern} í‚¤ì—ì„œ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);\n                  break;\n                }\n              }\n              \n              // ìµœê·¼ ë¬¸ì„œ ì¶”ê°€\n              collectedDocs[docId] = {\n                id: docId,\n                title: doc.title,\n                content: docContent || '',\n                path: `/doc/${docId}`,\n                isRecent: true\n              };\n            }\n          }\n        }\n      } catch (e) {\n        logger.warn(\"ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì²˜ë¦¬ ì˜¤ë¥˜:\", e);\n      }\n      \n      // ë¬¸ì„œ ìˆ˜ ì¶œë ¥\n      logger.info(`ì´ ${Object.keys(collectedDocs).length}ê°œ ë¬¸ì„œ ë°œê²¬`);\n      \n      return Object.values(collectedDocs);\n    } catch (error) {\n      logger.error(\"ë¬¸ì„œ íŒ¨í„´ ìŠ¤ìº” ì˜¤ë¥˜:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ëª¨ë“  ë¬¸ì„œ ì •ë³´ ë¡œë“œ\n   * @returns {Array} - ë¬¸ì„œ ê°ì²´ ë°°ì—´\n   */\n  getAllDocuments() {\n    try {\n      logger.info(\"ëª¨ë“  ë¬¸ì„œ ì •ë³´ ë¡œë“œ ì¤‘...\");\n      \n      // ê°œì„ ëœ ë¬¸ì„œ íŒ¨í„´ ìŠ¤ìº” ì‚¬ìš©\n      const allDocuments = this.scanDocumentPatterns();\n      \n      // ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ìƒ˜í”Œ ë¬¸ì„œ ì¶”ê°€\n      if (allDocuments.length === 0) {\n        logger.info(\"ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë¬¸ì„œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.\");\n        \n        // ìƒ˜í”Œ ë¬¸ì„œ ì¶”ê°€\n        const sampleDocs = [\n          {\n            id: 'welcome',\n            title: 'Miki ì‚¬ìš©ë²•',\n            content: '# Miki ì‚¬ìš©ë²•\\n\\nMikiëŠ” ë§ˆí¬ë‹¤ìš´ ê¸°ë°˜ ìœ„í‚¤ ì—ë””í„°ì…ë‹ˆë‹¤. ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\\n\\n## ì£¼ìš” ê¸°ëŠ¥\\n\\n- ë§ˆí¬ë‹¤ìš´ í¸ì§‘\\n- AI ì—°ë™\\n- ë¬¸ì„œ ê²€ìƒ‰\\n- ë‚´ìš© ê¸°ë°˜ ë§í¬',\n            path: '/doc/welcome',\n            isCommon: true\n          },\n          {\n            id: 'markdown-guide',\n            title: 'ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ',\n            content: '# ë§ˆí¬ë‹¤ìš´ ê°€ì´ë“œ\\n\\në§ˆí¬ë‹¤ìš´ì€ í…ìŠ¤íŠ¸ ê¸°ë°˜ì˜ ë§ˆí¬ì—… ì–¸ì–´ë¡œ, ì‰½ê²Œ ì½ê³  ì“¸ ìˆ˜ ìˆìœ¼ë©° HTMLë¡œ ë³€í™˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\\n\\n## ë¬¸ë²•\\n\\n### ì œëª©\\n# ì œëª© 1\\n## ì œëª© 2\\n\\n### ê°•ì¡°\\n**êµµê²Œ** ë˜ëŠ” *ê¸°ìš¸ì„*\\n\\n### ë§í¬\\n[ë§í¬ í…ìŠ¤íŠ¸](URL)',\n            path: '/doc/markdown-guide',\n            isCommon: true\n          }\n        ];\n        \n        sampleDocs.forEach(doc => {\n          allDocuments.push(doc);\n        });\n      }\n      \n      // ë¬¸ì„œ ìºì‹œ ì—…ë°ì´íŠ¸\n      allDocuments.forEach(doc => {\n        this.documentCache.set(doc.id, doc);\n      });\n      \n      logger.info(\"ê²€ìƒ‰ ê°€ëŠ¥í•œ ëª¨ë“  ë¬¸ì„œ:\", allDocuments.length, \"ê±´\");\n      return allDocuments;\n    } catch (error) {\n      logger.error(\"ë¬¸ì„œ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * í‚¤ì›Œë“œ ê¸°ë°˜ ë¡œì»¬ ë¬¸ì„œ ê²€ìƒ‰\n   * @param {string} query - ê²€ìƒ‰ì–´\n   * @returns {Promise<Array>} - ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´\n   */\n  async searchByKeyword(query) {\n    if (!query || query.trim().length === 0) return [];\n    \n    logger.info(\"í‚¤ì›Œë“œ ê²€ìƒ‰ ì‹œì‘:\", query);\n    const searchQuery = query.toLowerCase().trim();\n    \n    try {\n      // URL í˜•ì‹ì´ë©´ ê²€ìƒ‰í•˜ì§€ ì•Šê³  ë°”ë¡œ ë°˜í™˜\n      if (/^https?:\\/\\//i.test(searchQuery)) {\n        logger.info(\"URL í˜•ì‹ ê°ì§€:\", searchQuery);\n        return [{ id: 'url', title: `URL: ${searchQuery}`, path: searchQuery, isUrl: true }];\n      }\n      \n      // ë¬¸ì„œ ë¡œë“œ\n      const allDocuments = this.getAllDocuments();\n      logger.info(`ê²€ìƒ‰ ëŒ€ìƒ ë¬¸ì„œ: ${allDocuments.length}ê°œ`);\n      \n      // ê²€ìƒ‰ì–´ë¡œ í•„í„°ë§ (ê°œì„ ëœ ë¡œê·¸ ì¶”ê°€)\n      const searchResults = allDocuments.filter(doc => {\n        const docTitle = (doc.title || '').toLowerCase();\n        \n        // ë‚´ìš© í™•ì¸ - content ì†ì„±ì´ ìˆëŠ”ì§€ í™•ì¸\n        let docContent = '';\n        if (doc.content) {\n          if (typeof doc.content === 'string') {\n            docContent = doc.content.toLowerCase();\n          } else if (typeof doc.content === 'object') {\n            // contentê°€ ê°ì²´ì¸ ê²½ìš° (ë‚´ìš© ë””ë²„ê¹…)\n            logger.info(`ë¬¸ì„œ \"${doc.title}\"ì˜ contentê°€ ê°ì²´ì…ë‹ˆë‹¤:`, doc.content);\n            docContent = JSON.stringify(doc.content).toLowerCase();\n          }\n        }\n        \n        const titleMatch = docTitle.includes(searchQuery);\n        const contentMatch = docContent && docContent.includes(searchQuery);\n        \n        logger.info(`ë¬¸ì„œ \"${doc.title}\" ê²€ìƒ‰ ê²°ê³¼: ì œëª© ì¼ì¹˜=${titleMatch}, ë‚´ìš© ì¼ì¹˜=${contentMatch}`);\n        logger.info(`- ì œëª©: ${docTitle}`);\n        logger.info(`- ë‚´ìš© íƒ€ì…: ${typeof doc.content}`);\n        logger.info(`- ë‚´ìš© ì¼ë¶€: ${docContent ? docContent.substring(0, 50) + '...' : '(ë‚´ìš© ì—†ìŒ)'}`);\n        \n        return titleMatch || contentMatch;\n      });\n      \n      logger.info(`í‚¤ì›Œë“œ \"${searchQuery}\" ê²€ìƒ‰ ê²°ê³¼: ${searchResults.length}ê°œ ë¬¸ì„œ ì¼ì¹˜`);\n      \n      if (searchResults.length > 0) {\n        logger.info(\"í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼:\", searchResults.length, \"ê±´\");\n        \n        // í˜„ì¬ ë¬¸ì„œ > ì œëª© ì¼ì¹˜ > ë‚´ìš© ì¼ì¹˜ ìˆœìœ¼ë¡œ ì •ë ¬\n        return searchResults.sort((a, b) => {\n          if (a.isCurrent && !b.isCurrent) return -1;\n          if (!a.isCurrent && b.isCurrent) return 1;\n          \n          const aTitleMatch = a.title.toLowerCase().includes(searchQuery);\n          const bTitleMatch = b.title.toLowerCase().includes(searchQuery);\n          \n          if (aTitleMatch && !bTitleMatch) return -1;\n          if (!aTitleMatch && bTitleMatch) return 1;\n          \n          return a.title.localeCompare(b.title);\n        }).slice(0, this.maxResults).map(doc => ({\n          id: doc.id,\n          title: doc.title + (doc.isCurrent ? ' (í˜„ì¬ ë¬¸ì„œ)' : doc.isRecent ? ' (ìµœê·¼ ë¬¸ì„œ)' : ''),\n          path: doc.path,\n          preview: doc.content ? doc.content.substring(0, 100) + '...' : null\n        }));\n      }\n      \n      // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ìƒˆ ë¬¸ì„œ ë§Œë“¤ê¸° ì˜µì…˜ ì œê³µ\n      logger.info(\"ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ, ìƒˆ ë¬¸ì„œ ë§Œë“¤ê¸° ì˜µì…˜ ì œê³µ\");\n      return [\n        { \n          id: 'new_' + searchQuery, \n          title: `\"${searchQuery}\" ìƒˆ ë¬¸ì„œ ìƒì„±`, \n          path: `/doc/${this.slugify(searchQuery)}`,\n          preview: `\"${searchQuery}\" ë¬¸ì„œë¥¼ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤.`, \n          isCreateNew: true \n        }\n      ];\n    } catch (error) {\n      logger.error(\"í‚¤ì›Œë“œ ê²€ìƒ‰ ì˜¤ë¥˜:\", error);\n      return [\n        { \n          id: 'error', \n          title: 'ì˜¤ë¥˜ ë°œìƒ - URL ì§ì ‘ ì…ë ¥', \n          path: '#',\n          preview: 'URLì„ ì§ì ‘ ì…ë ¥í•˜ì—¬ ì™¸ë¶€ ë§í¬ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', \n          isError: true \n        }\n      ];\n    }\n  }\n\n  /**\n   * ì˜ë¯¸ ê¸°ë°˜ ë¬¸ì„œ ê²€ìƒ‰ - í† í° ìµœì í™”ëœ ê²€ìƒ‰ êµ¬í˜„\n   * @param {string} query - ê²€ìƒ‰ì–´\n   * @returns {Promise<Array>} - ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´\n   */\n  async searchBySemantic(query) {\n    if (!query || query.trim().length === 0) return [];\n    \n    logger.info(\"ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ì‹œì‘:\", query);\n    \n    try {\n      // 1ë‹¨ê³„: ë¡œì»¬ ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°\n      const allDocuments = this.getAllDocuments();\n      logger.info(`ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ëŒ€ìƒ ë¬¸ì„œ: ${allDocuments.length}ê°œ`);\n      \n      if (allDocuments.length === 0) {\n        logger.info(\"ê²€ìƒ‰ ëŒ€ìƒ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤\");\n        return [];\n      }\n      \n      // 2ë‹¨ê³„: í† í° ìµœì í™”ë¥¼ ìœ„í•œ ë¡œì»¬ í•„í„°ë§\n      // ì¿¼ë¦¬ë¥¼ ì˜ë¯¸ ìˆëŠ” í‚¤ì›Œë“œë¡œ ë¶„ë¦¬\n      const queryText = query.toLowerCase().trim();\n      // ë‹¨ì–´ ìµœì†Œ ê¸¸ì´ë¥¼ 0ìœ¼ë¡œ ë‚®ì¶¤ (ëª¨ë“  ë‹¨ì–´ í—ˆìš©)\n      const queryWords = queryText.split(/\\s+/).filter(word => word.length > 0);\n      \n      logger.info(\"ê²€ìƒ‰ í‚¤ì›Œë“œ:\", queryWords);\n      \n      // ê° ë¬¸ì„œë³„ ê´€ë ¨ë„ ì ìˆ˜ ê³„ì‚° (ê°„ë‹¨í•œ TF-IDF ìœ ì‚¬)\n      const scoredDocuments = allDocuments.map(doc => {\n        try {\n          // ë¬¸ì„œ í…ìŠ¤íŠ¸ ì¤€ë¹„\n          const docTitle = (doc.title || '').toLowerCase();\n          \n          // ë‚´ìš© í™•ì¸ - content ì†ì„±ì´ ìˆëŠ”ì§€ í™•ì¸\n          let docContent = '';\n          if (doc.content) {\n            if (typeof doc.content === 'string') {\n              docContent = doc.content.toLowerCase();\n            } else if (typeof doc.content === 'object') {\n              // contentê°€ ê°ì²´ì¸ ê²½ìš° (ë‚´ìš© ë””ë²„ê¹…)\n              logger.info(`ë¬¸ì„œ \"${doc.title}\"ì˜ contentê°€ ê°ì²´ì…ë‹ˆë‹¤:`, doc.content);\n              docContent = JSON.stringify(doc.content).toLowerCase();\n            }\n          }\n          \n          // ë””ë²„ê¹…ìš© ë¡œê·¸\n          logger.info(`ë¬¸ì„œ \"${doc.title}\" ë‚´ìš© ê²€ìƒ‰ ì‹œì‘ (ë‚´ìš© ê¸¸ì´: ${docContent ? docContent.length : 0}ì)`);\n          logger.info(`- ë‚´ìš© íƒ€ì…: ${typeof doc.content}`);\n          \n          // ê¸°ë³¸ ì ìˆ˜ ê³„ì‚°\n          let score = 0;\n          \n          // ì œëª©ì— ì¿¼ë¦¬ ì „ì²´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ë†’ì€ ì ìˆ˜\n          if (docTitle.includes(queryText)) {\n            score += 15;  // ì ìˆ˜ ìƒí–¥ ì¡°ì •\n            logger.info(`- ì œëª© ì „ì²´ ì¼ì¹˜ (${queryText}): +15ì `);\n          }\n          \n          // ë‚´ìš©ì— ì¿¼ë¦¬ ì „ì²´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì ìˆ˜ ì¶”ê°€\n          if (docContent && docContent.includes(queryText)) {\n            score += 8;  // ì ìˆ˜ ìƒí–¥ ì¡°ì •\n            logger.info(`- ë‚´ìš© ì „ì²´ ì¼ì¹˜ (${queryText}): +8ì `);\n          }\n          \n          // ê° ì¿¼ë¦¬ ë‹¨ì–´ë³„ ì ìˆ˜ ê³„ì‚°\n          for (const word of queryWords) {\n            // ì œëª©ì— ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì ìˆ˜ ì¶”ê°€\n            if (docTitle.includes(word)) {\n              score += 3;\n              logger.info(`- ì œëª© ë‹¨ì–´ ì¼ì¹˜ (${word}): +3ì `);\n            }\n            \n            // ë‚´ìš©ì— ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ì ìˆ˜ ì¶”ê°€ (ê°€ì¤‘ì¹˜ ì¦ê°€)\n            if (docContent && docContent.includes(word)) {\n              score += 2;\n              logger.info(`- ë‚´ìš© ë‹¨ì–´ ì¼ì¹˜ (${word}): +2ì `);\n            }\n            \n            // ë‹¨ì–´ ë°œìƒ ë¹ˆë„ì— ë”°ë¼ ì¶”ê°€ ì ìˆ˜\n            try {\n              const titleMatches = (docTitle.match(new RegExp(word, 'gi')) || []).length;\n              const contentMatches = docContent ? (docContent.match(new RegExp(word, 'gi')) || []).length : 0;\n              \n              score += titleMatches * 0.5;\n              score += contentMatches * 0.3;\n              \n              if (titleMatches > 0 || contentMatches > 0) {\n                logger.info(`- ë‹¨ì–´ ë¹ˆë„ (${word}): ì œëª©=${titleMatches}íšŒ, ë‚´ìš©=${contentMatches}íšŒ, +${titleMatches * 0.5 + contentMatches * 0.3}ì `);\n              }\n            } catch (regexError) {\n              logger.warn(`ì •ê·œì‹ ì˜¤ë¥˜ (${word}):`, regexError);\n            }\n          }\n          \n          // ë¬¸ì„œ ì¶”ê°€ ê°€ì¤‘ì¹˜\n          let finalScore = score;\n          \n          if (doc.content && doc.content.length > 0) {\n            finalScore *= 1.2;  // ë‚´ìš©ì´ ìˆëŠ” ë¬¸ì„œ ìš°ëŒ€\n            logger.info(`- ë‚´ìš© ì¡´ì¬ ê°€ì¤‘ì¹˜: x1.2 (${score} -> ${finalScore})`);\n          }\n          \n          if (doc.isTemp) {\n            finalScore *= 1.5;  // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ë¬¸ì„œ ìš°ëŒ€\n            logger.info(`- í˜„ì¬ ë¬¸ì„œ ê°€ì¤‘ì¹˜: x1.5 (${score} -> ${finalScore})`);\n          } else if (doc.isRecent) {\n            finalScore *= 1.3;  // ìµœê·¼ ë¬¸ì„œ ìš°ëŒ€\n            logger.info(`- ìµœê·¼ ë¬¸ì„œ ê°€ì¤‘ì¹˜: x1.3 (${score} -> ${finalScore})`);\n          }\n          \n          logger.info(`ë¬¸ì„œ \"${doc.title}\" ìµœì¢… ì ìˆ˜: ${finalScore}`);\n          \n          return { ...doc, score: finalScore };\n        } catch (docError) {\n          logger.error(`ë¬¸ì„œ \"${doc.title}\" ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜:`, docError);\n          return { ...doc, score: 0 };\n        }\n      });\n      \n      // ë””ë²„ê¹…ìš©: ê° ë¬¸ì„œì˜ ì ìˆ˜ í™•ì¸ (ìƒìœ„ 5ê°œë§Œ)\n      const top5Docs = [...scoredDocuments]\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 5);\n      \n      top5Docs.forEach(doc => {\n        logger.info(`ë¬¸ì„œ \"${doc.title}\" ì ìˆ˜: ${doc.score}`);\n      });\n      \n      // ì ìˆ˜ ê¸°ì¤€ ì •ë ¬ ë° í•„í„°ë§\n      const sortedDocuments = scoredDocuments\n        .filter(doc => doc.score > 0.5)  // ë‚®ì€ ì ìˆ˜ ë¬¸ì„œ ì œì™¸ (ì„ê³„ê°’ ë‚®ì¶¤)\n        .sort((a, b) => b.score - a.score);  // ì ìˆ˜ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬\n      \n      // 3ë‹¨ê³„: ìµœì¢… ê²°ê³¼ êµ¬ì„±\n      // ìƒìœ„ ê²°ê³¼ë§Œ ë°˜í™˜ (í† í° ìµœì í™”)\n      const topResults = sortedDocuments.slice(0, this.maxResults);\n      \n      if (topResults.length > 0) {\n        logger.info(`ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼: ${topResults.length}ê±´`);\n        return topResults.map(doc => ({\n          id: doc.id,\n          title: doc.title + (doc.isTemp ? ' (í˜„ì¬ ë¬¸ì„œ)' : doc.isRecent ? ' (ìµœê·¼ ë¬¸ì„œ)' : ''),\n          path: doc.path || `/doc/${doc.id}`,\n          preview: this.generatePreview(doc.content, queryText),\n          score: doc.score,\n          isSemanticMatch: true\n        }));\n      }\n      \n      // 4ë‹¨ê³„: ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš° ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ ì œê³µ\n      logger.info(\"ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ, ìƒˆ ë¬¸ì„œ ì˜µì…˜ ì œê³µ\");\n      return [{ \n        id: 'new_' + queryText, \n        title: `\"${queryText}\" ìƒˆ ë¬¸ì„œ ìƒì„±`, \n        path: `/doc/${this.slugify(queryText)}`,\n        preview: `\"${queryText}\"ì— ê´€í•œ ìƒˆ ë¬¸ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.`, \n        isCreateNew: true,\n        isSemanticMatch: true\n      }];\n    } catch (error) {\n      logger.error(\"ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ì˜¤ë¥˜:\", error);\n      return [];\n    }\n  }\n  \n  /**\n   * ê²€ìƒ‰ì–´ ì£¼ë³€ ë¬¸ë§¥ì„ ì¶”ì¶œí•˜ì—¬ ë¯¸ë¦¬ë³´ê¸° ìƒì„±\n   * @param {string|object} content - ë¬¸ì„œ ë‚´ìš© (ë¬¸ìì—´ ë˜ëŠ” ê°ì²´)\n   * @param {string} query - ê²€ìƒ‰ì–´\n   * @returns {string} - ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸\n   */\n  generatePreview(content, query) {\n    if (!content || !query) return '';\n    \n    // contentê°€ ê°ì²´ì¸ ê²½ìš° ë¬¸ìì—´ë¡œ ë³€í™˜\n    let contentStr = '';\n    if (typeof content === 'string') {\n      contentStr = content;\n    } else if (typeof content === 'object') {\n      // contentê°€ ê°ì²´ì´ê³  content.contentê°€ ìˆìœ¼ë©´ í•´ë‹¹ ê°’ ì‚¬ìš©\n      if (content.content && typeof content.content === 'string') {\n        contentStr = content.content;\n      } else {\n        // ê·¸ ì™¸ì˜ ê²½ìš° JSON ë¬¸ìì—´ë¡œ ë³€í™˜\n        contentStr = JSON.stringify(content);\n      }\n    }\n    \n    // ë§ˆí¬ë‹¤ìš´ íƒœê·¸ ì œê±°\n    const cleanContent = contentStr.replace(/\\[(.*?)\\]\\(.*?\\)/g, '$1')\n                               .replace(/[*#_~`>]/g, '');\n    \n    // ê²€ìƒ‰ì–´ ìœ„ì¹˜ ì°¾ê¸°\n    const queryPosition = cleanContent.toLowerCase().indexOf(query.toLowerCase());\n    \n    if (queryPosition === -1) {\n      // ê²€ìƒ‰ì–´ê°€ ì •í™•íˆ ì—†ìœ¼ë©´ ë¬¸ì„œ ì•ë¶€ë¶„ ë°˜í™˜\n      return cleanContent.slice(0, 100) + '...';\n    }\n    \n    // ê²€ìƒ‰ì–´ ì£¼ë³€ ë¬¸ë§¥ ì¶”ì¶œ (ì•ë’¤ 50ì)\n    const start = Math.max(0, queryPosition - 50);\n    const end = Math.min(cleanContent.length, queryPosition + query.length + 50);\n    \n    let preview = cleanContent.slice(start, end);\n    \n    // ì‹œì‘/ë ë¶€ë¶„ ì²˜ë¦¬\n    if (start > 0) preview = '...' + preview;\n    if (end < cleanContent.length) preview = preview + '...';\n    \n    return preview;\n  }\n\n  /**\n   * AIë¥¼ í™œìš©í•œ ë¬¸ì„œ ê²€ìƒ‰ (Claude API ì‚¬ìš©)\n   * @param {string} query - ê²€ìƒ‰ì–´\n   * @returns {Promise<Array>} - ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´\n   */\n  async searchByAi(query) {\n    if (!query || query.trim().length === 0) return [];\n    \n    logger.info(\"AI ê¸°ë°˜ ê²€ìƒ‰ ì‹œì‘:\", query);\n    const searchQuery = query.toLowerCase().trim();\n    \n    try {\n      // ë¬¸ì„œ ë¡œë“œ\n      const allDocuments = this.getAllDocuments();\n      logger.info(`AI ê²€ìƒ‰ ëŒ€ìƒ ë¬¸ì„œ: ${allDocuments.length}ê°œ`);\n      \n      if (allDocuments.length === 0) {\n        return [];\n      }\n      \n      // ëª¨ë“  ë¬¸ì„œ ë‚´ìš© í†µí•© (AIì— ì „ì†¡í•  ì»¨í…ìŠ¤íŠ¸)\n      let documentsContext = \"ê²€ìƒ‰ ê°€ëŠ¥í•œ ë¬¸ì„œ ëª©ë¡:\\n\\n\";\n      allDocuments.forEach((doc, index) => {\n        let docContent = '';\n        if (typeof doc.content === 'string') {\n          docContent = doc.content.substring(0, 200); // ë‚´ìš©ì€ ì¼ë¶€ë§Œ í¬í•¨\n        } else if (typeof doc.content === 'object') {\n          docContent = doc.content.content || JSON.stringify(doc.content).substring(0, 200);\n        }\n        \n        documentsContext += `${index + 1}. ì œëª©: ${doc.title}\\n`;\n        documentsContext += `   ë‚´ìš© ì¼ë¶€: ${docContent}...\\n\\n`;\n      });\n      \n      // Claude API ìš”ì²­ êµ¬ì„±\n      const prompt = `\në‹¹ì‹ ì€ ë¬¸ì„œ ê²€ìƒ‰ ë„ìš°ë¯¸ì…ë‹ˆë‹¤. ì•„ë˜ ë¬¸ì„œ ëª©ë¡ì—ì„œ ë‹¤ìŒ ê²€ìƒ‰ì–´ì™€ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ë¬¸ì„œë¥¼ ì°¾ì•„ ë¬¸ì„œ ì œëª©, ê´€ë ¨ì„± ì ìˆ˜, ê°„ë‹¨í•œ ì´ìœ ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”.\n\nê²€ìƒ‰ì–´: \"${searchQuery}\"\n\n${documentsContext}\n\nê²€ìƒ‰ ê²°ê³¼ëŠ” ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•´ì£¼ì„¸ìš”:\n\\`\\`\\`json\n{\n  \"results\": [\n    {\n      \"title\": \"ë¬¸ì„œ ì œëª©\",\n      \"score\": 0.95,\n      \"reason\": \"ì´ ë¬¸ì„œê°€ ê²€ìƒ‰ì–´ì™€ ê´€ë ¨ì´ ìˆëŠ” ì´ìœ ì— ëŒ€í•œ ê°„ë‹¨í•œ ì„¤ëª…\"\n    },\n    ...\n  ]\n}\n\\`\\`\\`\n\nìµœëŒ€ ${this.maxResults}ê°œì˜ ê´€ë ¨ ë¬¸ì„œë§Œ í¬í•¨í•´ ì£¼ì„¸ìš”. ê´€ë ¨ì„±ì´ ë†’ì€ ìˆœì„œë¡œ ì •ë ¬í•´ ì£¼ì„¸ìš”.\n`;\n\n      // ë°±ì—”ë“œ í”„ë¡ì‹œ ì„œë²„ë¥¼ í†µí•´ API í˜¸ì¶œ\n      const response = await fetch('http://localhost:3003/api/claude', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          model: CLAUDE_MODEL,\n          messages: [\n            {\n              role: \"user\",\n              content: [\n                {\n                  type: \"text\",\n                  text: prompt\n                }\n              ]\n            }\n          ],\n          max_tokens: 2000,\n          temperature: 0.1,\n        }),\n      });\n      \n      if (!response.ok) {\n        throw new Error(`AI ê²€ìƒ‰ API ì˜¤ë¥˜: ${response.status}`);\n      }\n      \n      const responseData = await response.json();\n      logger.info(\"AI ê²€ìƒ‰ ì‘ë‹µ:\", responseData);\n      \n      // ì‘ë‹µì—ì„œ JSON íŒŒì‹±\n      const textContent = responseData.content\n        .filter(item => item.type === 'text')\n        .map(item => item.text)\n        .join('\\n');\n      \n      const jsonMatch = textContent.match(/```json\\s*([\\s\\S]*?)\\s*```/);\n      if (!jsonMatch || !jsonMatch[1]) {\n        throw new Error(\"AI ì‘ë‹µì—ì„œ JSON í˜•ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤\");\n      }\n      \n      const aiResults = JSON.parse(jsonMatch[1]);\n      logger.info(\"íŒŒì‹±ëœ AI ê²€ìƒ‰ ê²°ê³¼:\", aiResults);\n      \n      // AI ê²°ê³¼ë¥¼ ì‹¤ì œ ë¬¸ì„œì™€ ë§¤í•‘\n      const mappedResults = aiResults.results.map(result => {\n        const matchedDoc = allDocuments.find(doc => \n          doc.title.toLowerCase() === result.title.toLowerCase() ||\n          doc.title.toLowerCase().includes(result.title.toLowerCase()) ||\n          result.title.toLowerCase().includes(doc.title.toLowerCase())\n        );\n        \n        if (matchedDoc) {\n          return {\n            id: matchedDoc.id,\n            title: matchedDoc.title,\n            path: matchedDoc.path,\n            preview: result.reason,\n            score: result.score,\n            isAiMatch: true\n          };\n        }\n        \n        // ë§¤ì¹­ë˜ëŠ” ë¬¸ì„œê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ê²°ê³¼ ë°˜í™˜\n        return {\n          id: this.slugify(result.title),\n          title: result.title,\n          path: `/doc/${this.slugify(result.title)}`,\n          preview: result.reason,\n          score: result.score,\n          isAiMatch: true,\n          isCreateNew: true\n        };\n      });\n      \n      logger.info(\"ìµœì¢… AI ê²€ìƒ‰ ê²°ê³¼:\", mappedResults);\n      return mappedResults;\n    } catch (error) {\n      logger.error(\"AI ê²€ìƒ‰ ì˜¤ë¥˜:\", error);\n      // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ í‚¤ì›Œë“œ ê²€ìƒ‰ìœ¼ë¡œ í´ë°±\n      logger.info(\"AI ê²€ìƒ‰ ì‹¤íŒ¨, í‚¤ì›Œë“œ ê²€ìƒ‰ìœ¼ë¡œ ëŒ€ì²´\");\n      return await this.searchByKeyword(query);\n    }\n  }\n\n  /**\n   * í†µí•© ê²€ìƒ‰ - AI ê²€ìƒ‰ ë˜ëŠ” í‚¤ì›Œë“œ ê²€ìƒ‰ì„ ì„ íƒì ìœ¼ë¡œ ì‚¬ìš©\n   * @param {string} query - ê²€ìƒ‰ì–´\n   * @returns {Promise<Array>} - ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´\n   */\n  async searchDocuments(query) {\n    logger.info(\"í†µí•© ë¬¸ì„œ ê²€ìƒ‰ ì‹œì‘:\", query);\n    if (!query || query.trim().length === 0) return [];\n    \n    try {\n      // URL í˜•ì‹ í™•ì¸\n      if (/^https?:\\/\\//i.test(query.trim())) {\n        logger.info(\"URL í˜•ì‹ ê°ì§€:\", query);\n        return [{ id: 'url', title: `URL: ${query.trim()}`, path: query.trim(), isUrl: true }];\n      }\n      \n      if (this.useAiSearch) {\n        // AI ê²€ìƒ‰ ì‚¬ìš© ì‹œ\n        logger.info(\"AI ê²€ìƒ‰ ëª¨ë“œë¡œ ì‹¤í–‰\");\n        const aiResults = await this.searchByAi(query);\n        \n        if (aiResults.length > 0) {\n          logger.info(\"AI ê²€ìƒ‰ ê²°ê³¼ ì°¾ìŒ:\", aiResults.length);\n          return aiResults;\n        }\n      }\n      \n      // AI ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ê±°ë‚˜ AI ê²€ìƒ‰ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²½ìš° ê¸°ì¡´ ë¡œì§ ì‹¤í–‰\n      // 1ë‹¨ê³„: í‚¤ì›Œë“œ ê²€ìƒ‰ ë¨¼ì € ì‹œë„\n      logger.info(\"í‚¤ì›Œë“œ ê²€ìƒ‰ ì‹œì‘\");\n      const keywordResults = await this.searchByKeyword(query);\n      \n      // í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆê³ , ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ë§Œ ìˆëŠ” ê²ƒì´ ì•„ë‹ˆë©´ ê²°ê³¼ ë°˜í™˜\n      if (keywordResults.length > 0 && !keywordResults.some(result => result.isCreateNew)) {\n        logger.info(\"í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ ì°¾ìŒ:\", keywordResults.length);\n        return keywordResults;\n      }\n      \n      // 2ë‹¨ê³„: í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ê±°ë‚˜ ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ë§Œ ìˆìœ¼ë©´ ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ì‹¤í–‰\n      logger.info(\"ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ìœ¼ë¡œ ì „í™˜\");\n      const semanticResults = await this.searchBySemantic(query);\n      \n      // ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ì—ì„œ ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ì´ ì•„ë‹Œ ê²°ê³¼ê°€ ìˆëŠ” ê²½ìš°\n      if (semanticResults.length > 0 && semanticResults.some(result => !result.isCreateNew)) {\n        logger.info(\"ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ ë°˜í™˜:\", semanticResults.length);\n        return semanticResults;\n      }\n      \n      // 3ë‹¨ê³„: ë‘ ê²€ìƒ‰ ëª¨ë‘ ì‹¤ì œ ê²°ê³¼ê°€ ì—†ê³  ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ë§Œ ìˆëŠ” ê²½ìš°\n      if (keywordResults.length > 0) {\n        logger.info(\"ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ë§Œ ìˆìŒ, í‚¤ì›Œë“œ ê²€ìƒ‰ ê²°ê³¼ ë°˜í™˜\");\n        return keywordResults;\n      }\n      \n      logger.info(\"ìƒˆ ë¬¸ì„œ ìƒì„± ì˜µì…˜ë§Œ ìˆìŒ, ì˜ë¯¸ ê¸°ë°˜ ê²€ìƒ‰ ê²°ê³¼ ë°˜í™˜\");\n      return semanticResults;\n    } catch (error) {\n      logger.error(\"í†µí•© ë¬¸ì„œ ê²€ìƒ‰ ì˜¤ë¥˜:\", error);\n      return [{ \n        id: 'error', \n        title: 'ì˜¤ë¥˜ ë°œìƒ - ê²€ìƒ‰ ì‹¤íŒ¨', \n        path: '#',\n        preview: 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ URLì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.', \n        isError: true \n      }];\n    }\n  }\n\n  /**\n   * ë¬¸ìì—´ì„ ìŠ¬ëŸ¬ê·¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (URL ì¹œí™”ì ì¸ í˜•ì‹)\n   * @param {string} str - ë³€í™˜í•  ë¬¸ìì—´\n   * @returns {string} - ìŠ¬ëŸ¬ê·¸ í˜•ì‹ì˜ ë¬¸ìì—´\n   */\n  slugify(str) {\n    return str\n      .toLowerCase()\n      .trim()\n      .replace(/[\\s\\W-]+/g, '-') // ê³µë°±, íŠ¹ìˆ˜ë¬¸ìë¥¼ í•˜ì´í”ˆìœ¼ë¡œ ë³€í™˜\n      .replace(/^-+|-+$/g, '');  // ì‹œì‘/ë í•˜ì´í”ˆ ì œê±°\n  }\n\n  /**\n   * ì‚¬ìš©ì ì§€ì • ë¬¸ì„œë§Œ ë³´ì¡´í•˜ëŠ” ê°•ë ¥í•œ ì •ë¦¬ í•¨ìˆ˜\n   * @param {Array} keepTitles - ë³´ì¡´í•  ë¬¸ì„œ ì œëª© ë°°ì—´\n   * @param {boolean} dryRun - trueë©´ ì‹¤ì œ ì‚­ì œí•˜ì§€ ì•Šê³  ë¡œê·¸ë§Œ ì¶œë ¥\n   * @returns {Object} - ì •ë¦¬ ê²°ê³¼ í†µê³„\n   */\n  cleanupKeepOnlySpecified(keepTitles = ['ì œë‹ˆ', 'ë¡œì œ', 'ì•„íŒŒíŠ¸', 'ë¨ì‹œë¦¬', 'ë¸”ë™í•‘í¬'], dryRun = false) {\n    logger.info(`=== ì§€ì • ë¬¸ì„œë§Œ ë³´ì¡´ ì •ë¦¬ ${dryRun ? '(ì‹œë®¬ë ˆì´ì…˜)' : '(ì‹¤ì œ ì‹¤í–‰)'} ===`);\n    logger.info(`ë³´ì¡´í•  ë¬¸ì„œ: ${keepTitles.join(', ')}`);\n    \n    const stats = {\n      totalDocuments: 0,\n      preservedDocuments: 0,\n      deletedDocuments: 0,\n      spaceSaved: 0,\n      backupCreated: false,\n      errors: []\n    };\n    \n    try {\n      // 1ë‹¨ê³„: ëª¨ë“  ë¬¸ì„œ ìˆ˜ì§‘\n      const documentKeys = Object.keys(localStorage).filter(key => key.startsWith('miki_document_'));\n      stats.totalDocuments = documentKeys.length;\n      \n      logger.info(`ğŸ“Š ë¶„ì„ ì‹œì‘: ì´ ${documentKeys.length}ê°œ ë¬¸ì„œ ë°œê²¬`);\n      \n      // 2ë‹¨ê³„: ë°±ì—… ìƒì„± (ì‚­ì œí•  ë¬¸ì„œê°€ ìˆì„ ë•Œë§Œ)\n      if (!dryRun) {\n        // ë¨¼ì € ì‚­ì œí•  ë¬¸ì„œê°€ ìˆëŠ”ì§€ ë¯¸ë¦¬ í™•ì¸\n        let hasDocumentsToDelete = false;\n        for (const key of documentKeys) {\n          try {\n            const docData = JSON.parse(localStorage.getItem(key));\n            if (!docData || !docData.title) {\n              hasDocumentsToDelete = true;\n              break;\n            }\n            const title = docData.title.trim().toLowerCase();\n            const shouldKeep = keepTitles.some(keepTitle => \n              title === keepTitle.toLowerCase()\n            );\n            if (!shouldKeep) {\n              hasDocumentsToDelete = true;\n              break;\n            }\n          } catch (e) {\n            hasDocumentsToDelete = true;\n            break;\n          }\n        }\n        \n        // ì‚­ì œí•  ë¬¸ì„œê°€ ìˆì„ ë•Œë§Œ ë°±ì—… ìƒì„±\n        if (hasDocumentsToDelete) {\n          const backupData = {};\n          documentKeys.forEach(key => {\n            backupData[key] = localStorage.getItem(key);\n          });\n          \n          const backupKey = `miki_backup_manual_${Date.now()}`;\n          localStorage.setItem(backupKey, JSON.stringify({\n            timestamp: new Date().toISOString(),\n            documents: backupData,\n            type: 'manual_cleanup'\n          }));\n          stats.backupCreated = true;\n          logger.info(`âœ… ë°±ì—… ì™„ë£Œ: ${backupKey}`);\n        } else {\n          logger.info(`â­ï¸ ë°±ì—… ê±´ë„ˆëœ€: ì‚­ì œí•  ë¬¸ì„œê°€ ì—†ìŒ`);\n        }\n      }\n      \n      // 3ë‹¨ê³„: ë¬¸ì„œ ë¶„ë¥˜ ë° ì¤‘ë³µ ì œê±°\n      const preserveList = [];\n      const deleteList = [];\n      const titleGroups = {}; // ì œëª©ë³„ ê·¸ë£¹í™”\n      \n      // ë¨¼ì € ì œëª©ë³„ë¡œ ê·¸ë£¹í™”\n      for (const key of documentKeys) {\n        try {\n          const docData = JSON.parse(localStorage.getItem(key));\n          \n          if (!docData || !docData.title) {\n            deleteList.push({ key, reason: 'ì œëª© ì—†ìŒ', size: localStorage.getItem(key)?.length || 0 });\n            continue;\n          }\n          \n          const title = docData.title.trim().toLowerCase();\n          \n          if (!titleGroups[title]) {\n            titleGroups[title] = [];\n          }\n          \n          titleGroups[title].push({\n            key,\n            title: docData.title,\n            data: docData,\n            updatedAt: new Date(docData.updatedAt || 0)\n          });\n          \n        } catch (e) {\n          deleteList.push({ key, reason: 'íŒŒì‹± ì˜¤ë¥˜', size: localStorage.getItem(key)?.length || 0 });\n          logger.info(`âŒ ì‚­ì œ ì˜ˆì •: ${key} - íŒŒì‹± ì˜¤ë¥˜`);\n        }\n      }\n      \n      // ê° ì œëª© ê·¸ë£¹ì—ì„œ ì²˜ë¦¬\n      for (const [titleLower, docs] of Object.entries(titleGroups)) {\n        const shouldKeep = keepTitles.some(keepTitle => \n          titleLower === keepTitle.toLowerCase()\n        );\n        \n        if (shouldKeep) {\n          // ë³´ì¡´í•  ì œëª©ì¸ ê²½ìš°: ìµœì‹  ë¬¸ì„œë§Œ ë³´ì¡´, ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œ\n          docs.sort((a, b) => b.updatedAt - a.updatedAt); // ìµœì‹ ìˆœ ì •ë ¬\n          \n          const latestDoc = docs[0]; // ê°€ì¥ ìµœì‹  ë¬¸ì„œ\n          const duplicates = docs.slice(1); // ë‚˜ë¨¸ì§€ ì¤‘ë³µ ë¬¸ì„œë“¤\n          \n          preserveList.push(latestDoc);\n          logger.info(`âœ… ë³´ì¡´: ${latestDoc.key} - \"${latestDoc.title}\" (ìµœì‹  ë²„ì „)`);\n          \n          // ì¤‘ë³µ ë¬¸ì„œë“¤ì€ ì‚­ì œ ëª©ë¡ì— ì¶”ê°€\n          for (const duplicate of duplicates) {\n            deleteList.push({\n              key: duplicate.key,\n              title: duplicate.title,\n              reason: `ì¤‘ë³µ ë¬¸ì„œ (${latestDoc.key}ê°€ ìµœì‹ )`,\n              size: localStorage.getItem(duplicate.key)?.length || 0\n            });\n            logger.info(`âŒ ì‚­ì œ ì˜ˆì •: ${duplicate.key} - \"${duplicate.title}\" (ì¤‘ë³µ)`);\n          }\n        } else {\n          // ë³´ì¡´í•˜ì§€ ì•Šì„ ì œëª©ì¸ ê²½ìš°: ëª¨ë“  ë¬¸ì„œ ì‚­ì œ\n          for (const doc of docs) {\n            deleteList.push({\n              key: doc.key,\n              title: doc.title,\n              reason: 'ì§€ì • ëª©ë¡ì— ì—†ìŒ',\n              size: localStorage.getItem(doc.key)?.length || 0\n            });\n            logger.info(`âŒ ì‚­ì œ ì˜ˆì •: ${doc.key} - \"${doc.title}\" (ë³´ì¡´ ëª©ë¡ì— ì—†ìŒ)`);\n          }\n        }\n      }\n      \n      stats.preservedDocuments = preserveList.length;\n      stats.deletedDocuments = deleteList.length;\n      \n      // 4ë‹¨ê³„: ì‹¤ì œ ì‚­ì œ ì‹¤í–‰\n      logger.info(`\\nğŸ”¥ ì‚­ì œ ì‹¤í–‰: ${deleteList.length}ê°œ ë¬¸ì„œ`);\n      \n      if (!dryRun && deleteList.length > 0) {\n        let successCount = 0;\n        \n        for (const item of deleteList) {\n          try {\n            localStorage.removeItem(item.key);\n            \n            // ê´€ë ¨ ì œëª© í‚¤ë„ ì‚­ì œ\n            const titleKey = item.key.replace('miki_document_', 'miki_title_');\n            if (localStorage.getItem(titleKey)) {\n              localStorage.removeItem(titleKey);\n            }\n            \n            stats.spaceSaved += item.size;\n            successCount++;\n            logger.info(`  âœ… ì‚­ì œ ì™„ë£Œ: ${item.key}`);\n          } catch (error) {\n            logger.error(`  âŒ ì‚­ì œ ì‹¤íŒ¨: ${item.key}`, error);\n            stats.errors.push(`ì‚­ì œ ì‹¤íŒ¨: ${item.key} - ${error.message}`);\n          }\n        }\n        \n        logger.info(`âœ… ì‚­ì œ ì™„ë£Œ: ${successCount}/${deleteList.length}ê°œ`);\n      }\n      \n      // 5ë‹¨ê³„: ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì¬êµ¬ì„±\n      if (!dryRun && deleteList.length > 0) {\n        try {\n          const remainingDocs = preserveList.map(item => ({\n            id: item.data.id || item.key.replace('miki_document_', ''),\n            title: item.data.title,\n            updatedAt: item.data.updatedAt || new Date().toISOString()\n          }));\n          \n          remainingDocs.sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\n          localStorage.setItem('miki_recent_docs', JSON.stringify(remainingDocs));\n          \n          logger.info(`ğŸ“ ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì¬êµ¬ì„±: ${remainingDocs.length}ê°œ`);\n        } catch (error) {\n          logger.error('ìµœê·¼ ë¬¸ì„œ ëª©ë¡ ì¬êµ¬ì„± ì˜¤ë¥˜:', error);\n        }\n      }\n      \n      // 6ë‹¨ê³„: ê²°ê³¼ ë³´ê³ \n      logger.info(`\\nğŸ“Š === ì •ë¦¬ ì™„ë£Œ ë³´ê³ ì„œ ===`);\n      logger.info(`ì´ ë¬¸ì„œ: ${stats.totalDocuments}ê°œ`);\n      logger.info(`ë³´ì¡´ëœ ë¬¸ì„œ: ${stats.preservedDocuments}ê°œ`);\n      logger.info(`ì‚­ì œëœ ë¬¸ì„œ: ${stats.deletedDocuments}ê°œ`);\n      logger.info(`ì ˆì•½ëœ ê³µê°„: ${(stats.spaceSaved / 1024).toFixed(1)}KB`);\n      \n      if (stats.backupCreated) {\n        logger.info(`\\nğŸ›¡ï¸ ë°±ì—… ì •ë³´:`);\n        logger.info(`ë°±ì—… í‚¤: miki_backup_manual_*`);\n        logger.info(`ë³µêµ¬ ë°©ë²•: ê°œë°œì ë„êµ¬ì—ì„œ ë°±ì—… í‚¤ë¡œ ê²€ìƒ‰í•˜ì—¬ ë³µêµ¬ ê°€ëŠ¥`);\n      }\n      \n      if (stats.errors.length > 0) {\n        logger.info(`\\nâš ï¸ ì˜¤ë¥˜ ${stats.errors.length}ê°œ:`);\n        stats.errors.forEach(error => logger.info(`  - ${error}`));\n      }\n      \n    } catch (error) {\n      logger.error('ì§€ì • ë¬¸ì„œ ë³´ì¡´ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);\n      stats.errors.push(`ì •ë¦¬ ì˜¤ë¥˜: ${error.message}`);\n    }\n    \n    return stats;\n  }\n}\n\nexport default DocumentSearchManager; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\DocumentSummaryManager.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'API_TYPE' is assigned a value but never used.","line":10,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// DocumentSummaryManager.js\n// ë¬¸ì„œë¥¼ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ë³€í™˜í•˜ê³  ì„¹ì…˜ë³„ë¡œ ìš”ì•½í•˜ëŠ” í´ë˜ìŠ¤\n\n/**\n * ë¬¸ì„œ ìš”ì•½ ê´€ë¦¬ í´ë˜ìŠ¤\n * Claude APIë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì„œ ìš”ì•½ ìƒì„± ë° ê´€ë¦¬\n */\n\n// API íƒ€ì… ì„¤ì • - ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•´ ê¸°ë³¸ê°’ ì‚¬ìš©\nconst API_TYPE = (typeof process !== 'undefined' && process.env?.VITE_AI_API_TYPE) || 'claude';\n\n/**\n * ë¬¸ì„œ ìš”ì•½ ë° ë³€í™˜ì„ ì²˜ë¦¬í•˜ëŠ” í´ë˜ìŠ¤\n * AI ì²˜ë¦¬ë¥¼ ìœ„í•œ í† í° ìµœì í™”ì™€ ë¬¸ë§¥ ê´€ë¦¬ë¥¼ ë‹´ë‹¹\n */\nclass DocumentSummaryManager {\n  constructor() {\n    this.summaries = new Map(); // ë¬¸ì„œ ID ë˜ëŠ” ê²½ë¡œë¥¼ í‚¤ë¡œ, ìš”ì•½ ì •ë³´ë¥¼ ê°’ìœ¼ë¡œ ì €ì¥\n    this.maxSectionLength = 1000; // ì„¹ì…˜ë‹¹ ìµœëŒ€ ë¬¸ì ìˆ˜ (ì•½ 250 í† í°)\n    this.maxSummaryLength = 150; // ìš”ì•½ë‹¹ ìµœëŒ€ ë¬¸ì ìˆ˜ (ì•½ 40 í† í°)\n  }\n\n  /**\n   * ë¬¸ì„œë¥¼ ì„¹ì…˜ìœ¼ë¡œ ë¶„í• í•˜ê³  ìš”ì•½ ìƒì„±\n   * @param {string} documentId - ë¬¸ì„œ ì‹ë³„ì\n   * @param {string} content - ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ë¬¸ì„œ ë‚´ìš©\n   * @returns {Object} - ì„¹ì…˜ ë° ìš”ì•½ ì •ë³´ë¥¼ í¬í•¨í•œ ê°ì²´\n   */\n  processDocument(documentId, content) {\n    if (!content) return null;\n\n    // ë¬¸ì„œë¥¼ í—¤ë”©ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¹ì…˜ìœ¼ë¡œ ë¶„í• \n    const sections = this._splitIntoSections(content);\n    \n    // ê° ì„¹ì…˜ì— ëŒ€í•œ ìš”ì•½ ìƒì„±\n    const processedSections = sections.map(section => {\n      const summary = this._generateSummary(section.content);\n      return {\n        ...section,\n        summary: summary\n      };\n    });\n\n    // ë¬¸ì„œ ì „ì²´ ìš”ì•½ ìƒì„±\n    const documentSummary = this._generateDocumentSummary(processedSections);\n    \n    // ê²°ê³¼ ê°ì²´ ìƒì„± ë° ìºì‹œ ì €ì¥\n    const result = {\n      id: documentId,\n      summary: documentSummary,\n      sections: processedSections,\n      lastUpdated: new Date().toISOString()\n    };\n    \n    this.summaries.set(documentId, result);\n    return result;\n  }\n\n  /**\n   * ë¬¸ì„œë¥¼ í—¤ë”©ì„ ê¸°ì¤€ìœ¼ë¡œ ì„¹ì…˜ìœ¼ë¡œ ë¶„í• \n   * @param {string} content - ë§ˆí¬ë‹¤ìš´ í˜•ì‹ì˜ ë¬¸ì„œ ë‚´ìš©\n   * @returns {Array} - ì„¹ì…˜ ê°ì²´ ë°°ì—´\n   */\n  _splitIntoSections(content) {\n    // í—¤ë”© íŒ¨í„´ (# ì œëª©, ## ì œëª© ë“±)\n    const lines = content.split('\\n');\n    const sections = [];\n    \n    let currentHeading = \"ë¬¸ì„œ\";\n    let currentLevel = 0;\n    let currentContent = \"\";\n    let sectionStart = 0;\n    \n    // í—¤ë”©ì´ ì—†ëŠ” ì‹œì‘ ë¶€ë¶„ì„ ì²« ë²ˆì§¸ ì„¹ì…˜ìœ¼ë¡œ ì²˜ë¦¬\n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i];\n      const headingMatch = line.match(/^(#{1,6})\\s+(.+)$/);\n      \n      if (headingMatch) {\n        // ì²« ë²ˆì§¸ í—¤ë”©ì„ ë§Œë‚¬ì„ ë•Œ ì´ì „ ë‚´ìš©ì´ ìˆìœ¼ë©´ ì„¹ì…˜ìœ¼ë¡œ ì¶”ê°€\n        if (currentContent.trim()) {\n          sections.push({\n            title: \"ì†Œê°œ\",\n            level: 0,\n            content: currentContent.trim(),\n            startLine: sectionStart,\n            endLine: i - 1\n          });\n        }\n        \n        // í˜„ì¬ í—¤ë”© ì •ë³´ ì—…ë°ì´íŠ¸\n        currentHeading = headingMatch[2];\n        currentLevel = headingMatch[1].length;\n        currentContent = line;\n        sectionStart = i;\n      } else {\n        // í—¤ë”©ì´ ì•„ë‹Œ ì¼ë°˜ í…ìŠ¤íŠ¸ ì¤„ ì¶”ê°€\n        currentContent += \"\\n\" + line;\n      }\n      \n      // ë‹¤ìŒ í—¤ë”©ì„ ë§Œë‚˜ê±°ë‚˜ ë¬¸ì„œ ëì— ë„ë‹¬í•˜ë©´ ì„¹ì…˜ ì¶”ê°€\n      const nextLine = i + 1 < lines.length ? lines[i + 1] : null;\n      const isNextHeading = nextLine && nextLine.match(/^(#{1,6})\\s+(.+)$/);\n      \n      if (isNextHeading || i === lines.length - 1) {\n        if (currentContent.trim()) {\n          sections.push({\n            title: currentHeading,\n            level: currentLevel,\n            content: currentContent.trim(),\n            startLine: sectionStart,\n            endLine: i\n          });\n        }\n        \n        if (isNextHeading) {\n          const nextHeadingMatch = nextLine.match(/^(#{1,6})\\s+(.+)$/);\n          currentHeading = nextHeadingMatch[2];\n          currentLevel = nextHeadingMatch[1].length;\n          currentContent = \"\";\n          sectionStart = i + 1;\n        }\n      }\n    }\n    \n    // ì„¹ì…˜ì´ ì—†ìœ¼ë©´ ì „ì²´ ë¬¸ì„œë¥¼ í•˜ë‚˜ì˜ ì„¹ì…˜ìœ¼ë¡œ ì²˜ë¦¬\n    if (sections.length === 0 && content.trim()) {\n      sections.push({\n        title: \"ë¬¸ì„œ\",\n        level: 0,\n        content: content.trim(),\n        startLine: 0,\n        endLine: lines.length - 1\n      });\n    }\n    \n    return sections;\n  }\n  \n  /**\n   * ì„¹ì…˜ ë‚´ìš©ì— ëŒ€í•œ ê°„ë‹¨í•œ ìš”ì•½ ìƒì„± (ì‹¤ì œë¡œëŠ” AIë¥¼ í†µí•´ ìš”ì•½í•  ìˆ˜ ìˆìŒ)\n   * @param {string} sectionContent - ì„¹ì…˜ ë‚´ìš©\n   * @returns {string} - ì„¹ì…˜ ìš”ì•½\n   */\n  _generateSummary(sectionContent) {\n    // ê°„ë‹¨í•œ ìš”ì•½ ë°©ì‹: ì²« ë²ˆì§¸ ë¬¸ì¥ ë˜ëŠ” ì¼ì • ê¸¸ì´ ì¶”ì¶œ\n    if (!sectionContent) return \"\";\n    \n    // ë„ˆë¬´ ê¸´ ì„¹ì…˜ì€ ì¼ì • ê¸¸ì´ë§Œ ì‚¬ìš©\n    if (sectionContent.length > this.maxSectionLength) {\n      sectionContent = sectionContent.substring(0, this.maxSectionLength) + \"...\";\n    }\n    \n    // ì²« ë²ˆì§¸ ë¬¸ì¥ ë˜ëŠ” ì²« ë²ˆì§¸ ì¤„ì„ ìš”ì•½ìœ¼ë¡œ ì‚¬ìš©\n    let summary = \"\";\n    const firstSentenceMatch = sectionContent.match(/^.+?[.!?](?:\\s|$)/);\n    \n    if (firstSentenceMatch) {\n      summary = firstSentenceMatch[0].trim();\n    } else {\n      // ë¬¸ì¥ì´ ëª…í™•í•˜ì§€ ì•Šìœ¼ë©´ ì²« ë²ˆì§¸ ì¤„ ì‚¬ìš©\n      const firstLine = sectionContent.split('\\n')[0].trim();\n      summary = firstLine;\n    }\n    \n    // ìš”ì•½ì´ ë„ˆë¬´ ê¸¸ë©´ ìë¥´ê¸°\n    if (summary.length > this.maxSummaryLength) {\n      summary = summary.substring(0, this.maxSummaryLength) + \"...\";\n    }\n    \n    return summary;\n  }\n  \n  /**\n   * ë¬¸ì„œ ì „ì²´ ìš”ì•½ ìƒì„±\n   * @param {Array} sections - ì„¹ì…˜ ê°ì²´ ë°°ì—´\n   * @returns {string} - ë¬¸ì„œ ì „ì²´ ìš”ì•½\n   */\n  _generateDocumentSummary(sections) {\n    // ê° ì„¹ì…˜ì˜ ì œëª©ì„ ëª¨ì•„ì„œ ë¬¸ì„œ êµ¬ì¡° ìš”ì•½ ìƒì„±\n    const titles = sections.map(section => {\n      const indent = \"  \".repeat(Math.max(0, section.level - 1));\n      return `${indent}- ${section.title}`;\n    });\n    \n    return \"ë¬¸ì„œ êµ¬ì¡°:\\n\" + titles.join('\\n');\n  }\n  \n  /**\n   * ì €ì¥ëœ ë¬¸ì„œ ìš”ì•½ ê°€ì ¸ì˜¤ê¸°\n   * @param {string} documentId - ë¬¸ì„œ ì‹ë³„ì\n   * @returns {Object|null} - ì €ì¥ëœ ìš”ì•½ ê°ì²´ ë˜ëŠ” null\n   */\n  getSummary(documentId) {\n    return this.summaries.get(documentId) || null;\n  }\n  \n  /**\n   * ë¬¸ì„œì˜ íŠ¹ì • ë¶€ë¶„ ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°\n   * @param {string} documentId - ë¬¸ì„œ ì‹ë³„ì\n   * @param {number} lineNumber - ì¤„ ë²ˆí˜¸\n   * @param {number} contextLines - ì•ë’¤ë¡œ í¬í•¨í•  ì¤„ ìˆ˜\n   * @returns {Object|null} - ì»¨í…ìŠ¤íŠ¸ ì •ë³´ ê°ì²´ ë˜ëŠ” null\n   */\n  getContextAroundLine(documentId, lineNumber, contextLines = 5) {\n    const summary = this.summaries.get(documentId);\n    if (!summary) return null;\n    \n    // í•´ë‹¹ ë¼ì¸ì´ í¬í•¨ëœ ì„¹ì…˜ ì°¾ê¸°\n    const section = summary.sections.find(\n      s => lineNumber >= s.startLine && lineNumber <= s.endLine\n    );\n    \n    if (!section) return null;\n    \n    // ì„¹ì…˜ ë‚´ìš©ì—ì„œ ì£¼ë³€ ì»¨í…ìŠ¤íŠ¸ ì¶”ì¶œ\n    const lines = section.content.split('\\n');\n    const lineIndex = lineNumber - section.startLine;\n    \n    const start = Math.max(0, lineIndex - contextLines);\n    const end = Math.min(lines.length - 1, lineIndex + contextLines);\n    \n    const contextLines_code = lines.slice(start, end + 1);\n    \n    return {\n      section: section.title,\n      context: contextLines_code.join('\\n'),\n      startLine: section.startLine + start,\n      endLine: section.startLine + end\n    };\n  }\n  \n  /**\n   * ìºì‹œëœ ëª¨ë“  ìš”ì•½ ì •ë³´ ì§€ìš°ê¸°\n   */\n  clearCache() {\n    this.summaries.clear();\n  }\n}\n\nexport default DocumentSummaryManager; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\ServerDiagnostic.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\SyncManager.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\database.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'trans' is defined but never used. Allowed unused args must match /^_/u.","line":17,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":17,"endColumn":66},{"ruleId":"no-unused-vars","severity":1,"message":"'primKey' is defined but never used. Allowed unused args must match /^_/u.","line":22,"column":62,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":69},{"ruleId":"no-unused-vars","severity":1,"message":"'obj' is defined but never used. Allowed unused args must match /^_/u.","line":22,"column":71,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":74},{"ruleId":"no-unused-vars","severity":1,"message":"'trans' is defined but never used. Allowed unused args must match /^_/u.","line":22,"column":76,"nodeType":"Identifier","messageId":"unusedVar","endLine":22,"endColumn":81}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createLogger } from '../utils/logger';\nconst logger = createLogger('database');\nimport Dexie from 'dexie';\r\n\r\n// Database schema\r\nexport class MikiDatabase extends Dexie {\r\n  constructor() {\r\n    super('MikiEditorDB');\r\n    \r\n    // Define schemas\r\n    this.version(1).stores({\r\n      documents: '++id, title, content, updatedAt, isUserEditedTitle, isAutoSyncedTitle',\r\n      syncQueue: '++queueId, documentId, operation, status, retryAt, retryCount, data'\r\n    });\r\n    \r\n    // Add hooks for automatic timestamps\r\n    this.documents.hook('creating', function (primKey, obj, trans) {\r\n      obj.createdAt = new Date().toISOString();\r\n      obj.updatedAt = new Date().toISOString();\r\n    });\r\n    \r\n    this.documents.hook('updating', function (modifications, primKey, obj, trans) {\r\n      modifications.updatedAt = new Date().toISOString();\r\n    });\r\n  }\r\n}\r\n\r\n// Create database instance\r\nexport const db = new MikiDatabase();\r\n\r\n// Migration utilities\r\nexport class DatabaseMigration {\r\n  static async migrateFromLocalStorage() {\r\n    logger.info('ğŸ”„ localStorage â†’ IndexedDB ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘');\r\n    \r\n    try {\r\n      const localDocs = this.getLocalStorageDocuments();\r\n      logger.info(`ğŸ“„ ë°œê²¬ëœ ë¡œì»¬ ë¬¸ì„œ: ${localDocs.length}ê°œ`);\r\n      \r\n      if (localDocs.length === 0) {\r\n        logger.info('âœ… ë§ˆì´ê·¸ë ˆì´ì…˜í•  ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.');\r\n        return { success: true, migrated: 0 };\r\n      }\r\n      \r\n      // Batch insert for better performance\r\n      await db.transaction('rw', db.documents, async () => {\r\n        for (const doc of localDocs) {\r\n          await db.documents.put({\r\n            id: doc.id,\r\n            title: doc.title || 'ì œëª© ì—†ìŒ',\r\n            content: doc.content || '',\r\n            updatedAt: doc.updatedAt || new Date().toISOString(),\r\n            isUserEditedTitle: doc.isUserEditedTitle || false,\r\n            isAutoSyncedTitle: doc.isAutoSyncedTitle || false\r\n          });\r\n        }\r\n      });\r\n      \r\n      logger.info(`âœ… ${localDocs.length}ê°œ ë¬¸ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ`);\r\n      \r\n      // Mark migration as completed\r\n      localStorage.setItem('miki_migration_completed', 'true');\r\n      \r\n      return { success: true, migrated: localDocs.length };\r\n      \r\n    } catch (error) {\r\n      logger.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n  \r\n  static getLocalStorageDocuments() {\r\n    const documents = [];\r\n    const keys = Object.keys(localStorage);\r\n    \r\n    for (const key of keys) {\r\n      if (key.startsWith('miki_document_')) {\r\n        try {\r\n          const docData = JSON.parse(localStorage.getItem(key));\r\n          const id = key.replace('miki_document_', '');\r\n          \r\n          documents.push({\r\n            id: id,\r\n            title: docData.title || localStorage.getItem(`miki_title_${id}`) || 'ì œëª© ì—†ìŒ',\r\n            content: docData.content || '',\r\n            updatedAt: docData.updatedAt || new Date().toISOString(),\r\n            isUserEditedTitle: docData.isUserEditedTitle || false,\r\n            isAutoSyncedTitle: docData.isAutoSyncedTitle || false\r\n          });\r\n        } catch (error) {\r\n          logger.warn(`âš ï¸ ë¬¸ì„œ íŒŒì‹± ì‹¤íŒ¨: ${key}`, error);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return documents;\r\n  }\r\n  \r\n  static async cleanupLocalStorage() {\r\n    logger.info('ğŸ§¹ localStorage ì •ë¦¬ ì‹œì‘');\r\n    \r\n    const keysToRemove = [];\r\n    const keys = Object.keys(localStorage);\r\n    \r\n    for (const key of keys) {\r\n      if (key.startsWith('miki_document_') || \r\n          key.startsWith('miki_title_') ||\r\n          key.startsWith('miki_search_cache_')) {\r\n        keysToRemove.push(key);\r\n      }\r\n    }\r\n    \r\n    keysToRemove.forEach(key => localStorage.removeItem(key));\r\n    logger.info(`ğŸ—‘ï¸ ${keysToRemove.length}ê°œ í•­ëª© ì •ë¦¬ ì™„ë£Œ`);\r\n  }\r\n}\r\n\r\n// Sync queue management\r\nexport class SyncQueue {\r\n  static async enqueue(documentId, operation, data = {}) {\r\n    try {\r\n      await db.syncQueue.add({\r\n        documentId,\r\n        operation, // 'create', 'update', 'delete'\r\n        status: 'pending',\r\n        retryAt: new Date().toISOString(),\r\n        retryCount: 0,\r\n        data: JSON.stringify(data),\r\n        createdAt: new Date().toISOString()\r\n      });\r\n      \r\n      logger.info(`ğŸ“¤ ë™ê¸°í™” íì— ì¶”ê°€: ${operation} - ${documentId}`);\r\n    } catch (error) {\r\n      logger.error('âŒ ë™ê¸°í™” í ì¶”ê°€ ì‹¤íŒ¨:', error);\r\n    }\r\n  }\r\n  \r\n  static async getPendingItems() {\r\n    return await db.syncQueue\r\n      .where('status')\r\n      .equals('pending')\r\n      .and(item => new Date(item.retryAt) <= new Date())\r\n      .toArray();\r\n  }\r\n  \r\n  static async markAsCompleted(queueId) {\r\n    await db.syncQueue.update(queueId, { \r\n      status: 'completed',\r\n      completedAt: new Date().toISOString()\r\n    });\r\n  }\r\n  \r\n  static async markAsFailed(queueId, error) {\r\n    const item = await db.syncQueue.get(queueId);\r\n    const retryCount = (item?.retryCount || 0) + 1;\r\n    const maxRetries = 5;\r\n    \r\n    if (retryCount >= maxRetries) {\r\n      await db.syncQueue.update(queueId, {\r\n        status: 'failed',\r\n        retryCount,\r\n        lastError: error,\r\n        failedAt: new Date().toISOString()\r\n      });\r\n    } else {\r\n      // Exponential backoff: 2^retryCount minutes\r\n      const retryDelay = Math.pow(2, retryCount) * 60 * 1000;\r\n      const retryAt = new Date(Date.now() + retryDelay).toISOString();\r\n      \r\n      await db.syncQueue.update(queueId, {\r\n        status: 'pending',\r\n        retryCount,\r\n        retryAt,\r\n        lastError: error\r\n      });\r\n    }\r\n  }\r\n  \r\n  static async cleanup() {\r\n    // Remove completed items older than 7 days\r\n    const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString();\r\n    \r\n    await db.syncQueue\r\n      .where('status')\r\n      .equals('completed')\r\n      .and(item => item.completedAt < weekAgo)\r\n      .delete();\r\n  }\r\n}\r\n\r\n// Database utilities\r\nexport class DatabaseUtils {\r\n  static async exportData() {\r\n    try {\r\n      const documents = await db.documents.toArray();\r\n      const syncQueue = await db.syncQueue.toArray();\r\n      \r\n      const exportData = {\r\n        version: 1,\r\n        exportedAt: new Date().toISOString(),\r\n        documents,\r\n        syncQueue\r\n      };\r\n      \r\n      return JSON.stringify(exportData, null, 2);\r\n    } catch (error) {\r\n      logger.error('âŒ ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  static async importData(jsonData) {\r\n    try {\r\n      const data = JSON.parse(jsonData);\r\n      \r\n      if (data.version !== 1) {\r\n        throw new Error('ì§€ì›í•˜ì§€ ì•ŠëŠ” ë°ì´í„° ë²„ì „ì…ë‹ˆë‹¤.');\r\n      }\r\n      \r\n      await db.transaction('rw', [db.documents, db.syncQueue], async () => {\r\n        // Clear existing data\r\n        await db.documents.clear();\r\n        await db.syncQueue.clear();\r\n        \r\n        // Import documents\r\n        if (data.documents?.length > 0) {\r\n          await db.documents.bulkAdd(data.documents);\r\n        }\r\n        \r\n        // Import sync queue\r\n        if (data.syncQueue?.length > 0) {\r\n          await db.syncQueue.bulkAdd(data.syncQueue);\r\n        }\r\n      });\r\n      \r\n      logger.info('âœ… ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ');\r\n      return { success: true };\r\n      \r\n    } catch (error) {\r\n      logger.error('âŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n  \r\n  static async getStorageInfo() {\r\n    try {\r\n      const docCount = await db.documents.count();\r\n      const queueCount = await db.syncQueue.count();\r\n      \r\n      // Estimate storage usage (rough calculation)\r\n      const docs = await db.documents.toArray();\r\n      const totalSize = docs.reduce((size, doc) => {\r\n        return size + (doc.content?.length || 0) + (doc.title?.length || 0);\r\n      }, 0);\r\n      \r\n      return {\r\n        documentCount: docCount,\r\n        queueCount: queueCount,\r\n        estimatedSize: totalSize,\r\n        formattedSize: this.formatBytes(totalSize)\r\n      };\r\n    } catch (error) {\r\n      logger.error('âŒ ì €ì¥ì†Œ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);\r\n      return null;\r\n    }\r\n  }\r\n  \r\n  static formatBytes(bytes) {\r\n    if (bytes === 0) return '0 Bytes';\r\n    const k = 1024;\r\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n  }\r\n}\r\n\r\n// Initialize database and handle migrations\r\nexport const initializeDatabase = async () => {\r\n  try {\r\n    // Open database\r\n    await db.open();\r\n    logger.info('âœ… IndexedDB ì—°ê²° ì„±ê³µ');\r\n    \r\n    // Check if migration is needed\r\n    const migrationCompleted = localStorage.getItem('miki_migration_completed');\r\n    \r\n    if (!migrationCompleted) {\r\n      const result = await DatabaseMigration.migrateFromLocalStorage();\r\n      \r\n      if (result.success && result.migrated > 0) {\r\n        // Optional: Clean up localStorage after successful migration\r\n        // await DatabaseMigration.cleanupLocalStorage();\r\n        logger.info('ğŸ“¦ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ, localStorageëŠ” ë°±ì—…ìš©ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.');\r\n      }\r\n    }\r\n    \r\n    // Cleanup old sync queue items\r\n    await SyncQueue.cleanup();\r\n    \r\n    return { success: true };\r\n    \r\n  } catch (error) {\r\n    logger.error('âŒ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);\r\n    return { success: false, error: error.message };\r\n  }\r\n}; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\errorHandler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\index.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\keywordExtractor.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\logger.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":37,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":37,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"info"},"fix":{"range":[849,891],"text":""},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":50,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":50,"endColumn":19,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"time"},"fix":{"range":[1144,1186],"text":""},"desc":"Remove the console.time()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement.","line":56,"column":7,"nodeType":"MemberExpression","messageId":"unexpected","endLine":56,"endColumn":22,"suggestions":[{"messageId":"removeConsole","data":{"propertyName":"timeEnd"},"fix":{"range":[1287,1332],"text":""},"desc":"Remove the console.timeEnd()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// í™˜ê²½ë³„ ë¡œê¹… ì œì–´ ìœ í‹¸ë¦¬í‹°\r\nconst isDevelopment = (typeof process !== 'undefined' && process.env?.NODE_ENV === 'development') || false;\r\nconst isTest = (typeof process !== 'undefined' && process.env?.NODE_ENV === 'test') || false;\r\n\r\n// ë¡œê·¸ ë ˆë²¨ ì •ì˜\r\nconst LOG_LEVELS = {\r\n  ERROR: 0,\r\n  WARN: 1,\r\n  INFO: 2,\r\n  DEBUG: 3\r\n};\r\n\r\n// í˜„ì¬ ë¡œê·¸ ë ˆë²¨ ì„¤ì • (í™˜ê²½ë³€ìˆ˜ë¡œ ì œì–´ ê°€ëŠ¥)\r\nconst currentLogLevel = isDevelopment \r\n  ? LOG_LEVELS.DEBUG \r\n  : LOG_LEVELS.ERROR;\r\n\r\nclass Logger {\r\n  constructor(module = 'App') {\r\n    this.module = module;\r\n  }\r\n\r\n  error(...args) {\r\n    if (currentLogLevel >= LOG_LEVELS.ERROR) {\r\n      logger.error(`[${this.module}]`, ...args);\r\n    }\r\n  }\r\n\r\n  warn(...args) {\r\n    if (currentLogLevel >= LOG_LEVELS.WARN) {\r\n      logger.warn(`[${this.module}]`, ...args);\r\n    }\r\n  }\r\n\r\n  info(...args) {\r\n    if (currentLogLevel >= LOG_LEVELS.INFO) {\r\n      console.info(`[${this.module}]`, ...args);\r\n    }\r\n  }\r\n\r\n  debug(...args) {\r\n    if (currentLogLevel >= LOG_LEVELS.DEBUG && !isTest) {\r\n      logger.info(`[${this.module}]`, ...args);\r\n    }\r\n  }\r\n\r\n  // ì„±ëŠ¥ ì¸¡ì •ìš©\r\n  time(label) {\r\n    if (currentLogLevel >= LOG_LEVELS.DEBUG && !isTest) {\r\n      console.time(`[${this.module}] ${label}`);\r\n    }\r\n  }\r\n\r\n  timeEnd(label) {\r\n    if (currentLogLevel >= LOG_LEVELS.DEBUG && !isTest) {\r\n      console.timeEnd(`[${this.module}] ${label}`);\r\n    }\r\n  }\r\n}\r\n\r\n// ëª¨ë“ˆë³„ ë¡œê±° ìƒì„± í•¨ìˆ˜\r\nexport const createLogger = (module) => new Logger(module);\r\n\r\n// ê¸°ë³¸ ë¡œê±°\r\nexport const logger = new Logger('App');\r\n\r\n// ë ˆê±°ì‹œ console.log ëŒ€ì²´ìš© (ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜)\r\nexport const debugLog = (...args) => {\r\n  if (isDevelopment && !isTest) {\r\n    logger.info('[DEBUG]', ...args);\r\n  }\r\n};\r\n\r\nexport default logger; ","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\halim\\Desktop\\miki_v4\\v7\\home\\ubuntu\\miki-editor\\src\\utils\\searchCache.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]
