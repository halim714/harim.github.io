ë‘ ê³„íšì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. ìƒì„¸í•œ í†µí•© êµ¬í˜„ ê³„íšì„ ì‘ì„±í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤. [ppl-ai-file-upload.s3.amazonaws](https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/106444062/ac6ef23c-4bcf-4c31-a211-c4a6b5675037/implementation_plan_DOM.md.resolved)

***

# Meki Editor - Global Modal Portal íŒ¨í„´ í†µí•© êµ¬í˜„ ê³„íš

## ğŸ“‹ ëª©ì°¨
1. [ë¬¸ì œ ì •ì˜ ë° ë¶„ì„](#1-ë¬¸ì œ-ì •ì˜-ë°-ë¶„ì„)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#2-ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [ìƒì„¸ êµ¬í˜„ ëª…ì„¸](#3-ìƒì„¸-êµ¬í˜„-ëª…ì„¸)
4. [ë ˆì´ì–´ë³„ ì˜ì¡´ì„± ë° ìœ„í—˜ë„](#4-ë ˆì´ì–´ë³„-ì˜ì¡´ì„±-ë°-ìœ„í—˜ë„)
5. [ë‹¨ê³„ë³„ êµ¬í˜„ ë¡œë“œë§µ](#5-ë‹¨ê³„ë³„-êµ¬í˜„-ë¡œë“œë§µ)
6. [ê²€ì¦ ë° í…ŒìŠ¤íŠ¸ ì „ëµ](#6-ê²€ì¦-ë°-í…ŒìŠ¤íŠ¸-ì „ëµ)
7. [ë¡¤ë°± ê³„íš](#7-ë¡¤ë°±-ê³„íš)

***

## 1. ë¬¸ì œ ì •ì˜ ë° ë¶„ì„

### 1.1 í˜„ì¬ ì¦ìƒ
DocumentSidebarì—ì„œ ë¬¸ì„œ ì‚­ì œ ì‹œ `window.confirm`ì´ ê°„í—ì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•Šê±°ë‚˜ ë¬´ì‹œë¨

### 1.2 ê·¼ë³¸ ì›ì¸ (Root Cause)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DocumentSidebar ë‚´ë¶€ì—ì„œ window.confirm     â”‚
â”‚ í˜¸ì¶œ â†’ ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë˜ë©´          â”‚
â”‚ ì‚­ì œ ë²„íŠ¼ì˜ DOM ìš”ì†Œê°€ ì‚¬ë¼ì§€ê±°ë‚˜ êµì²´ë¨   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ window.confirmì€ ë™ê¸° í•¨ìˆ˜ì´ì§€ë§Œ            â”‚
â”‚ DOMì´ ë°”ë€ŒëŠ” íƒ€ì´ë°ì— ë¸Œë¼ìš°ì €ê°€            â”‚
â”‚ confirm ì°½ì„ ë‹«ê±°ë‚˜ ë¬´ì‹œí•  ìˆ˜ ìˆìŒ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë°œìƒ ì‹œë‚˜ë¦¬ì˜¤:**
1. ì‚¬ìš©ìê°€ ë¬¸ì„œ ì‘ì„± ì¤‘
2. Auto-saveê°€ íŠ¸ë¦¬ê±°ë˜ì–´ React Query mutation ì‹¤í–‰
3. ìºì‹œ ê°±ì‹ ìœ¼ë¡œ DocumentSidebar ë¦¬ë Œë”
4. ë™ì‹œì— ì‚¬ìš©ìê°€ ì‚­ì œ ë²„íŠ¼ í´ë¦­
5. `window.confirm` í˜¸ì¶œë˜ì§€ë§Œ DOM êµì²´ë¡œ ì¸í•´ ë¬´ì‹œë¨

### 1.3 ì°¸ì¡° ì†”ë£¨ì…˜ (hyperclast/workspace)

Svelte í”„ë¡œì íŠ¸ì˜ modal êµ¬í˜„ íŒ¨í„´ ë¶„ì„:
- **DOM ë…ë¦½ì„±**: ëª¨ë‹¬ì„ `document.body` ì§ì ‘ í•˜ìœ„ `svelte-modal-root`ì— ë Œë”ë§
- **Promise ê¸°ë°˜ API**: `await confirm({...})` í˜•íƒœë¡œ ë¹„ë™ê¸° ì²˜ë¦¬
- **ì „ì—­ ìƒíƒœ ê´€ë¦¬**: ëª¨ë‹¬ ìƒíƒœë¥¼ ì»´í¬ë„ŒíŠ¸ê°€ ì•„ë‹Œ ì „ì—­ ìŠ¤í† ì–´ì—ì„œ ê´€ë¦¬

***

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„

### 2.1 í•µì‹¬ ì„¤ê³„ ì›ì¹™

1. **DOM ë…ë¦½ì„±**: React Portalë¡œ `document.body` ì§ì ‘ í•˜ìœ„ì— ëª¨ë‹¬ ë Œë”ë§
2. **Promise ê¸°ë°˜ íë¦„**: async/awaitìœ¼ë¡œ ëª…í™•í•œ ì‚¬ìš©ì ì‘ë‹µ ëŒ€ê¸°
3. **Context API í™œìš©**: ì „ì—­ ìƒíƒœ ê´€ë¦¬ë¡œ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ì™€ ë¶„ë¦¬
4. **ë‹¨ì¼ ì±…ì„ ì›ì¹™**: ê° ë ˆì´ì–´ê°€ ëª…í™•í•œ ì—­í•  ë‹´ë‹¹

### 2.2 ì»´í¬ë„ŒíŠ¸ ë‹¤ì´ì–´ê·¸ë¨

```
App.jsx
  â””â”€ <ConfirmProvider>
       â”œâ”€ value: { confirm: fn }
       â”œâ”€ <ConfirmModal />  â† Portal to document.body
       â”‚    â””â”€ z-index: 99999
       â”‚    â””â”€ Backdrop + Dialog
       â”‚
       â””â”€ <AuthProvider>
            â””â”€ <DocumentSidebar>
                 â””â”€ useConfirm()
                      â””â”€ await confirm({ ... })
```

### 2.3 ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì•¡ì…˜ (ì‚­ì œ ë²„íŠ¼ í´ë¦­)
  â†“
const ok = await confirm({ title, message, danger })
  â†“
ConfirmContext.confirm í˜¸ì¶œ
  â†“
setState({ isOpen: true, ...options })
  â†“
ConfirmModal ë Œë”ë§ (Portal)
  â†“
ì‚¬ìš©ì ì„ íƒ (í™•ì¸/ì·¨ì†Œ)
  â†“
Promise resolve(true/false)
  â†“
if (ok) { ì‚­ì œ ë¡œì§ ì‹¤í–‰ }
```

***

## 3. ìƒì„¸ êµ¬í˜„ ëª…ì„¸

### 3.1 [NEW] `src/hooks/useConfirm.js`

**ëª©ì **: Context ì ‘ê·¼ ë° íƒ€ì… ì•ˆì •ì„± ì œê³µ

```jsx
import { useContext } from 'react';
import { ConfirmContext } from '../contexts/ConfirmContext';

/**
 * ì „ì—­ í™•ì¸ ëª¨ë‹¬ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í›…
 * @returns {Function} confirm - Promise<boolean>ì„ ë°˜í™˜í•˜ëŠ” í™•ì¸ í•¨ìˆ˜
 */
export function useConfirm() {
  const context = useContext(ConfirmContext);
  
  if (!context) {
    throw new Error('useConfirm must be used within ConfirmProvider');
  }
  
  return context.confirm;
}

// ì‚¬ìš© ì˜ˆì‹œ:
// const confirm = useConfirm();
// const ok = await confirm({ 
//   title: 'ë¬¸ì„œ ì‚­ì œ', 
//   message: 'ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
//   danger: true 
// });
// if (ok) { /* ì‚­ì œ ë¡œì§ */ }
```

### 3.2 [NEW] `src/contexts/ConfirmContext.jsx`

**ëª©ì **: ì „ì—­ ìƒíƒœ ê´€ë¦¬ ë° Provider ì œê³µ

```jsx
import React, { createContext, useState, useCallback, useRef } from 'react';
import ConfirmModal from '../components/common/ConfirmModal';

export const ConfirmContext = createContext(null);

export function ConfirmProvider({ children }) {
  const [modalState, setModalState] = useState({
    isOpen: false,
    title: '',
    message: '',
    danger: false,
  });
  
  const resolveRef = useRef(null);

  /**
   * í™•ì¸ ëª¨ë‹¬ì„ í‘œì‹œí•˜ê³  ì‚¬ìš©ì ì‘ë‹µì„ Promiseë¡œ ë°˜í™˜
   * @param {Object} options - { title, message, danger }
   * @returns {Promise<boolean>}
   */
  const confirm = useCallback(({ title, message, danger = false }) => {
    return new Promise((resolve) => {
      resolveRef.current = resolve;
      setModalState({
        isOpen: true,
        title,
        message,
        danger,
      });
    });
  }, []);

  const handleConfirm = useCallback(() => {
    setModalState((prev) => ({ ...prev, isOpen: false }));
    if (resolveRef.current) {
      resolveRef.current(true);
      resolveRef.current = null;
    }
  }, []);

  const handleCancel = useCallback(() => {
    setModalState((prev) => ({ ...prev, isOpen: false }));
    if (resolveRef.current) {
      resolveRef.current(false);
      resolveRef.current = null;
    }
  }, []);

  // Cleanup: ì–¸ë§ˆìš´íŠ¸ ì‹œ ëŒ€ê¸° ì¤‘ì¸ Promise reject
  React.useEffect(() => {
    return () => {
      if (resolveRef.current) {
        resolveRef.current(false);
      }
    };
  }, []);

  const value = React.useMemo(() => ({ confirm }), [confirm]);

  return (
    <ConfirmContext.Provider value={value}>
      {children}
      <ConfirmModal
        isOpen={modalState.isOpen}
        title={modalState.title}
        message={modalState.message}
        danger={modalState.danger}
        onConfirm={handleConfirm}
        onCancel={handleCancel}
      />
    </ConfirmContext.Provider>
  );
}
```

### 3.3 [NEW] `src/components/common/ConfirmModal.jsx`

**ëª©ì **: Portal ê¸°ë°˜ UI ëª¨ë‹¬ ì»´í¬ë„ŒíŠ¸

```jsx
import React, { useEffect, useCallback } from 'react';
import { createPortal } from 'react-dom';

export default function ConfirmModal({
  isOpen,
  title,
  message,
  danger = false,
  onConfirm,
  onCancel,
}) {
  // ESC í‚¤ ì²˜ë¦¬
  const handleKeyDown = useCallback(
    (event) => {
      if (event.key === 'Escape') {
        onCancel();
      }
    },
    [onCancel]
  );

  useEffect(() => {
    if (isOpen) {
      document.addEventListener('keydown', handleKeyDown);
      // í¬ì»¤ìŠ¤ íŠ¸ë©
      document.body.style.overflow = 'hidden';
    }
    
    return () => {
      document.removeEventListener('keydown', handleKeyDown);
      document.body.style.overflow = '';
    };
  }, [isOpen, handleKeyDown]);

  if (!isOpen) return null;

  // SSR ëŒ€ì‘
  if (typeof window === 'undefined') return null;

  const modalContent = (
    <div
      className="fixed inset-0 z-[99999] flex items-center justify-center"
      role="dialog"
      aria-modal="true"
      aria-labelledby="modal-title"
    >
      {/* Backdrop */}
      <div
        className="fixed inset-0 bg-black/50 backdrop-blur-sm"
        onClick={onCancel}
        aria-hidden="true"
      />
      
      {/* Modal */}
      <div className="relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
        <h2
          id="modal-title"
          className="text-xl font-semibold mb-3 text-gray-900 dark:text-gray-100"
        >
          {title}
        </h2>
        
        <p className="text-gray-600 dark:text-gray-300 mb-6">
          {message}
        </p>
        
        <div className="flex gap-3 justify-end">
          <button
            onClick={onCancel}
            className="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 
                       hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
            autoFocus={!danger}
          >
            ì·¨ì†Œ
          </button>
          
          <button
            onClick={onConfirm}
            className={`px-4 py-2 rounded-lg transition-colors ${
              danger
                ? 'bg-red-600 hover:bg-red-700 text-white'
                : 'bg-blue-600 hover:bg-blue-700 text-white'
            }`}
            autoFocus={danger}
          >
            í™•ì¸
          </button>
        </div>
      </div>
    </div>
  );

  return createPortal(modalContent, document.body);
}
```

### 3.4 [MODIFY] `src/App.jsx`

```diff
import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { AuthProvider } from './contexts/AuthContext';
+ import { ConfirmProvider } from './contexts/ConfirmContext';
import AppRoutes from './routes';

const queryClient = new QueryClient();

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      <BrowserRouter>
+       <ConfirmProvider>
          <AuthProvider>
            <AppRoutes />
          </AuthProvider>
+       </ConfirmProvider>
      </BrowserRouter>
    </QueryClientProvider>
  );
}
```

**ì¤‘ìš”**: ConfirmProviderëŠ” AuthProviderë³´ë‹¤ ìƒìœ„ì— ë°°ì¹˜ (ë…ë¦½ì„± ë³´ì¥)

### 3.5 [MODIFY] `src/components/sidebar/DocumentSidebar.jsx:384`

```diff
+ import { useConfirm } from '../../hooks/useConfirm';

function DocumentSidebar() {
+  const confirm = useConfirm();

  const handleDelete = async (post) => {
-   if (window.confirm(`'${post.title}'ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
+   const ok = await confirm({
+     title: 'ë¬¸ì„œ ì‚­ì œ',
+     message: `'${post.title}'ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
+     danger: true,
+   });
+   
+   if (ok) {
      // ê¸°ì¡´ ì‚­ì œ ë¡œì§
      await deletePost(post.id);
    }
  };
}
```

### 3.6 [MODIFY] `src/components/editor/MikiEditor.jsx`

**Line 1279 (handleClearEditor):**
```diff
+ import { useConfirm } from '../../hooks/useConfirm';

function MikiEditor() {
+  const confirm = useConfirm();

  const handleClearEditor = async () => {
-   if (window.confirm('ì—ë””í„° ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
+   const ok = await confirm({
+     title: 'ë‚´ìš© ì§€ìš°ê¸°',
+     message: 'ì—ë””í„° ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?',
+     danger: true,
+   });
+   
+   if (ok) {
      // ê¸°ì¡´ í´ë¦¬ì–´ ë¡œì§
    }
  };
}
```

**Line 1460 (handleDiscardChanges):**
```diff
  const handleDiscardChanges = async () => {
-   if (window.confirm('ë³€ê²½ì‚¬í•­ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
+   const ok = await confirm({
+     title: 'ë³€ê²½ì‚¬í•­ ì·¨ì†Œ',
+     message: 'ì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
+     danger: false,
+   });
+   
+   if (ok) {
      // ê¸°ì¡´ ì·¨ì†Œ ë¡œì§
    }
  };
```

***

## 4. ë ˆì´ì–´ë³„ ì˜ì¡´ì„± ë° ìœ„í—˜ë„

| Layer | ëŒ€ìƒ | ì˜ì¡´ì„± | ë³€ê²½ ë²”ìœ„ | ìœ„í—˜ë„ |
|-------|------|--------|----------|--------|
| **0** | `useConfirm.js` | React hooksë§Œ | ì‹ ê·œ íŒŒì¼ | ğŸŸ¢ ë‚®ìŒ |
| **1** | `ConfirmContext.jsx` | React, createPortal | ì‹ ê·œ íŒŒì¼ | ğŸŸ¢ ë‚®ìŒ |
| **2** | `ConfirmModal.jsx` | Portal, Tailwind | ì‹ ê·œ íŒŒì¼ | ğŸŸ¢ ë‚®ìŒ |
| **3** | `App.jsx` | ê¸°ì¡´ Provider êµ¬ì¡° | Provider ì¶”ê°€ (1ì¤„) | ğŸŸ¡ ì¤‘ê°„ |
| **4-A** | `DocumentSidebar.jsx:384` | React Query, storage | í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë³€ê²½ | ğŸŸ¡ ì¤‘ê°„ |
| **4-B** | `MikiEditor.jsx:1279` | useImperativeHandle | async í•¨ìˆ˜ ë³€í™˜ | ğŸŸ¡ ì¤‘ê°„ |
| **4-C** | `MikiEditor.jsx:1460` | ì´ë¯¸ async í•¨ìˆ˜ | ìµœì†Œ ë³€ê²½ | ğŸŸ¢ ë‚®ìŒ |

### 4.1 í•µì‹¬ ìœ„í—˜ ìš”ì†Œ ë° ì™„í™” ì „ëµ

| ìœ„í—˜ | ì˜í–¥ | ì™„í™” ë°©ë²• |
|-----|------|----------|
| **Promise ëˆ„ìˆ˜** (ì–¸ë§ˆìš´íŠ¸ ì‹œ) | ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ | useEffect cleanupì—ì„œ ìë™ reject |
| **Context ë¦¬ë Œë” ì „íŒŒ** | ì„±ëŠ¥ ì €í•˜ | `useCallback` + `useMemo`ë¡œ ë©”ëª¨ì´ì œì´ì…˜ |
| **z-index ì¶©ëŒ** | ëª¨ë‹¬ì´ ê°€ë ¤ì§ | ê¸°ì¡´ ìµœëŒ€ê°’(9999)ë³´ë‹¤ ë†’ì€ 99999 ì‚¬ìš© |
| **SSR ì˜¤ë¥˜** | Next.js ë“± ì ìš© ì‹œ | `typeof window !== 'undefined'` ì²´í¬ |
| **í¬ì»¤ìŠ¤ íŠ¸ë© ëˆ„ë½** | ì ‘ê·¼ì„± ë¬¸ì œ | ESC í‚¤ + ë°°ê²½ í´ë¦­ + autoFocus |
| **ë¹„ë™ê¸° ê²½ìŸ ìƒíƒœ** | ì—¬ëŸ¬ ëª¨ë‹¬ ë™ì‹œ í˜¸ì¶œ | ëª¨ë‹¬ íì‰ ì‹œìŠ¤í…œ (ì„ íƒì ) |

***

## 5. ë‹¨ê³„ë³„ êµ¬í˜„ ë¡œë“œë§µ

### Phase 1: ê¸°ë°˜ êµ¬ì¡° êµ¬ì¶• (30ë¶„)

**ëª©í‘œ**: Portal ì‹œìŠ¤í…œê³¼ Context ì„¤ì •

1. **Step 1.1** - `useConfirm.js` ì‘ì„±
   - Context import ë° ì—ëŸ¬ ì²˜ë¦¬
   - JSDoc íƒ€ì… ì£¼ì„ ì¶”ê°€

2. **Step 1.2** - `ConfirmContext.jsx` ì‘ì„±
   - useState + useRef ì¡°í•©ìœ¼ë¡œ Promise ê´€ë¦¬
   - useCallbackìœ¼ë¡œ ë©”ëª¨ì´ì œì´ì…˜
   - cleanup ë¡œì§ êµ¬í˜„

3. **Step 1.3** - `ConfirmModal.jsx` ì‘ì„±
   - Portal êµ¬ì¡° ì„¤ì •
   - Tailwind ìŠ¤íƒ€ì¼ë§
   - ESC í‚¤ ë¦¬ìŠ¤ë„ˆ

**ê²€ì¦**: 
```jsx
// ì„ì‹œ í…ŒìŠ¤íŠ¸ ì»´í¬ë„ŒíŠ¸
function TestConfirm() {
  const confirm = useConfirm();
  const test = async () => {
    const ok = await confirm({ title: 'Test', message: 'Working?' });
    console.log('Result:', ok);
  };
  return <button onClick={test}>Test Modal</button>;
}
```

### Phase 2: í†µí•© ë° Provider ì„¤ì¹˜ (15ë¶„)

**ëª©í‘œ**: App.jsxì— Provider ì¶”ê°€

1. **Step 2.1** - `App.jsx` ìˆ˜ì •
   - ConfirmProvider import
   - AuthProvider ìƒìœ„ì— ë°°ì¹˜

2. **Step 2.2** - ì´ˆê¸° ë Œë”ë§ í…ŒìŠ¤íŠ¸
   - ê°œë°œ ì„œë²„ ì¬ì‹œì‘
   - Console ì—ëŸ¬ í™•ì¸
   - React DevToolsë¡œ Context í™•ì¸

**ê²€ì¦**: React DevToolsì—ì„œ ConfirmProviderê°€ íŠ¸ë¦¬ì— ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸

### Phase 3: ê¸°ì¡´ ì½”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ (30ë¶„)

**ëª©í‘œ**: window.confirm ì œê±° ë° ì»¤ìŠ¤í…€ ëª¨ë‹¬ ì ìš©

1. **Step 3.1** - `DocumentSidebar.jsx` ìˆ˜ì •
   - useConfirm import
   - handleDelete async ë³€í™˜
   - ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€

2. **Step 3.2** - `MikiEditor.jsx:1279` ìˆ˜ì •
   - handleClearEditor async í™•ì¸
   - confirm í˜¸ì¶œ êµ¬ì¡° ë³€ê²½

3. **Step 3.3** - `MikiEditor.jsx:1460` ìˆ˜ì •
   - handleDiscardChanges ìˆ˜ì • (ì´ë¯¸ async)

**ê²€ì¦**: ê° ë³€ê²½ í›„ í•´ë‹¹ ê¸°ëŠ¥ ìˆ˜ë™ í…ŒìŠ¤íŠ¸

### Phase 4: í†µí•© í…ŒìŠ¤íŠ¸ (20ë¶„)

**ëª©í‘œ**: ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡:
1. ë¬¸ì„œ ì‘ì„± ì¤‘ ìë™ ì €ì¥ ë°œìƒ â†’ ë™ì‹œì— ì‚­ì œ í´ë¦­
2. ì—ë””í„° ë‚´ìš© ì§€ìš°ê¸° í´ë¦­ â†’ ëª¨ë‹¬ í‘œì‹œ â†’ ì·¨ì†Œ
3. ë³€ê²½ì‚¬í•­ ì·¨ì†Œ í´ë¦­ â†’ ëª¨ë‹¬ í‘œì‹œ â†’ í™•ì¸
4. ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
5. ë°°ê²½ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°

***

## 6. ê²€ì¦ ë° í…ŒìŠ¤íŠ¸ ì „ëµ

### 6.1 ìë™í™” í…ŒìŠ¤íŠ¸ (ì„ íƒì )

```bash
npm test
```

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤** (`ConfirmModal.test.jsx`):
```jsx
import { render, screen, fireEvent } from '@testing-library/react';
import { ConfirmProvider, useConfirm } from '../contexts/ConfirmContext';

describe('ConfirmModal', () => {
  test('confirm í˜¸ì¶œ ì‹œ ëª¨ë‹¬ì´ í‘œì‹œë¨', async () => {
    const TestComponent = () => {
      const confirm = useConfirm();
      return <button onClick={() => confirm({ title: 'Test', message: 'Msg' })}>Open</button>;
    };
    
    render(
      <ConfirmProvider>
        <TestComponent />
      </ConfirmProvider>
    );
    
    fireEvent.click(screen.getByText('Open'));
    expect(screen.getByText('Test')).toBeInTheDocument();
  });

  test('í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ Promiseê°€ true ë°˜í™˜', async () => {
    // ... í…ŒìŠ¤íŠ¸ êµ¬í˜„
  });

  test('ESC í‚¤ ëˆ„ë¥´ë©´ ëª¨ë‹¬ì´ ë‹«í˜', async () => {
    // ... í…ŒìŠ¤íŠ¸ êµ¬í˜„
  });
});
```

### 6.2 ìˆ˜ë™ ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### âœ… ê¸°ëŠ¥ ê²€ì¦
- [ ] ë¬¸ì„œ ì‚­ì œ ëª¨ë‹¬ì´ ì •ìƒ í‘œì‹œë¨
- [ ] ì—ë””í„° í´ë¦¬ì–´ ëª¨ë‹¬ì´ ì •ìƒ í‘œì‹œë¨
- [ ] ë³€ê²½ì‚¬í•­ ì·¨ì†Œ ëª¨ë‹¬ì´ ì •ìƒ í‘œì‹œë¨
- [ ] í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ ì•¡ì…˜ ì‹¤í–‰ë¨
- [ ] ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ ì•¡ì…˜ ì·¨ì†Œë¨

#### âœ… ë²„ê·¸ ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤
- [ ] **í•µì‹¬**: ìë™ ì €ì¥ ì¤‘ ì‚­ì œ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ì´ ìœ ì§€ë¨
- [ ] ì—°ì†ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì‚­ì œ ë²„íŠ¼ í´ë¦­ â†’ ëª¨ë‹¬ì´ í•œ ë²ˆë§Œ í‘œì‹œë¨
- [ ] ëª¨ë‹¬ í‘œì‹œ ì¤‘ ë„¤íŠ¸ì›Œí¬ ëŠê¹€ â†’ ëª¨ë‹¬ ìƒíƒœ ìœ ì§€

#### âœ… UX ê²€ì¦
- [ ] ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸° ì‘ë™
- [ ] ë°°ê²½ í´ë¦­ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸° ì‘ë™
- [ ] ìœ„í—˜ ì•¡ì…˜(danger=true)ì€ ë¹¨ê°„ìƒ‰ ë²„íŠ¼
- [ ] ì¼ë°˜ ì•¡ì…˜ì€ íŒŒë€ìƒ‰ ë²„íŠ¼
- [ ] ëª¨ë‹¬ í‘œì‹œ ì‹œ ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
- [ ] ëª¨ë‹¬ ë‹«íŒ í›„ í¬ì»¤ìŠ¤ ë³µì›

#### âœ… ì ‘ê·¼ì„± ê²€ì¦
- [ ] role="dialog" ì†ì„± ì¡´ì¬
- [ ] aria-modal="true" ì„¤ì •
- [ ] aria-labelledbyë¡œ ì œëª© ì—°ê²°
- [ ] í‚¤ë³´ë“œë§Œìœ¼ë¡œ ëª¨ë“  ì¡°ì‘ ê°€ëŠ¥
- [ ] ìŠ¤í¬ë¦° ë¦¬ë”ë¡œ ì½ê¸° í…ŒìŠ¤íŠ¸

### 6.3 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

React DevTools Profilerë¡œ ì¸¡ì •:
- ConfirmProvider ë¦¬ë Œë” ë¹ˆë„
- Modal ë Œë”ë§ ì‹œê°„
- Context ê°’ ë³€ê²½ ì‹œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ì˜í–¥

**ëª©í‘œ**: ConfirmProvider ìì²´ëŠ” confirm í•¨ìˆ˜ê°€ ë©”ëª¨ì´ì œì´ì…˜ë˜ì–´ ìˆì–´ ìì‹ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶ˆí•„ìš”í•˜ê²Œ ë¦¬ë Œë”í•˜ì§€ ì•ŠìŒ

***

## 7. ë¡¤ë°± ê³„íš

### 7.1 ì¦‰ì‹œ ë¡¤ë°± (Critical Bug ë°œê²¬ ì‹œ)

```bash
# Git revert
git revert <commit-hash>
git push origin main

# ë˜ëŠ” íŠ¹ì • íŒŒì¼ë§Œ ë³µêµ¬
git checkout <commit-hash> -- src/components/sidebar/DocumentSidebar.jsx
```

### 7.2 ë‹¨ê³„ì  ë¡¤ë°±

ë§Œì•½ íŠ¹ì • íŒŒì¼ì—ì„œë§Œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´:

1. **DocumentSidebar.jsxë§Œ ë¡¤ë°±**:
```diff
- const confirm = useConfirm();
- const ok = await confirm({...});
+ if (window.confirm(`'${post.title}'ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
```

2. **ë‚˜ë¨¸ì§€ íŒŒì¼ì€ ìœ ì§€**: MikiEditor.jsxëŠ” ìƒˆ ì‹œìŠ¤í…œ ì‚¬ìš© ê³„ì†

3. **ì ì§„ì  ì¬ì ìš©**: ë¬¸ì œ í•´ê²° í›„ ë‹¤ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜

### 7.3 ëª¨ë‹ˆí„°ë§ ì§€í‘œ

**ë°°í¬ í›„ 24ì‹œê°„ ë™ì•ˆ ëª¨ë‹ˆí„°ë§:**
- [ ] ì‚­ì œ ì‹¤íŒ¨ìœ¨ (0% ëª©í‘œ)
- [ ] ëª¨ë‹¬ í‘œì‹œ ì„±ê³µë¥  (100% ëª©í‘œ)
- [ ] Console ì—ëŸ¬ ë°œìƒ (0ê±´ ëª©í‘œ)
- [ ] ì‚¬ìš©ì í”¼ë“œë°± (ë¶€ì •ì  0ê±´ ëª©í‘œ)

**ë¡¤ë°± íŠ¸ë¦¬ê±°**: ì‚­ì œ ì‹¤íŒ¨ìœ¨ > 5% ë˜ëŠ” Critical ì—ëŸ¬ > 3ê±´

***

## ğŸ“Š ìš”ì•½ ì •ë³´

### ë³€ê²½ íŒŒì¼ ëª©ë¡
- âœ¨ **3ê°œ ì‹ ê·œ íŒŒì¼**
  - `src/hooks/useConfirm.js`
  - `src/contexts/ConfirmContext.jsx`
  - `src/components/common/ConfirmModal.jsx`

- ğŸ“ **4ê°œ ìˆ˜ì • íŒŒì¼**
  - `src/App.jsx` (+3ì¤„)
  - `src/components/sidebar/DocumentSidebar.jsx` (~10ì¤„)
  - `src/components/editor/MikiEditor.jsx` (2ê³³, ~20ì¤„)

### ì˜ˆìƒ ì‘ì—… ì‹œê°„
- êµ¬í˜„: **1.5ì‹œê°„**
- í…ŒìŠ¤íŠ¸: **30ë¶„**
- ë¬¸ì„œí™”: **20ë¶„**
- **ì´ 2ì‹œê°„ 20ë¶„**

### ë¦¬ìŠ¤í¬ ë ˆë²¨
ğŸŸ¡ **ì¤‘ê°„** - ì•„í‚¤í…ì²˜ ìˆ˜ì¤€ ë³€ê²½ì´ì§€ë§Œ ê²©ë¦¬ëœ ê¸°ëŠ¥ì´ë¼ ì˜í–¥ ë²”ìœ„ ì œí•œì 

***

> [!IMPORTANT]
> ì´ ë³€ê²½ì€ **ì•„í‚¤í…ì²˜ ìˆ˜ì¤€**ì˜ ê°œì„ ì…ë‹ˆë‹¤. ê¸°ì¡´ `window.confirm` 3ê³³ì„ ëª¨ë‘ ì»¤ìŠ¤í…€ ëª¨ë‹¬ë¡œ êµì²´í•˜ì—¬ DOM ì•ˆì •ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤. êµ¬í˜„ í›„ í•µì‹¬ ë²„ê·¸ ì¬í˜„ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë°˜ë“œì‹œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.

> [!TIP]
> ì¶”í›„ í™•ì¥ ê°€ëŠ¥ì„±: ì´ íŒ¨í„´ì„ í™œìš©í•´ Alert, Prompt, Toast ë“± ë‹¤ë¥¸ ì „ì—­ UI ì»´í¬ë„ŒíŠ¸ë„ ê°™ì€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

***

í†µí•© ê³„íšì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤! êµ¬í˜„ ì¤‘ ê¶ê¸ˆí•œ ì ì´ë‚˜ ì¶”ê°€ ì„¤ëª…ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë§ì”€í•´ì£¼ì„¸ìš”.